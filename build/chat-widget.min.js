var chatApiSessionBuildSessionFromSessionId=function(cp,id,state){var r={chat_id:id,state:state};return r.session=chatApiSessionCreateSessionHandler(cp,r),r},caseHistoryHandler=function(){var helpers=void 0,onLogEvent=void 0;function historySessionHandler(session){var sessionState={parties:{},displayName:"me",entryName:"",sessionId:session.chat_id,getProfilePhotoUrl:function(){return"/"}};session.events.forEach(function(event,i){event.history=!0,i===session.events.length-1&&(event.last=!0),function(msg,o){try{switch(msg.event){case commonConstants.events.chat.session.NETWORK_CONNECTION_ERROR:case commonConstants.events.chat.session.NETWORK_CONNECTION_ESTABLISHED:case commonConstants.events.chat.session.ENDED:msg.sessionId=o.sessionId,msg.fromClass="sys",msg.fromName=o.entryName,onLogEvent(msg);break;case commonConstants.events.chat.session.PARTY_JOINED:msg.sessionId=o.sessionId;var p=helpers.buildParty(o,msg);p.displayName=p.firstName+" "+p.lastName,helpers.detectParty(o),onLogEvent(helpers.preparePartyLogEvent(o,msg,p));break;case commonConstants.events.chat.session.PARTY_LEFT:msg.sessionId=o.sessionId;var party=o.parties[msg.party_id];delete o.parties[msg.party_id],helpers.detectParty(o),onLogEvent(helpers.preparePartyLogEvent(o,msg,party));break;case commonConstants.events.chat.session.MESSAGE:msg.sessionId=o.sessionId,msg.fromClass="session_msg",onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.FILE:msg.sessionId=o.sessionId,msg.party_id=msg.party_id||o.sessionId,msg.fileUrl="/",onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.TIMEOUT_WARNING:msg.sessionId=o.sessionId,msg.fromClass="sys",onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.INACTIVITY_TIMEOUT:msg.sessionId=o.sessionId,o.internalParty=void 0,msg.fromClass="sys",onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.COBROWSING_REQUESTED:case commonConstants.events.chat.session.COBROWSING_REJECTED:case commonConstants.events.chat.session.COBROWSING_STARTED:case commonConstants.events.chat.session.COBROWSING_ENDED:msg.fromClass="sys",onLogEvent(msg);break;case commonConstants.events.chat.session.INFO:case commonConstants.events.chat.session.STATUS:case commonConstants.events.chat.session.TYPING:case commonConstants.events.chat.session.FORM_SHOW:case commonConstants.events.chat.session.SECURE_FORM_SHOW:case commonConstants.events.chat.session.NOT_TYPING:case commonConstants.events.chat.session.SIGNALING:case commonConstants.events.chat.session.CASE_SET:}}catch(e){console.error("Cannot handle case history event :",msg,e)}}(event,sessionState)})}return function(caseHistory,helpersImpl,onLogEventUICallback){helpers=helpersImpl,onLogEvent=onLogEventUICallback,$("#messages_history_separator").prevAll().remove();var lastDate=null;if(caseHistory.sessions.forEach(function(session){var sessionTimestamp=commonUtilService.fixTimestamp(session.created_time);if(!lastDate||!commonUtilService.areDatesEqual(lastDate,sessionTimestamp)){var dateMsg={event:"date-message",history:!0,date:sessionTimestamp,sessionId:session.sessionId};clientChatUiAppendLog(dateMsg),lastDate=sessionTimestamp}historySessionHandler(session)}),lastDate){var now=new Date,sessionId=sessionStorage.getItem("sp-chat-session");if(!commonUtilService.areDatesEqual(lastDate,now)){var dateMsg={event:"date-message",history:!0,date:Date.now(),sessionId:sessionId};clientChatUiAppendLog(dateMsg)}}setTimeout(persistentChat.fixHistoryMessagesRaw)}}(),chatApiSessionCheckSessionExists=function(cp,sessionId){var historyEndpoint="chats/"+sessionId+"/history?tenantUrl="+encodeURIComponent(cp.tenantUrl);return chatApiSessionSendXhr(cp,historyEndpoint,"GET")},chatApiSessionCreateSession=function(cp){var lastInvocationTime=localStorage.getItem("bp-chat-start-last-invocation-time"),newInvocationTime=Date.now();if(!(lastInvocationTime&&newInvocationTime<Number(lastInvocationTime)+1e3)){localStorage.setItem("bp-chat-start-last-invocation-time",newInvocationTime),chatApiSessionVariables.logging=cp.parameters.logging;var endpoint="chats?tenantUrl="+encodeURIComponent(cp.tenantUrl),requestPayload={phone_number:cp.phone_number,from:cp.from,parameters:cp.parameters};return cp.initialMessage&&(requestPayload.initial_message=cp.initialMessage),chatApiSessionSendXhr(cp,endpoint,"POST",requestPayload).pipe(function(r){return r.session=chatApiSessionCreateSessionHandler(cp,r),r})}console.error("Attempt to start a chat twice in 1 second")},chatApiSessionCreateSessionHandler=function(cp,r){var textFormId,helpers=chatApiSessionCreateSessionHandlerHelpers(),pendingEventsQueue=[];function onLogEvent(msg){var sessionId=sessionStorage.getItem("sp-chat-session");msg.sessionId=sessionId,"new"===commonUtilService.getIncomingEventStatus(msg)&&persistentChat.addMessageToChatHistory(msg),o.uiCallbacks.onLogEvent(msg)}persistentChat.onHistoryLoaded(function(){for(var i=0;i<pendingEventsQueue.length;++i)o.handleEvent(pendingEventsQueue[i]);pendingEventsQueue=[]});var savedMsgId=Number(localStorage.getItem("bp-sent-message-id")),initialMsgId=savedMsgId&&!isNaN(savedMsgId)?savedMsgId:1;function incrementMsgId(){o.msgId=o.msgId+2,localStorage.setItem("bp-sent-message-id",o.msgId)}var o={parties:{},displayName:"me",status:r.state,sessionId:r.chat_id,msgId:initialMsgId,cp:cp,handleEvent:function(msg){switch(chatApiSessionPrintToConsole("Event received",msg),persistentChat.isEnabled()&&!persistentChat.isHistoryLoaded()&&pendingEventsQueue.push(msg),msg.event){case commonConstants.events.chat.session.INFO:o.serviceName=msg.service_name;break;case commonConstants.events.chat.session.STATUS:helpers.changeSessionState(o,msg.state);break;case commonConstants.events.chat.session.NETWORK_CONNECTION_ERROR:msg.fromClass="sys",msg.fromName=o.entryName,onLogEvent(msg),o.uiCallbacks.hideChatInput&&o.uiCallbacks.hideChatInput();break;case commonConstants.events.chat.session.NETWORK_CONNECTION_ESTABLISHED:msg.fromClass="sys",msg.fromName=o.entryName,onLogEvent(msg),o.sessionEnded||o.uiCallbacks.showChatInput();break;case commonConstants.events.chat.session.ENDED:o.sessionEnded=!0,o.internalParty=void 0,o.webRTC&&o.webRTC.closeConnection(),msg.fromClass="sys",msg.fromName=o.entryName,onLogEvent(msg),o.uiCallbacks.onSessionEnded();break;case commonConstants.events.chat.session.TYPING:o.uiCallbacks.onSessionTyping(o.parties[msg.party_id]);break;case commonConstants.events.chat.session.FORM_SHOW:""===msg.form_name&&(textFormId=msg.form_request_id),o.uiCallbacks.onFormShow(msg);break;case commonConstants.events.chat.session.SECURE_FORM_SHOW:onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.NOT_TYPING:o.uiCallbacks.onSessionNotTyping(o.parties[msg.party_id]);break;case commonConstants.events.chat.session.PARTY_JOINED:var p=helpers.buildParty(o,msg);helpers.detectParty(o),onLogEvent(helpers.preparePartyLogEvent(o,msg,p));var definition=widgetConfiguration.getDefinition();if(definition&&definition.chatWidgetStyling){var sound=new Audio(definition.chatWidgetStyling.agentJoinSoundUrl);if(sound)try{var deffered=sound.play();deffered&&deffered.then(function(){},function(error){console.warn(error)})}catch(e){console.error(e)}}o.videocallAutostarted||"internal"!=p.type||"true"!=clientChatPageGetUrlVars(window.location.href).autostartVideocall||o.uiCallbacks.onAutostartVideocall(o,p);break;case commonConstants.events.chat.session.PARTY_LEFT:var party=o.parties[msg.party_id];delete o.parties[msg.party_id],helpers.detectParty(o),onLogEvent(helpers.preparePartyLogEvent(o,msg,party));break;case commonConstants.events.chat.session.MESSAGE:msg.fromClass="session_msg",onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.FILE:setTimeout(function(){msg.party_id=msg.party_id||o.sessionId,msg.fileUrl=o.cp.url+"/chats/"+o.sessionId+"/files/"+msg.file_id,onLogEvent(helpers.prepareLogEvent(o,msg))},700);break;case commonConstants.events.chat.session.TIMEOUT_WARNING:msg.fromClass="sys",onLogEvent(helpers.prepareLogEvent(o,msg));break;case commonConstants.events.chat.session.INACTIVITY_TIMEOUT:o.internalParty=void 0,msg.fromClass="sys",onLogEvent(helpers.prepareLogEvent(o,msg)),o.sessionEnded=!0,o.webRTC&&o.webRTC.closeConnection(),o.sessionStatus="failed",o.uiCallbacks.onSessionEnded();break;case commonConstants.events.chat.session.SIGNALING:helpers.handleSignaling(o,msg);break;case commonConstants.events.chat.session.COBROWSING_REQUESTED:"new"===commonUtilService.getIncomingEventStatus(msg)&&window.parent.postMessage("bp-cobrowsing-requested","*"),msg.fromClass="sys",onLogEvent(msg);break;case commonConstants.events.chat.session.COBROWSING_REJECTED:case commonConstants.events.chat.session.COBROWSING_STARTED:case commonConstants.events.chat.session.COBROWSING_ENDED:msg.fromClass="sys",onLogEvent(msg);break;case commonConstants.events.chat.session.CASE_SET:o.getCaseHistory(msg.case_id)}},getProfilePhotoUrl:function(partyId){return partyId?o.cp.url+"/chats/"+o.sessionId+"/profilephotos/"+partyId:o.cp.url+"/chats/"+o.sessionId+"/chaticon"},getHistory:function(){sessionStorage.removeItem("showForm");var historyEndpoint="chats/"+o.sessionId+"/history?tenantUrl="+encodeURIComponent(cp.tenantUrl);return chatApiSessionSendXhr(cp,historyEndpoint,"GET").pipe(function(history){var offerRtc=chatApiSessionHandleHistoryEvents(history,o);offerRtc&&(window.chatSession.callPrompt=$("#call-prompt"),o.webRTCSignaling(offerRtc.party_id).requestCall(offerRtc.data.offerVideo))})},getCaseHistory:function(caseId){if(caseId){var caseHistoryEndpoint="chats/"+o.sessionId+"/casehistory?tenantUrl="+encodeURIComponent(cp.tenantUrl);return chatApiSessionSendXhr(cp,caseHistoryEndpoint,"GET").pipe(function(caseHistory){caseHistoryHandler(caseHistory,helpers,o.uiCallbacks.onLogEvent)})}},send:function(msg,options){var escapedMessage=escapeHTML(msg),m={event:commonConstants.events.chat.session.MESSAGE,party_id:o.sessionId,msg:escapedMessage,msg_id:""+o.msgId,timestamp:Math.round(Date.now()/1e3).toString()};if(m.options=options,onLogEvent(helpers.prepareLogEvent(o,m)),textFormId){var data={};data.text=escapedMessage,o.sendFormData(textFormId,"",data),textFormId=void 0}var eventBody={event:commonConstants.events.chat.session.MESSAGE,msg:escapedMessage,msg_id:""+o.msgId};options&&options.alternateMsg&&"cobrowsing"===options.alternateMsg.type&&(eventBody.type="cobrowsing"),helpers.sendEvent(cp,o,eventBody),incrementMsgId()},sendLocation:function(latitude,longitude){helpers.sendEvent(cp,o,{event:commonConstants.events.chat.session.LOCATION,latitude:latitude,longitude:longitude,msg_id:""+o.msgId}),incrementMsgId()},sendNavigation:function(page,title){helpers.sendEvent(cp,o,{event:commonConstants.events.chat.session.NAVIGATION,page:page,title:title,msg_id:""+o.msgId}),incrementMsgId()},sendFormData:function(formRequestId,formName,formData){var msg={event:commonConstants.events.chat.session.FORM_DATA,form_request_id:formRequestId,form_name:formName,data:formData};chatApiSessionPrintToConsole("Message sent",msg),helpers.sendEvent(cp,o,msg),o.uiCallbacks.onFormSent()},sendSecureFormData:function(formRequestId,formName,formData){var msg={event:commonConstants.events.chat.session.SECURE_FORM_DATA,form_request_id:formRequestId,form_name:formName,data:formData};chatApiSessionPrintToConsole("Message sent",msg),helpers.sendEvent(cp,o,msg),o.uiCallbacks.onFormSent()},cancelSecureForm:function(formRequestId,formName){var msg={event:commonConstants.events.chat.session.SECURE_FORM_CANCEL,form_request_id:formRequestId,form_name:formName};chatApiSessionPrintToConsole("Message sent",msg),helpers.sendEvent(cp,o,msg),o.uiCallbacks.onFormSent(msg)},cancelFormData:function(formRequestId,formName){var msg={event:commonConstants.events.chat.session.FORM_DATA_CANCEL,form_request_id:formRequestId,form_name:formName};chatApiSessionPrintToConsole("Message sent",msg),helpers.sendEvent(cp,o,msg),o.uiCallbacks.onFormSent(msg)},sendTyping:function(message){helpers.sendEvent(cp,o,{event:commonConstants.events.chat.session.TYPING,msg:message})},sendNotTyping:function(){helpers.sendEvent(cp,o,{event:commonConstants.events.chat.session.NOT_TYPING})},endSession:function(){var msg={event:commonConstants.events.chat.session.END};chatApiSessionPrintToConsole("end session",msg),o.webRTC&&o.webRTC.closeConnection(),helpers.sendEvent(cp,o,msg)},disconnectSession:function(){var msg={event:commonConstants.events.chat.session.DISCONNECT};chatApiSessionPrintToConsole("Message sent",msg),o.webRTC&&o.webRTC.closeConnection(),helpers.sendEvent(cp,o,msg)},fileUploaded:function(fileId,fileType,fileName){var event={event:commonConstants.events.chat.session.FILE,msg_id:""+o.msgId,file_id:fileId,file_type:fileType,file_name:fileName};helpers.sendEvent(cp,o,event),o.handleEvent(event),incrementMsgId()},sendCobrowsingRejected:function(){var event={event:commonConstants.events.chat.session.COBROWSING_REJECTED};onLogEvent(helpers.prepareLogEvent(o,{event:commonConstants.events.chat.session.COBROWSING_REJECTED,fromClass:"sys"})),helpers.sendEvent(cp,o,event)},sendCobrowsingStarted:function(provider,url,sessionId){var event={event:commonConstants.events.chat.session.COBROWSING_STARTED,provider_type:provider,cobrowsing_url:url,cobrowsing_id:sessionId};onLogEvent(helpers.prepareLogEvent(o,{event:commonConstants.events.chat.session.COBROWSING_STARTED,fromClass:"sys"})),helpers.sendEvent(cp,o,event)},sendCobrowsingEnded:function(){var event={event:commonConstants.events.chat.session.COBROWSING_ENDED};onLogEvent(helpers.prepareLogEvent(o,{event:commonConstants.events.chat.session.COBROWSING_ENDED,fromClass:"sys"})),helpers.sendEvent(cp,o,event)},webRTCSignaling:function(party_id){var send=function(data){helpers.sendEvent(cp,o,{event:commonConstants.events.chat.session.SIGNALING,msg_id:""+o.msgId,destination_party_id:party_id,data:data}),incrementMsgId()};return{requestCall:function(offerVideo){o.callPrompt&&o.callPrompt.css("display","block"),send({type:"REQUEST_CALL",offerVideo:offerVideo})},answerCall:function(sdp){send({type:"ANSWER_CALL",sdp:sdp})},offerCall:function(sdp){chatApiSessionPrintToConsole("send offer"),send({type:"OFFER_CALL",sdp:sdp})},sendIceCandidate:function(candidate){send({type:"ICE_CANDIDATE",candidate:candidate.candidate,sdpMid:candidate.sdpMid,sdpMLineIndex:candidate.sdpMLineIndex})},endCall:function(){send({type:"END_CALL"})},rejectCall:function(){send({type:"CALL_REJECTED"})}}},webRTCSession:function(remoteSdp,offerVideo,party_id){if(commonUtilService.isIE())console.warn("WebRTC is not supported in Internet Explorer");else{var PeerConnection=window.RTCPeerConnection,IceCandidate=window.RTCIceCandidate,SessionDescription=window.RTCSessionDescription,signaling=o.webRTCSignaling(party_id),onError=function(err){chatApiSessionPrintToConsole("Error",err),toggleCallPrompt(!1),toggleCallControls(!1)},definition=widgetConfiguration.getDefinition();if(definition&&definition.chatWidgetStyling&&definition.chatWidgetStyling.videoCallEnabled){var videoEnabled=widgetConfiguration.isVisitorVideoEnabled(),iceServers=sessionStorage.getItem("iceServersConfiguration");iceServers?(iceServers=JSON.parse(iceServers)).forEach(function(iceServer){iceServer.url&&(iceServer.urls=iceServer.url,delete iceServer.url)}):iceServers=[];var pc=new PeerConnection({iceServers:iceServers});pc.onicecandidate=function(event){chatApiSessionPrintToConsole("onicecandidate %o",event),event.candidate&&signaling.sendIceCandidate(event.candidate)},pc.ontrack=function(ev){chatApiSessionPrintToConsole("onaddstream",ev),ev.streams&&ev.streams[0]&&o.uiCallbacks.onAddStream(ev.streams[0])};var localStream,hasSDP=!1,iceCandidateList=[],offerReceived=function(sdp){chatApiSessionPrintToConsole("offerReceived set remote description"),pc.setRemoteDescription(new SessionDescription({type:"offer",sdp:sdp})).then(function(){chatApiSessionPrintToConsole("setRemoteDescription success"),toggleCallConfirmationDialog(!1),toggleInCallControls(!0),offerVideo?(htmlUtilService.displayBlock($("#myCam")),htmlUtilService.displayBlock($("#video")),unmuteVideo()):$("#call-controls_mute-video").addClass("off"),updateChatView()}).catch(onError)},addIceCandidate=function(candidate){chatApiSessionPrintToConsole("addIceCandidate",candidate),hasSDP?pc.addIceCandidate(new IceCandidate(candidate)).then(function(){chatApiSessionPrintToConsole("addIceCandidate success")}).catch(onError):iceCandidateList.push(candidate)},closeConnection=function(){signaling.endCall(),$("#video").hide(),toggleCallPrompt(!1),toggleCallControls(!1),toggleCallConfirmationDialog(!1),toggleInCallControls(!1);try{pc.close()}catch(e){}try{localStream.getTracks().forEach(function(track){track.stop()})}catch(e){}pc=void 0},updateTracks=function(kind,value){localStream.getTracks().forEach(function(track){track.kind===kind&&(track.enabled=value)})},updateChatView=function(){var $preCallControls=$("#call-controls_before-call"),$inCallControls=$("#call-controls_in-call"),$video=$("#video"),value=0;$preCallControls.is(":visible")?value+=98:$inCallControls.is(":visible")&&(value+=66),value&&$video.is(":visible")&&(value+=230),$("#servicepattern-chat").css("top",value),clientChatPageUpdateScrollbar()},unmuteVideo=function(){updateTracks("video",!0)},toggleCallPrompt=function(isShown){chatApiSessionPrintToConsole("toggleCallPrompt: "+(isShown?"show":"hide")),o.callPrompt&&(o.callPrompt.css("display",isShown?"block":"none"),$("#callMe").css("display",isShown?"none":"block"))},toggleCallControls=function(isShown){chatApiSessionPrintToConsole("toggleCallControls: "+(isShown?"show":"hide")),$("#call-controls").css("display",isShown?"block":"none"),$("#callMe").css("display",isShown?"none":"block"),updateChatView()},toggleCallConfirmationDialog=function(isShown){chatApiSessionPrintToConsole("toggleCallConfirmationDialog: "+(isShown?"show":"hide")),$("#call-controls_before-call").css("display",isShown?"block":"none").find("span:first-child").text(offerVideo?"video":"audio")},toggleInCallControls=function(isShown){chatApiSessionPrintToConsole("toggleInCallControls: "+(isShown?"show":"hide")),$("#call-controls_in-call").css("display",isShown?"block":"none")};return o.webRTC={callConfirmed:function(){chatApiSessionPrintToConsole("callConfirmed"),new Promise(function(resolve,reject){videoEnabled?navigator.mediaDevices.getUserMedia({video:!0}).then(function(){resolve(!0)}).catch(function(){resolve(!1)}):resolve(!1)}).then(function(videoAccess){navigator.mediaDevices.getUserMedia({audio:!0,video:videoAccess}).then(function(stream){toggleCallPrompt(!1),localStream=stream;try{stream.getTracks().forEach(function(track){pc.addTrack(track,stream)})}catch(e){}o.uiCallbacks.onAddLocalStream(stream),remoteSdp?(chatApiSessionPrintToConsole("createAnswer"),offerReceived(remoteSdp),pc.createAnswer().then(function(data){pc.setLocalDescription(data).then(function(){hasSDP=!0,iceCandidateList.forEach(addIceCandidate),signaling.answerCall(data.sdp)}).catch(onError)}).catch(onError)):(chatApiSessionPrintToConsole("create offer"),pc.createOffer().then(function(data){pc.setLocalDescription(data).then(function(){hasSDP=!0,signaling.offerCall(data.sdp)}).catch(onError)}).catch(onError))}).catch(onError)})},callRejected:function(){chatApiSessionPrintToConsole("callRejected"),signaling.rejectCall(),closeConnection()},offerReceived:offerReceived,answerReceived:function(sdp){chatApiSessionPrintToConsole("answer received set remote description "),pc.setRemoteDescription(new SessionDescription({type:"answer",sdp:sdp})).then(function(){chatApiSessionPrintToConsole("setRemoteDescription success")}).catch(onError)},addIceCandidate:addIceCandidate,closeConnection:closeConnection,muteAudio:function(){updateTracks("audio",!1)},unmuteAudio:function(){updateTracks("audio",!0)},muteVideo:function(){updateTracks("video",!1)},unmuteVideo:unmuteVideo,toggleCallPrompt:toggleCallPrompt,toggleCallControls:toggleCallControls,toggleCallConfirmationDialog:toggleCallConfirmationDialog,toggleInCallControls:toggleInCallControls,updateChatView:updateChatView},o.webRTC}}},assignUICallbacks:function(a){var cb=a||{};o.uiCallbacks={},o.uiCallbacks.onChatQueued=cb.onChatQueued||helpers.noop,o.uiCallbacks.onChatConnected=cb.onChatConnected||helpers.noop,o.uiCallbacks.onSessionEnded=cb.onSessionEnded||helpers.noop,o.uiCallbacks.onLogEvent=cb.onLogEvent||helpers.noop,o.uiCallbacks.onSessionTyping=function(party){party&&cb.onSessionTyping&&cb.onSessionTyping(party)},o.uiCallbacks.onSessionNotTyping=function(party){party&&cb.onSessionNotTyping&&cb.onSessionNotTyping(party)},o.uiCallbacks.onFormShow=cb.onFormShow||helpers.noop,o.uiCallbacks.onFormSent=cb.onFormSent||helpers.noop,o.uiCallbacks.onCallConfirm=cb.onCallConfirm||helpers.noop,o.uiCallbacks.onAddStream=cb.onAddStream||helpers.noop,o.uiCallbacks.onAddLocalStream=cb.onAddLocalStream||helpers.noop,o.uiCallbacks.onAutostartVideocall=cb.onAutostartVideocall||helpers.noop},reassignUICallbacks:function(a){if(o.uiCallbacks){var cb=a||{};cb.onChatQueued&&(o.uiCallbacks.onChatQueued=cb.onChatQueued),cb.onChatConnected&&(o.uiCallbacks.onChatConnected=cb.onChatConnected),cb.onSessionEnded&&(o.uiCallbacks.onSessionEnded=cb.onSessionEnded),cb.onLogEvent&&(o.uiCallbacks.onLogEvent=cb.onLogEvent),cb.onSessionTyping&&(o.uiCallbacks.onSessionTyping=function(party){party&&cb.onSessionTyping(party)}),cb.hideChatInput&&(o.uiCallbacks.hideChatInput=function(){cb.hideChatInput()}),cb.showChatInput&&(o.uiCallbacks.showChatInput=function(){cb.showChatInput()}),cb.onSessionNotTyping&&(o.uiCallbacks.onSessionNotTyping=function(party){party&&cb.onSessionNotTyping(party)}),cb.onFormShow&&(o.uiCallbacks.onFormShow=cb.onFormShow),cb.onFormSent&&(o.uiCallbacks.onFormSent=cb.onFormSent),cb.onAddStream&&(o.uiCallbacks.onAddStream=cb.onAddStream),cb.onAddLocalStream&&(o.uiCallbacks.onAddLocalStream=cb.onAddLocalStream)}else o.assignUICallbacks(a)}};return o.assignUICallbacks(null),chatApiSessionStartPoll(cp,o),o},chatApiSessionCreateSessionHandlerHelpers=function(){return{sendEvent:function(cp,o,event){var endpoint="chats/"+o.sessionId+"/events?tenantUrl="+encodeURIComponent(cp.tenantUrl);return chatApiSessionSendXhr(cp,endpoint,"POST",{events:[event]})},changeSessionState:function(o,state){switch(o.sessionStatus=state,state){case"failed":o.sessionEnded=!0,o.webRTC&&o.webRTC.closeConnection(),o.uiCallbacks.onSessionEnded();break;case"queued":o.uiCallbacks.onChatQueued();break;case"connected":o.uiCallbacks.onChatConnected()}},handleSignaling:function(o,msg){var type=msg.data.type,offerVideo="true"===msg.data.offerVideo;switch(type){case"OFFER_CALL":o.webRTCSession(msg.data.sdp,offerVideo,msg.party_id),o.callPrompt&&o.callPrompt.is(":visible")?o.webRTC.callConfirmed():o.webRTC.toggleCallConfirmationDialog(!0),o.webRTC&&o.webRTC.toggleCallControls(!0);break;case"ANSWER_CALL":o.webRTC&&o.webRTC.answerReceived(msg.data.sdp);break;case"ICE_CANDIDATE":o.webRTC&&o.webRTC.addIceCandidate(msg.data);break;case"END_CALL":o.webRTC&&o.webRTC.closeConnection()}},buildParty:function(o,msg){var p={id:msg.party_id,type:msg.type,firstName:msg.first_name,lastName:msg.last_name,displayName:msg.display_name};return o.parties[p.id]=p,p},detectParty:function(o){for(var prop in o.scenarioParty=void 0,o.internalParty=void 0,o.parties)if(o.parties.hasOwnProperty(prop)){var p=o.parties[prop];switch(p.type){case"scenario":o.scenarioParty=p;break;case"internal":o.internalParty=p}}},prepareLogEvent:function(o,msg){if(msg.party_id===o.sessionId)msg.fromClass="me",msg.fromName=o.displayName;else{var party=o.parties[msg.party_id],snippetConfig=widgetConfiguration.getSnippet();if(snippetConfig&&snippetConfig.contactTab&&snippetConfig.contactTab.iconUrl?msg.profilePhotoUrl=snippetConfig.contactTab.iconUrl:msg.profilePhotoUrl="none",msg.fromName="",party)switch(party.type){case"scenario":msg.fromClass="agent",msg.fromName=party.displayName?party.displayName:"";break;default:msg.fromClass="agent",msg.profilePhotoUrl=o.getProfilePhotoUrl(party.id),msg.fromName=party.displayName?party.displayName:"Rep"}}return msg},preparePartyLogEvent:function(o,event,party){return event.fromClass="sys",!party||"internal"!==party.type&&"msteams"!==party.type?{fromClass:"sys"}:(event.fromName=party.displayName,event.firstName=party.firstName,event.lastName=party.lastName,event.profilePhotoUrl=o.getProfilePhotoUrl(party.id),event)},noop:function(){}}},escapeHTML=function(msg){let tempDiv=document.createElement("div");return tempDiv.innerHTML=msg,escapeRecursive(document.createElement("div"),tempDiv.childNodes).innerHTML},escapeRecursive=function(result,childNodes){return 0===childNodes.length?result:([].forEach.call(childNodes,function(node){switch(node.nodeName){case"A":let a,href=node.href;isValidHrefAttribute(href)?((a=document.createElement("a")).setAttribute("href",encodeURI(href)),a.setAttribute("target","_blank"),a.innerText=node.innerText):a=node.innerText,result.appendChild(a);break;case"BR":var br=document.createElement("br");result.appendChild(br);break;case"#text":var tmpDiv=document.createElement("div");tmpDiv.innerText=node.nodeValue,tmpDiv.childNodes.length>1?escapeRecursive(result,tmpDiv.childNodes):result.appendChild(tmpDiv.childNodes[0]);break;case"DIV":if(commonUtilService.isSafari()){br=document.createElement("br");result.appendChild(br),1===node.childNodes.length&&"BR"===node.childNodes[0].nodeName||escapeRecursive(result,node.childNodes)}break;default:escapeRecursive(result,node.childNodes)}}),result)},isValidHrefAttribute=function(href){return isValidProtocol(href)&&isValidHost(href)||isValidEmailAddress(href)},isValidProtocol=function(href){return!!href.match(/^((https?|ftp):\/\/|\.{0,2}\/)/)},isValidHost=function(href){let a=document.createElement("a");return a.href=href,!!a.host},isValidEmailAddress=function(href){return!!href.match(/^mailto:[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/)},chatApiSessionHandleEvents=function(r,session){if(r.events)for(var i=0;i<r.events.length;i++)session.handleEvent(r.events[i])},chatApiSessionHandleHistoryEvents=function(r,session){var offerRtc=null;if(session.historyReceived=!0,r.events){var currentSessionId=sessionStorage.getItem("sp-chat-session");persistentChat.removeSessionMessages(currentSessionId);var i,n,event,timeout=!1;for(i=0,n=r.events.length;i<n;++i)event=r.events[i],timeout||"chat_session_inactivity_timeout"!==event.event||(timeout=!0);for(i=0,n=r.events.length;i<n;++i)if((event=r.events[i]).sessionHistory=!0,"chat_session_signaling"===event.event){var type=event.data.type;"OFFER_CALL"===type?offerRtc=event:"END_CALL"===type&&(offerRtc=!1)}else if("chat_session_form_show"===event.event&&r.events.indexOf(event)!==r.events.length-1){for(var onlyNavAfterForm=!0,j=r.events.indexOf(event)+1;j<r.events.length;j++)"chat_session_navigation"!==r.events[j].event&&(onlyNavAfterForm=!1);(timeout||onlyNavAfterForm)&&session.handleEvent(event)}else session.handleEvent(event)}return session.historyRendered=!0,offerRtc},chatApiSessionPrepareRequest=function(cp,endpoint,method){var xhrOptions={type:method,url:cp.url+"/"+endpoint+"&timestamp="+(new Date).getTime(),headers:{Authorization:'MOBILE-API-140-327-PLAIN appId="'+cp.appId+'", clientId="'+cp.clientId+'"'}};return cp.crossDomain&&(xhrOptions.crossDomain=!0,xhrOptions.xhrFields={withCredentials:!0}),xhrOptions},chatApiSessionPrintToConsole=function(a,b){chatApiSessionVariables.logging&&"undefined"!=typeof console&&(void 0!==b?console.log(a+" %o",b):console.log(a))},chatApiSessionSendXhr=function(cp,endpoint,method,data){var xhrOptions=chatApiSessionPrepareRequest(cp,endpoint,method);return data&&("[object FormData]"===data.toString()?(xhrOptions.data=data,xhrOptions.contentType=!1,xhrOptions.processData=!1):(xhrOptions.data=JSON.stringify(data),xhrOptions.contentType="application/json; charset=utf-8",xhrOptions.dataType="json")),jQuery.ajax(xhrOptions)},chatApiSessionStartPoll=function(cp,session){var lastPollRequest=null,isNetworkAvailable=!0;function checkAndUpdateNetworkConnectionStatus(isConnected){isConnected?isNetworkAvailable||(isNetworkAvailable=!0,session.handleEvent({event:commonConstants.events.chat.session.NETWORK_CONNECTION_ESTABLISHED})):(isNetworkAvailable&&session.handleEvent({event:commonConstants.events.chat.session.NETWORK_CONNECTION_ERROR}),isNetworkAvailable=!1)}!function poll(){var timeout=window.setTimeout(function(){lastPollRequest&&!session.sessionEnded&&(lastPollRequest.abort(),lastPollRequest=null),timeout=null,poll()},13e3);var endpoint="chats/"+session.sessionId+"/events?tenantUrl="+encodeURIComponent(cp.tenantUrl);lastPollRequest=chatApiSessionSendXhr(cp,endpoint,"GET");return lastPollRequest.done(function(r){checkAndUpdateNetworkConnectionStatus(!0),chatApiSessionHandleEvents(r,session),timeout&&(window.clearTimeout(timeout),session.sessionEnded||poll())}).fail(function(xhr,err){var jqXHR,isBlocked;jqXHR=xhr,isBlocked="true"===sessionStorage.getItem("blockConnectionInterruptCheck"),0===jqXHR.status&&"abort"===jqXHR.statusText&&(isBlocked?sessionStorage.setItem("blockConnectionInterruptCheck",!1):checkAndUpdateNetworkConnectionStatus(!1)),xhr.responseJSON&&"5005"===xhr.responseJSON.error_code&&(session.handleEvent({event:commonConstants.events.chat.session.INACTIVITY_TIMEOUT}),window.clearTimeout(timeout))})}()},chatApiSessionVariables={logging:!1,textFormId:void 0},clientChatPageConfigurationChat=function(data,_styles){var lmConfig,win,frameHeight,variables=clientChatPageVariables,connection=clientChatPageConnection(),previewMode=widgetConfiguration.isPreviewMode(),chatUrl=widgetConfiguration.getChatPath(),i18n=clientChatUiI18n(),store=window.sessionStorage,confObj=widgetConfiguration.getObject(),snippetConfig=widgetConfiguration.getSnippet(),poConfig=widgetConfiguration.getProactiveOffer(),customFormConfig=widgetConfiguration.getForm(),styles=previewMode?JSON.parse(sessionStorage.getItem("styles")):confObj.styles,comparsion=!previewMode||"chat_styling"===confObj.widgetType,cwConfig=previewMode?confObj:(confObj.definition||{}).chatWidgetStyling||{},fullConf=widgetConfiguration.getFullConfigurationObject();previewMode&&(lmConfig=confObj.leaveMessage,poConfig=confObj,snippetConfig=confObj,customFormConfig=confObj,win=window),snippetConfig&&(lmConfig=snippetConfig.leaveMessage,win=window.parent),poConfig&&(win=window.parent);var showAgentPic,pcConfig=snippetConfig&&snippetConfig.preChat?snippetConfig.preChat:"",sourceObj="proactive"===store.getItem("source")&&commonUtilService.stringIsTrue(store.getItem("serviceAvailable"))?poConfig.preChat:pcConfig;function getFrameHeight(configHeight,innerHeight){return Math.min.apply(Math,[configHeight,innerHeight-20])}function submitCustomFormData(data){var chatSession=window.chatSession;sendFormData(chatSession.sendSecureFormData,chatSession.sendFormData,variables,data)}function cancelCustomFormData(data){var chatSession=window.chatSession;sendFormData(chatSession.sendSecureFormData,chatSession.sendFormData,variables,data)}function sendFormData(secureFormCallback,formCallback,variables,data){var requestId=variables.currentFormRequestId,formName=variables.currentFormName;$customForm.hasClass("secure")?secureFormCallback(requestId,formName,data):formCallback(requestId,formName,data)}function formOnHide(formName,customFormCallback,data){htmlUtilService.displayNone($("#offline-form"));var form=function(formName){var form;switch(formName){case"preChatForm":form=$("#preChatForm");break;case"questionForm":form=$("#questionForm");break;case"unavailableForm":form=$("#unavailableForm");break;case"customForm":form=$("#customForm")}return form}(formName);"customForm"===formName?(customFormCallback(data),$(".custom-form-fields").scrollTop(0),htmlUtilService.displayNone($customForm),$("#agent-name").text($("#agent-name").attr("data-original-name")),$("#agent-name").attr("data-original-name",""),$("#header-avatar-container .avatar").css({display:""}),clientChatPageUpdateScrollbar()):(connection.connect(),htmlUtilService.displayNone(form))}function getErrorBalloons(context){return $(context).find(".error-balloon")}function setCallChatButton(buttonClass,isButtonEnabled,buttonText){isButtonEnabled?$(".sp-callback-form").append('<button id="sp-callback-submit" class="'+buttonClass+'">'+buttonText+"</button>"):$("."+buttonClass).remove()}function isCaptchaValid(field){return function(field){var captcha="";return $(field).find("table.captcha td").each(function(){captcha+=$(this).text()}),captcha}(field)===$(field).find("input").val()}function validateAndUpdateFields(fields,data){var result={isValid:!0};return fields.each(function(){var $input=function(context){var $input;switch($(context).attr("class")){case"field-wrapper field-radio":$input=$(context).find("input:checked");break;case"field-wrapper field-multiline":$input=$(context).find("textarea");break;case"field-wrapper field-select":$input=$(context).find("select");break;default:$input=$(context).find("input")}return $input}(this),key=$input.attr("name"),type=$input.attr("type"),message=i18n.requiredField;if("captcha_text"!==key){var val=$input.val()||"",noError=val&&val.length>0&&$(this).find(".error-balloon").length>0||!$input.prop("required");"field-wrapper field-radio"===this.className&&(noError=!(0==$(this).find("input:checked").length&&$(this).find(".error-balloon").length>0)),"field-wrapper field-select"===this.className&&(noError=!(0==$(this).find("option:selected").val().length&&$(this).find(".error-balloon").length>0&&$(this).find("select[required]").length>0));var validationRequired=commonUtilService.stringIsTrue($input.attr("data-validate"));if(("tel"===type||"email"===type||"datetime"===type)&&noError&&$input.val()&&validationRequired){var isValid=!0;"tel"===type&&(isValid=commonUtilService.validatePhoneNumber($input.val())),"email"===type&&(isValid=commonUtilService.validateEmail($input.val())),"datetime"===type&&(isValid=commonUtilService.validateDate($input.val())),isValid||(message=i18n.invalidInputField,noError=!1)}noError?(getErrorBalloons(this).hide(),variables.cp.parameters[key]=data[key]=val,variables.cp[key]?variables.cp[key]=val:"phone"===key&&(variables.cp.phone_number=val)):(!function(context,message){var errorBalloons=getErrorBalloons(context);message&&errorBalloons.text(message),errorBalloons.show()}(this,message),result.isValid=!1)}else isCaptchaValid(this)||(htmlUtilService.displayBlock($("#error-captcha")),result.isValid=!1)}),result}function appendTip(elementSelector,tipId){if(htmlUtilService.hasElementRequiredFields(elementSelector)){var elementParent=$(elementSelector+' *[required="true"]').parents(elementSelector),tip=$("#"+tipId);elementParent.length>0&&0===tip.length&&elementParent.append('<div id="'+tipId+'" class="reqDescr">'+i18n.refersToRequiredFields+"</div>")}}(function(){var key=+new Date+""+Math.random();try{var global=window.parent;return global[key]="asd","asd"===global[key]}catch(e){return!1}})()||(win=window),fullConf&&fullConf.widget&&fullConf.widget.chatWidgetStyling&&(showAgentPic=fullConf.widget.chatWidgetStyling.showAgentPic),comparsion&&(showAgentPic=cwConfig.showAgentPic);var $query=$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions");switch(showAgentPic){case"none":default:$query.addClass("narrow");break;case"always_default":case"show":$query.removeClass("narrow")}var $spChatFrame=$("#sp-chat-frame"),$messagesDiv=$("#messages-div"),$headerAvatar=$("#header-avatar .avatar"),$minHeaderAvatar=$("#min_agent_image"),$customForm=$("#customForm"),$cancelPreChatForm=$("#cancelPreChatForm");if(comparsion){switch("true"===sessionStorage.getItem("bp-minimized")||(widgetConfiguration.isMobile()?$spChatFrame.css({height:"100%",width:"100%"}):(frameHeight=Math.min.apply(Math,[cwConfig.height,win.innerHeight-20]),$spChatFrame.css({height:frameHeight,width:cwConfig.width}))),showAgentPic){case"none":$messagesDiv.addClass("noAgentImage"),$messagesDiv.removeClass("defaultAgentImage"),$headerAvatar.hide(),$minHeaderAvatar.hide();break;case"always_default":case"show":$headerAvatar.show(),$messagesDiv.removeClass("noAgentImage"),$messagesDiv.removeClass("defaultAgentImage"),previewMode&&$(".previewAgentImage").attr("style","background:url("+chatUrl+"images/man-with-glasses.jpg) center center no-repeat/contain;")}var $previewCallme=$("#preview #callMe");!1===cwConfig.videoCallEnabled?htmlUtilService.displayNone($previewCallme):htmlUtilService.displayFlex($previewCallme),!1===cwConfig.visitorVideoEnabled?($("#call-prompt .content").html(i18n.allowMicroPrompt),$("#call-prompt .error.camera").remove()):$("#call-prompt .content").html(i18n.allowMicroVideoPrompt),!1===cwConfig.fileUploadEnabled?($("#attachFile:not(.preview)").remove(),$("#attachFile.preview").hide(),$("#input-div").addClass("without_file")):($("#attachFile.preview").show(),$("#input-div").removeClass("without_file")),!1===cwConfig.emojiSelector?htmlUtilService.displayNone($(".emoji-picker")):htmlUtilService.displayBlock($(".emoji-picker")),!1===cwConfig.widgetMinimizationEnabled?htmlUtilService.displayNone($("#minimizeChat")):htmlUtilService.displayFlex($("#minimizeChat")),cwConfig.title&&($(".agent-name").text(cwConfig.title),$("#min_agent_name").text(cwConfig.title)),$("#notification-prompt .content").text(cwConfig.notificationsPrompt||i18n.notificationsPrompt),$("#input-field").attr("placeholder",cwConfig.hintMessageTextBox||i18n.hintMessageTextBox),$(".min-tab-wrapper > .sp-round-button").attr("title",cwConfig.showChatTooltip||i18n.showChatTooltip),$(".min-tab-wrapper > .min-chat-tab > .min-tab-content").attr("title",cwConfig.showChatTooltip||i18n.showChatTooltip),$("#callMe").attr("title",cwConfig.webRtcCallTooltip||i18n.webRtcCallTooltip),$("#switchVideo").attr("title",cwConfig.webRtcSwitchVideoTooltip||i18n.webRtcSwitchVideoTooltip),$("#shareScreen").attr("title",cwConfig.shareScreenTooltip||i18n.shareScreenTooltip),$("#minimizeChat").attr("title",cwConfig.minimizeChatTooltip||i18n.minimizeChatTooltip),$("#sp-close-frame").attr("title",cwConfig.endChatTooltip||i18n.endChatTooltip),$("i.emoji-picker").attr("title",cwConfig.emojiTooltip||i18n.emojiTooltip),$("#attachFile").attr("title",cwConfig.sendFileTooltip||i18n.sendFileTooltip),$("#min_dismiss_button").attr("title",cwConfig.minimizedDismissMessagesTooltip||i18n.minimizedDismissMessagesTooltip),$("#call-prompt > .error.camera").text(cwConfig.cameraNotDetectedText||i18n.cameraNotDetectedText),$("#call-prompt > .error.microphone").text(cwConfig.microNotDetectedText||i18n.microNotDetectedText),$("#surveyForm .serviceSurvey .description").text(cwConfig.surveyFormWasIssueResolvedQuestion||i18n.surveyFormWasIssueResolvedQuestion),$("#surveyForm .serviceSurvey input#service-1 + label").text(cwConfig.surveyFormWasIssueResolvedPositiveAnswer||i18n.surveyFormWasIssueResolvedPositiveAnswer),$("#surveyForm .serviceSurvey input#service-0 + label").text(cwConfig.surveyFormWasIssueResolvedNegativeAnswer||i18n.surveyFormWasIssueResolvedNegativeAnswer),$("#surveyForm .helpfulSurvey .description").text(cwConfig.surveyFormContactSatisfactionQuestion||i18n.surveyFormContactSatisfactionQuestion),$("#surveyForm .recommendSurvey .description").text(cwConfig.surveyFormNetPromoterScoreQuestion||i18n.surveyFormNetPromoterScoreQuestion),$("#surveyForm .transcriptSurvey .description").text(cwConfig.surveyFormSendChatTranscriptQuestion||i18n.surveyFormSendChatTranscriptQuestion),$("#surveyForm .emailSurvey .description").text(cwConfig.surveyFormEmailFieldLabel||i18n.surveyFormEmailFieldLabel),$("#surveyForm .emailSurvey .error-balloon").text(cwConfig.surveyFormEmailValidationErrorText||i18n.surveyFormEmailValidationErrorText),$(".agentJoinedMessage span").text(cwConfig.agentJoinedMessage),$(".inactivityWarningText span").text(cwConfig.inactivityWarningMessage),$(".inactivityTimeoutText span").text(cwConfig.inactivityTimeoutMessage),$(".sessionEndedText span").text(cwConfig.sessionEndedMessage),$(".agentLeftText span").text(cwConfig.agentLeftMessage),$(".chat_widget #agent-name").text(cwConfig.title),$("#min_agent_name").text(cwConfig.title)}if("form"===confObj.widgetType&&($("#custom_submit").val(confObj.submitButtonText),$("#custom_cancel").text(confObj.cancelButtonText)),"onPageForm"===confObj.widgetType&&(1===$(".sp-callback-form").length&&$("#preview .sp-callback-form").css("display","inline-block"),clientChatPageGenerateInputs(confObj.fields,".sp-callback-form"),setCallChatButton("chatButton",confObj.chatButtonEnabled,confObj.chatButtonText),setCallChatButton("callButton",confObj.callButtonEnabled,confObj.callButtonText)),sourceObj){if(sourceObj.enabled){var title,isCallButtonEnabled=sourceObj.callButtonEnabled,isChatButtonEnabled=sourceObj.chatButtonEnabled,submitPhone=$("#submitPhone"),submitChat=$("#submitChat"),$preChatForm=$("#preChatForm"),$preChatFormTabs=$preChatForm.find(".tabs");$preChatForm.removeClass(),$preChatForm.addClass("agent-message question__call-tab_hide question__chat-tab_hide question__call-tab_active question__chat-tab_active"),isCallButtonEnabled?$preChatForm.removeClass("question__call-tab_hide"):$preChatForm.removeClass("question__call-tab_active"),isChatButtonEnabled?$preChatForm.removeClass("question__chat-tab_hide"):$preChatForm.removeClass("question__chat-tab_active"),isCallButtonEnabled&&isChatButtonEnabled&&$preChatForm.removeClass("question__call-tab_active"),$preChatFormTabs.toggleClass("none",!isCallButtonEnabled||!isChatButtonEnabled),title=commonUtilService.isServiceNotAvailable()?lmConfig?lmConfig.title:"":sourceObj.title,$("#agent-name").html(title),$("#min_agent_name").html(title),submitPhone.val(sourceObj.callButtonText),$(".tabPhone span").text(sourceObj.callButtonText),submitChat.val(sourceObj.chatButtonText),$(".tabChat span").text(sourceObj.chatButtonText),!1===cwConfig.fileUploadEnabled?($("#attachFile:not(.preview)").remove(),$("#attachFile.preview").hide(),$("#input-div").addClass("without_file")):($("#attachFile.preview").show(),$("#input-div").removeClass("without_file")),!1===cwConfig.emojiSelector?htmlUtilService.displayNone($(".emoji-picker")):htmlUtilService.displayBlock($(".emoji-picker")),commonUtilService.isDefined(sourceObj.cancelButtonEnabled)&&!0===sourceObj.cancelButtonEnabled?($cancelPreChatForm.val(sourceObj.cancelButtonText),$cancelPreChatForm.css({display:"block"})):($("#cancelPreChatForm:not(.preview)").remove(),$("#cancelPreChatForm.preview").hide()),$cancelPreChatForm.on("click",function(){window.parent.postMessage("sp-pre-chat-form-cancel-button-clicked","*"),clientChatPageSafeEndSession()}),$("#submit").on("click",function(){submit("questionForm")}),submitChat.on("click",function(){window.parent.postMessage("sp-pre-chat-form-chat-button-clicked","*"),submit("preChatForm","chatFields")}),submitPhone.on("click",function(){window.parent.postMessage("sp-pre-chat-form-phone-button-clicked","*"),submit("preChatForm","phoneFields")}),clientChatPageGenerateInputs(sourceObj.commonFields,".commonFields"),clientChatPageGenerateInputs(sourceObj.chatFields,".chatFields"),clientChatPageGenerateInputs(sourceObj.phoneFields,".phoneFields"),appendTip(".questionFormInner","questionFormInnerReqDescr")}function submit(formName,className){var fields,form,formInner,globalNoError=!0,data={},questionFormInner=$(".questionFormInner");switch(formName){case"preChatForm":form=questionFormInner,formInner=questionFormInner,globalNoError=validateAndUpdateFields(fields=$("#preChatForm .commonFields .field-wrapper, #preChatForm ."+className+" .field-wrapper"),data).isValid;break;case"questionForm":fields=$("#questionForm .field-wrapper"),form=$(".questionFormFieldsWrapper"),formInner=questionFormInner,globalNoError=validateAndUpdateFields(fields,data).isValid;break;case"customForm":fields=$("#customForm .field-wrapper"),form=$(".custom-form-fields"),formInner=$customForm,globalNoError=validateAndUpdateFields(fields,data).isValid;break;case"unavailableForm":fields=$("#unavailableForm .field-wrapper"),variables.leaveMessageForm="true",variables.extChatData={email:lmConfig.email?lmConfig.email:""},fields.each(function(index){var val,name=$(this).find("input,label,select,textarea").attr("name");$(this).find("input").not('input[type="radio"],input[type="checkbox"]').length>0&&(val=$(this).find("input").val()),$(this).find("textarea").length>0&&(val=$(this).find("textarea").val()),$(this).find('input[type="radio"],input[type="checkbox"]').length>0&&(val=$(this).find("input:checked").val()),$(this).find("select").length>0&&(val=$(this).find("option:selected").val()),variables.extChatData[name]=val}),form=$("#offline-form-fields"),formInner=questionFormInner,globalNoError=validateAndUpdateFields(fields,data).isValid}if(globalNoError)formOnHide(formName,submitCustomFormData,data);else{var visibleErrorBallons=$(".error-balloon:visible");visibleErrorBallons.length>0&&(visibleErrorBallons.siblings("input").eq(0).focus(),function(form,formInner){form&&form.animate&&form.animate({scrollTop:$(".error-balloon:visible").eq(0).offset().top+formInner.scrollTop()-154},"fast")}(form,formInner))}}$("#unsubmit").on("click",function(){submit("unavailableForm")}),$("#custom_submit").on("click",function(){submit("customForm")}),$("#custom_cancel").on("click",function(){formOnHide("customForm",cancelCustomFormData,{})})}var avatarImageWrapper=$(".avatar-image-wrapper");if(cwConfig&&"none"!==cwConfig.showAgentPic&&previewMode)$(".avatar-image").attr("style","background:url("+chatUrl+"images/man-with-glasses.jpg) center center no-repeat/contain;"),avatarImageWrapper.removeClass("collapse"),avatarImageWrapper.removeClass("contain");else if(snippetConfig&&snippetConfig.contactTab){var src=snippetConfig.contactTab.iconUrl?snippetConfig.contactTab.iconUrl:"";src.length>0?($(".avatar-image").attr("style","background-image:url('"+src+"')"),avatarImageWrapper.addClass("contain")):avatarImageWrapper.addClass("collapse")}(lmConfig&&(lmConfig.okButtonText&&$("#unsubmit").val(lmConfig.okButtonText),commonUtilService.isDefined(lmConfig.cancelButtonEnabled)&&!0===lmConfig.cancelButtonEnabled?($("#uncancelWrapper:not(.preview)").remove(),$("#uncancelWrapper.preview").hide()):($("#uncancel").html(lmConfig.cancelButtonText),htmlUtilService.displayBlock($("#uncancelWrapper"))),clientChatPageGenerateInputs(lmConfig.fields,".offlineFields"),appendTip(".offlineFields","offlineFieldsReqDescr")),customFormConfig)&&(customFormConfig.title&&($("#agent-name").html(customFormConfig.title),$("#min_agent_name").html(customFormConfig.title)),frameHeight=getFrameHeight(cwConfig.height,previewMode?window.innerHeight:window.parent.innerHeight),"true"===sessionStorage.getItem("bp-minimized")||$spChatFrame.css({height:frameHeight,width:cwConfig.width}),clientChatPageGenerateInputs(customFormConfig.fields,".customFormFields"),$("#custom_submit").val(customFormConfig.submitButtonText),$("#custom_cancel").text(customFormConfig.cancelButtonText),$("#agent-name").attr("data-original-name",$("#agent-name").text()),$("#agent-name").text(customFormConfig.title),$("#header-avatar-container .avatar").css({display:"none"}),appendTip(".customFormFields","customFormFieldsReqDescr"));(scaleProactiveOffer(),updateChatStyles(cwConfig,styles),$.fn.perfectScrollbar&&setTimeout(function(){$(".questionFormInner").perfectScrollbar({useBothWheelAxes:!1}),$(".offlineFields").perfectScrollbar({useBothWheelAxes:!1}),$(".custom-form-fields").perfectScrollbar({useBothWheelAxes:!1}),$(".questionFormFieldsWrapper").perfectScrollbar({useBothWheelAxes:!1})},100),previewMode)&&(fullConf&&fullConf.widget&&fullConf.widget.chatWidgetStyling&&("round"===fullConf.widget.chatWidgetStyling.tabStyle?(document.querySelector("#sp-chat-widget .sp-round-button").style.display="",document.querySelector("#sp-chat-widget .sp-chat-widget__content").style.display="none"):(document.querySelector("#sp-chat-widget .sp-chat-widget__content").style.display="",document.querySelector("#sp-chat-widget .sp-round-button").style.display="none")))},clientChatPageConnection=function(){var connect=function(){var connectRequestData=clientChatPageGetConnectRequestData();if(connectRequestData.parameters.message){var savedMsgId=Number(localStorage.getItem("bp-sent-message-id")),initialMsgId=savedMsgId&&!isNaN(savedMsgId)?savedMsgId:1;connectRequestData.initialMessage={event:commonConstants.events.chat.session.MESSAGE,msg:escapeHTML(connectRequestData.parameters.message),msg_id:""+initialMsgId},localStorage.setItem("bp-sent-message-id",initialMsgId+2)}chatApiSessionCreateSession(connectRequestData).fail(function(e){document.querySelector("#error").innerHTML(e.text+". Retrying..."),window.setTimeout(connect,4e3)}).done(function(session){if(onConnected(session),connectRequestData.initialMessage){var uiEvent={event:commonConstants.events.chat.session.MESSAGE,party_id:session.session.sessionId,msg:connectRequestData.initialMessage.msg,msg_id:connectRequestData.initialMessage.msg_id,timestamp:Math.round(Date.now()/1e3).toString()},helpers=chatApiSessionCreateSessionHandlerHelpers();clientChatUiAppendLog(helpers.prepareLogEvent(session.session,uiEvent))}})},onConnected=function(o){var i18n=clientChatUiI18n();$("#error").css("display","none");var oldSessionId=sessionStorage.getItem("sp-chat-session");sessionStorage.setItem("sp-chat-session",o.session.sessionId),o.session.sessionId!==oldSessionId&&(sessionStorage.removeItem("bp-last-message-timestamp"),localStorage.removeItem("bp-sent-message-id")),window.localStorage.setItem("chattedBefore","true"),window.chatSession=o.session,persistentChat.fixHistoryMessages(),clientChatPageShowForm("start_form",""),o.session.assignUICallbacks({onFormShow:function(f){clientChatPageShowForm(f.form_name,f.form_request_id),window.parent.postMessage("bp-stop-cobrowsing","*")},onChatConnected:function(){clientChatPageShowForm("connect_chat_form","")},onChatQueued:function(){clientChatPageShowForm("find_agent_form","")},onFormSent:function(msg){if(o.session.sessionStatus)switch(o.session.sessionStatus){case"queued":clientChatPageShowForm("find_agent_form","",msg);break;case"connected":clientChatPageShowForm("connect_chat_form","",msg)}else clientChatPageShowForm("start_form","",msg)},onLogEvent:function(event){$.chatUI.appendLog(event),clientChatPageUpdateScrollbar()},onAutostartVideocall:function(o,p){window.chatSession.callPrompt=$("#call-prompt"),window.chatSession.webRTCSignaling(window.chatSession.internalParty.id).requestCall(!0),o.videocallAutostarted=!0},onSessionEnded:function(){if(o.session.sessionStatus)return o.session.sessionStatus=void 0,$("#callMe").css("display","none"),$("#shareScreen").css("display","none"),$("#minimizeChat").css("display","none"),$("#chat-body").addClass("sp-readonly"),$("#agent-name").text(i18n.sessionCompletedWidgetTitle),$("#min_agent_name").text(i18n.sessionCompletedWidgetTitle),clientChatPageUpdateScrollbar(),void window.parent.postMessage("bp-stop-cobrowsing-and-close-chat","*");window.setTimeout(function(){sessionStorage.removeItem("bp-last-message-timestamp"),localStorage.removeItem("bp-sent-message-id"),sessionStorage.removeItem("bp-min-message-counter"),sessionStorage.removeItem("bp-minimized"),window.parent.postMessage("sp-session-end","*")},50)}}),o.is_new_chat||o.session.getHistory();var urlVars=clientChatPageGetUrlVars(window.location.href);$.chatUI.sendNavigation(o.session,urlVars.referrer,urlVars.referrerTitle),clientChatPageInitDragAndDrop()};return{connect:connect,onConnected:onConnected}},clientChatPageGenerateInputs=function(object,parentElement){var formInputsOutput="",i18n=clientChatUiI18n(),fieldTypes={LABEL:"label",CALLBACK_PHONE:"callback_phone",PHONE:"phone",EMAIL:"email",NAME:"name",TEXT:"text",DATE:"date",MULTILINE_TEXT:"multiline_text",SLIDER:"numerical_range_slider",RADIO:"radio_buttons",CAPTCHA:"captcha",CONTACT_BUTTON:"contact_button",SELECTION_LIST:"selection_list"};function generateFieldName(field,arrayIndex){return field.formFieldType===fieldTypes.CAPTCHA&&(field.name="captcha_text"),field.name?field.name.replace(/\s/g,"_"):"field_"+arrayIndex}object&&(object.forEach(function(item,i,arr){var formFieldType=item.formFieldType,name=(item.name,generateFieldName(item,i)),id=name,required=item.required?"true":"false",ariaRequired=!!item.required,validate=!!item.validate,requiredSuffix=item.required?"*":"",label=void 0!==item.label&&null!=item.label?item.label+requiredSuffix:"",options=item.options,outputCurrent="",value=widgetConfiguration.isPreviewMode()&&commonUtilService.isDefined(SERVICE_PATTERN_CHAT_CONFIG[item.name])?SERVICE_PATTERN_CHAT_CONFIG[item.name]:"",nextItem=object[i+1],errorMessageText=i18n.requiredField,errorMsg=item.required||validate?' <div id="error-'+name+'" class="error-balloon">'+errorMessageText+"</div>":"";switch(formFieldType){case fieldTypes.LABEL:var forAttribute="";commonUtilService.isDefined(nextItem)&&(forAttribute=generateFieldName(nextItem,i+1)),outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-label",htmlUtilService.wrapWithLabel("",label,name,forAttribute));break;case fieldTypes.CALLBACK_PHONE:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-callback-phone",htmlUtilService.generateInput("tel",id,"",validate,name,label,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.PHONE:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-phone_number",htmlUtilService.generateInput("tel",id,"",validate,name,label,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.EMAIL:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-email",htmlUtilService.generateInput("email",id,"",validate,name,label,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.NAME:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-name",htmlUtilService.generateInput("text",id,"",validate,name,label,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.TEXT:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-text",htmlUtilService.generateInput("text",id,value,validate,name,label,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.DATE:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-date",htmlUtilService.generateInput("datetime",name,"",validate,name,label,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.MULTILINE_TEXT:var rows=commonUtilService.isObject(options)&&Array.isArray(options)&&1===options.length?options[0]:"";outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-multiline",htmlUtilService.generateTextArea(name,id,value,label,rows,required,ariaRequired,"agent-message")+errorMsg);break;case fieldTypes.SLIDER:var middleValue=Math.floor((item.maxValue-item.minValue)/2)+item.minValue;outputCurrent='<div class="field-wrapper field-range"><input oninput="$(this).siblings(\'.currentValue\').html($(this).val());"class=""type="range" id="'+id+'" name="'+name+'" placeholder="'+label+'" min="'+item.minValue+'" max="'+item.maxValue+'" value="" '+("true"===required?'required="'+required+'" ':"")+ariaRequired+'/><div class="minValue">'+item.minValue+'</div><div class="maxValue">'+item.maxValue+'</div><div class="currentValue">'+middleValue+"</div>"+errorMsg+"</div>";break;case fieldTypes.RADIO:var radioOptions="";options.forEach(function(option,j){radioOptions+=htmlUtilService.wrapWithDiv("option",htmlUtilService.generateInput("radio",name+"_"+j,option,validate,name,"",required,ariaRequired,"")+htmlUtilService.wrapWithLabel("",option,"",name+"_"+j))}),outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-radio",radioOptions+errorMsg);break;case fieldTypes.CAPTCHA:for(var captchaText=function(options){for(var text="",i=0;i<options.captchaLength;i++){var rand=Math.floor(Math.random()*options.chars.length);text+=options.chars.charAt(rand)}return text}({captchaLength:5,chars:commonConstants.alphabet}),table=$("<table></table>"),row=$("<tr></tr>").appendTo(table),k=0;k<captchaText.length;k++)$("<td>"+captchaText.charAt(k)+"</td>").css({border:"1px solid lightgrey"}).appendTo(row);outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-captcha",htmlUtilService.wrapWithLabel("","Enter the text shown below: ")+htmlUtilService.wrapWithDiv("captcha_wrapper",'<input type="text" required="true" name="captcha_text" id="captcha_text" class="agent-message" /><table class="captcha">'+table.html()+"</table>")+htmlUtilService.wrapWithDiv("error-balloon","Incorrect code","error-captcha"));break;case fieldTypes.CONTACT_BUTTON:outputCurrent=htmlUtilService.wrapWithDiv("field-wrapper field-contact-button",htmlUtilService.generateInput("button",id,"Contact button")+errorMsg);break;case fieldTypes.SELECTION_LIST:outputCurrent='<div class="field-wrapper field-select"><select id="'+id+'" name="'+name+'" '+("true"===required?'required="'+required+'" ':"")+ariaRequired+'"><option value="" disabled selected>'+label+"</option>",options.forEach(function(option){outputCurrent+='<option value="'+option+'">'+option+"</option>"}),outputCurrent+="</select>"+errorMsg+"</div>"}formInputsOutput+=outputCurrent}),$(parentElement).html(formInputsOutput),$(".tabChat").on("click",function(){$("#preChatForm").addClass("question__chat-tab_active"),$("#preChatForm").removeClass("question__call-tab_active")}),$(".tabPhone").on("click",function(){$("#preChatForm").addClass("question__call-tab_active"),$("#preChatForm").removeClass("question__chat-tab_active")}),$(".radioStars input").on("change",function(){$(this).parent().attr("data-rated",$(this).val())}))},clientChatPageGetConnectRequestData=function(){var variables=clientChatPageVariables;return{crossDomain:!0,clientId:"WebChat",url:variables.cp.webServer,appId:variables.cp.appId,tenantUrl:variables.cp.tenantUrl,from:variables.cp.from,phone_number:variables.cp.phone_number,parameters:variables.cp.parameters||{}}},clientChatPageGetUrlVars=function(url){for(var hash,vars={},hashes=url.slice(url.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++)vars[(hash=hashes[i].split("="))[0]]=decodeURIComponent(hash[1]);return vars},clientChatPageInitDragAndDrop=function(){var timeoutID,obj=$("#chat-body");function checkAndUpdateTimeout(timeoutID){timeoutID&&(window.clearTimeout(timeoutID),timeoutID=null)}obj.on("dragenter dragleave dragover drop",function(e){e.stopPropagation(),e.preventDefault()}),obj.on("dragenter",function(e){widgetConfiguration.isFileAttachEnabled()&&$("#attachFile").is(":visible")&&(obj.attr("dnd","1"),checkAndUpdateTimeout(timeoutID))}),obj.on("dragleave",function(e){widgetConfiguration.isFileAttachEnabled()&&(timeoutID?(window.clearTimeout(timeoutID),timeoutID=null):timeoutID=window.setTimeout(function(){obj.attr("dnd",null)},200))}),obj.on("dragover",function(e){widgetConfiguration.isFileAttachEnabled()&&(obj.attr("dnd","1"),checkAndUpdateTimeout(timeoutID))}),obj.on("drop",function(e){widgetConfiguration.isFileAttachEnabled()&&(clientChatPageUploadFiles(e.originalEvent.dataTransfer.files),obj.attr("dnd",null),checkAndUpdateTimeout(timeoutID))})},clientChatPageMakeId=function(){for(var text="",possible=commonConstants.alphabet,i=0;i<5;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},clientChatPageOnFormSubmit=function(e){var variables=clientChatPageVariables;e.preventDefault(),variables.currentForm&&"function"==typeof variables.currentForm.onSubmit&&variables.currentForm.onSubmit(form_name)},clientChatPageOnMessage=function(e){var i18n=clientChatUiI18n();if(0===(data=""+e.originalEvent.data).indexOf("sp-"))"sp-dragged"===data?clientChatPageUpdateScrollbar():"sp-disconnect"===data?clientChatPageSafeEndSession():"sp-req-notification"===data?$("#notification-prompt").css("display","block"):"sp-req-notification-end"===data?$("#notification-prompt").css("display","none"):0===data.indexOf("sp-together-url")?window.chatSession.send(i18n.clickToStartCobrowsingPrompt+data.replace("sp-together-url",""),{alternateMsg:{fromClass:"sys",msg:i18n.screenSharingRequestedMessageText,type:"cobrowsing"}}):0===data.indexOf("sp-together-stop")?window.chatSession.send(i18n.screenSharingEndedMessageText,{alternateMsg:{fromClass:"sys",msg:i18n.screenSharingEndedMessageText}}):"sp-started-together"===data?$("#shareScreen").addClass("stop-sharing"):"sp-stopped-together"===data&&$("#shareScreen").removeClass("stop-sharing");else if("bp-cobrowsing-ended"===data)window.sessionStorage.removeItem("bp-cobrowsing");else if("bp-cobrowsing-ended-message"===data)window.chatSession.sendCobrowsingEnded();else if("bp-cobrowsing-rejected"===data)window.chatSession.sendCobrowsingRejected();else if("bp-close-chat-confirmed"===data)clientChatPageSafeEndSessionConfirm();else try{var data;"bp-cobrowsing-started"===(data=JSON.parse(data)).message?(window.sessionStorage.setItem("bp-cobrowsing","true"),window.chatSession.sendCobrowsingStarted(data.provider,data.url,data.sessionId)):"bp-max-height"===data.message&&$(".min-scroll").css("max-height",data.height-124+"px")}catch(e){}},clientChatPageOnReady=function(e){var sessionId,platform=window.platform,variables=clientChatPageVariables,connection=clientChatPageConnection(),i18n=clientChatUiI18n(),$preChatForm=$("#preChatForm"),$body=$("body"),$attachFile=$("#attachFile"),$shareScreen=$("#shareScreen"),$minimizeChat=$("#minimizeChat"),$innerChat=$("#inner-chat"),$minInnerChat=$("#min_inner_chat"),$minMsgContainer=$("#min_messages"),$minMsgCounter=$(".min-message-counter"),$minDismissButton=$("#min_dismiss_button"),$messagesDiv=$("#messages-div"),$callMe=$("#callMe"),$callConfirmationControls=$("#call-controls_before-call"),$inCallControls=$("#call-controls_in-call"),inputObservInterval=null,pastTimeMinMessagesTimer=null;if(window.parent.postMessage("ready","*"),$(window).on("message",function(event){var data=event.originalEvent.data;commonUtilService.isString(data)&&("showChatTab"===data&&updatePreChatTabActive("chat"),"showCallTab"===data&&updatePreChatTabActive("call"),"showDefaultTab"===data&&updatePreChatTabActive("default"),"bp-request-minimize-off"===data&&onRestoreChatFromMinimization(),commonUtilService.isDefined(data)&&commonUtilService.includes(data,"definition")&&(sessionStorage.setItem("confParams",data),"round"===widgetConfiguration.getDefinitionStyling().tabStyle?$minInnerChat.addClass("use-round-button"):$minInnerChat.addClass("use-default-styling"),"true"===sessionStorage.getItem("bp-minimized")&&commonUtilService.updateParentDimensions({height:{auto:!0}}),function(){var cp=variables.cp,object=widgetConfiguration.getObject(),styles=widgetConfiguration.getStyles();for(var property1 in variables.cp.parameters={email:cp.email,last_name:cp.last_name,first_name:cp.first_name,account_number:cp.account_number,logging:cp.logging,location:{latitude:cp.latitude,longitude:cp.longitude}},commonUtilService.isDefined(platform)&&(variables.cp.parameters.user_platform={browser:platform.name+" "+platform.version,os:platform.os.toString(),description:platform.description}),variables.cp)variables.cp.hasOwnProperty(property1)&&0===property1.indexOf("custom_")&&(variables.cp.parameters[property1.substring("custom_".length)]=variables.cp[property1]);var snippetConfig=widgetConfiguration.getSnippet();snippetConfig&&($body.addClass(Object.keys(styles)[0]),$body.addClass("position_"+snippetConfig.contactTab.location),$body.addClass(widgetConfiguration.getOrientation()),snippetConfig.contactTab.location.split("_").forEach(function(item,i){$body.addClass(item+"_"+i)}));object&&(clientChatPageConfigurationChat(),scaleProactiveOffer());for(var field in variables.cp.parameters)variables.cp.parameters.hasOwnProperty(field)&&$preChatForm.find('[name="'+field+'"]').val(variables.cp.parameters[field]);variables.cp.start?(sessionId=variables.cp.start,connection.connect()):(window.parent.postMessage("getTabName","*"),(sessionId=sessionStorage.getItem("sp-chat-session"))?chatApiSessionCheckSessionExists(clientChatPageGetConnectRequestData(),sessionId).fail(function(){preChatCheck()}).done(function(){var session=chatApiSessionBuildSessionFromSessionId(clientChatPageGetConnectRequestData(),sessionId,"?");setTimeout(function(){connection.onConnected(session)})}):preChatCheck());window.emojiPicker=new EmojiPicker({emojiable_selector:"[data-emojiable=true]",assetsPath:widgetConfiguration.getChatPath()+"js/libraries/emoji/img",popupButtonClasses:"fa fa-smile-o"}),window.emojiPicker.discover(),widgetConfiguration.isEmojiPickerEnabled()||htmlUtilService.displayNone($(".emoji-picker")),widgetConfiguration.isFileAttachEnabled()?htmlUtilService.displayBlock($attachFile):htmlUtilService.displayNone($attachFile),widgetConfiguration.isMobile()&&$("#inner-chat").addClass("mobile-version");$(document.getElementById("content-form")).on("submit",clientChatPageOnFormSubmit)}(),setTimeout(function(){$("#inner-chat input:visible").first().focus()},100),window.parent.postMessage("formsGenerated","*"),persistentChat.loadChatHistory(event.originalEvent.origin)),commonUtilService.includes(data,"[parentPath]")&&sessionStorage.setItem("parentPath",data.split("[parentPath]=")[1]),commonUtilService.includes(data,"[parentHost]")&&sessionStorage.setItem("parentHost",data.split("[parentHost]=")[1]),commonUtilService.includes(data,"[serviceAvailable]")&&sessionStorage.setItem("serviceAvailable",data.split("[serviceAvailable]=")[1]),commonUtilService.includes(data,"[source]")&&sessionStorage.setItem("source",data.split("[source]=")[1]),commonUtilService.includes(data,"[iceServers]")&&sessionStorage.setItem("iceServersConfiguration",data.split("[iceServers]=")[1]))}),-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome"))var refreshIntervalId=setInterval(function(){var ds=$("#dynamicStyle");if(ds.length>0){var det=ds.detach();setTimeout(function(){det.appendTo("body")},0),clearInterval(refreshIntervalId)}},400);function preChatCheck(){var $offlineForm=$("#offline-form"),$unavailableForm=$("#unavailableForm"),snippetConfig=widgetConfiguration.getSnippet(),poConfig=widgetConfiguration.getProactiveOffer(),preChatSource=sessionStorage.getItem("source");if(snippetConfig&&"widget"===preChatSource&&snippetConfig.preChat.enabled||"proactive"===preChatSource&&poConfig.preChat.enabled){htmlUtilService.displayBlock($offlineForm);var available=sessionStorage.getItem("serviceAvailable");commonUtilService.stringIsFalse(available)?htmlUtilService.displayBlock($unavailableForm):htmlUtilService.displayBlock($preChatForm)}else connection.connect()}function updateInputHeight(e){var $editor=$(".emoji-wysiwyg-editor"),scrollHeight=$editor.prop("scrollHeight");if($editor.html().length>20&&!widgetConfiguration.isMobile()?$editor.height(scrollHeight+"px"):($editor.height("auto"),$messagesDiv.css("bottom","auto")),$("#input-field").val($editor.text()),!e||"keypress"!==e.type||!e.ctrlKey&&!e.metaKey||13!==e.keyCode&&10!==e.keyCode){var bottom=$(".chat-body__input").height();$messagesDiv.css("bottom",bottom+"px")}else{var inputField=$("#input-field");$editor.text(inputField.val()),$messagesDiv.css("bottom","65px")}}function updatePreChatTabActive(tabName){var sourceObject,preChatSource=sessionStorage.getItem("source");if("widget"===preChatSource&&(sourceObject=widgetConfiguration.getSnippet()),"proactive"===preChatSource&&(sourceObject=widgetConfiguration.getProactiveOffer()),sourceObject){var preChatConfig=sourceObject.preChat,isCallEnabled=preChatConfig.callButtonEnabled,isChatEnabled=preChatConfig.chatButtonEnabled;"call"!==tabName&&"chat"!==tabName||($preChatForm.removeClass("question__chat-tab_active"),$preChatForm.removeClass("question__call-tab_active")),isCallEnabled&&"call"===tabName&&$preChatForm.addClass("question__call-tab_active"),isChatEnabled&&"chat"===tabName&&$preChatForm.addClass("question__chat-tab_active")}}function resetMinMessageCounter(){sessionStorage.setItem("bp-min-message-counter",0);var bpLastMessageTimestampData=sessionStorage.getItem("bp-last-message-timestamp");bpLastMessageTimestampData&&(bpLastMessageTimestampData=JSON.parse(bpLastMessageTimestampData),sessionStorage.setItem("bp-last-message-timestamp",JSON.stringify({timestamp:bpLastMessageTimestampData.timestamp,timestampMin:bpLastMessageTimestampData.timestamp}))),$minMsgCounter.text(""),$minMsgCounter.removeClass("message-counter-small message-counter-medium message-counter-big")}function onChatMinimized(){window.parent.postMessage("bp-request-max-height","*");var snippet=widgetConfiguration.getSnippet(),minLocationClass="";if(snippet&&snippet.contactTab){var widgetLocation=snippet.contactTab.location,delimeterIndex=widgetLocation.indexOf("_");minLocationClass="min-"+widgetLocation.substring(0,delimeterIndex);var minLocation2Class="min-2-"+widgetLocation.substring(delimeterIndex+1,widgetLocation.length);$minInnerChat.addClass(minLocationClass+" "+minLocation2Class)}var chatWidgetStyling=widgetConfiguration.getDefinitionStyling();$innerChat.css("display","none"),$minInnerChat.css("display","flex"),setTimeout(function(){"min-bottom"===minLocationClass||"min-top"===minLocationClass?commonUtilService.updateParentDimensions({width:{value:chatWidgetStyling.width+"px"},height:{auto:!0}}):commonUtilService.updateParentDimensions({width:{value:chatWidgetStyling.width+50+"px"},height:{auto:!0}})}),pastTimeMinMessagesTimer&&clearInterval(pastTimeMinMessagesTimer),pastTimeMinMessagesTimer=setInterval(function(){$(".min-msg-block").each(function(){var timestamp=Number($(this).data("timestamp")),passedTimeLabel=commonUtilService.getPassedTimeText(timestamp);$(this).find(".min-msg-time").text(passedTimeLabel)})},6e4)}function onRestoreChatFromMinimization(){resetMinMessageCounter(),$minMsgContainer.empty(),$minInnerChat.css("display","none"),$minDismissButton.css("display","none"),sessionStorage.setItem("bp-minimized",!1);var bpLastMessageTimestampData=sessionStorage.getItem("bp-last-message-timestamp");bpLastMessageTimestampData&&(bpLastMessageTimestampData=JSON.parse(bpLastMessageTimestampData),sessionStorage.setItem("bp-last-message-timestamp",JSON.stringify({timestamp:bpLastMessageTimestampData.timestamp,timestampMin:null}))),window.parent.postMessage("bp-stop-minimized","*"),pastTimeMinMessagesTimer&&clearInterval(pastTimeMinMessagesTimer),setTimeout(function(){$innerChat.css("display","block"),clientChatPageUpdateScrollbar()})}if($("#input-button").on("click",function(){$.chatUI.sendMessage(window.chatSession),updateInputHeight(event)}),$("body").on("keypress",".emoji-wysiwyg-editor",function(event){$.chatUI.msgKeyPress(event,window.chatSession)}),$body.on("keyup",".emoji-wysiwyg-editor",function(event){$.chatUI.msgKeyPress(event,window.chatSession),updateInputHeight(event)}),$body.on("blur",".emoji-wysiwyg-editor",function(e){clearInterval(inputObservInterval),e&&e.relatedTarget&&$(e.relatedTarget).hasClass("emoji-picker-icon")||$.chatUI.notTyping(window.chatSession)}),$body.on("focus",".emoji-wysiwyg-editor",function(){inputObservInterval=setInterval(function(){updateInputHeight()},500);var $editor=$(".emoji-wysiwyg-editor");$editor.text()&&0===$editor.text().length&&$.chatUI.notTyping(window.chatSession)}),htmlUtilService.setDivHoverById("callMe",i18n.webRtcCallTooltip),htmlUtilService.setDivHoverById("switchVideo",i18n.webRtcSwitchVideoTooltip),htmlUtilService.setDivHoverById("shareScreen",i18n.shareScreenTooltip),htmlUtilService.setDivHoverById("minimizeChat",i18n.minimizeChatTooltip),htmlUtilService.setDivHoverById("endChat",i18n.endChatTooltip),$("i.emoji-picker").attr("title",i18n.emojiTooltip),htmlUtilService.setDivHoverById("attachFile",i18n.sendFileTooltip),htmlUtilService.setDivHoverById("min_dismiss_button",i18n.minimizedDismissMessagesTooltip),$("#servicepattern_close_button").on("click",function(){clientChatPageSafeEndSession()}),$("#uncancel").on("click",function(){clientChatPageSafeEndSession()}),$("#submitSurvey").on("click",function(){var data={},noError=!0,radios=$('input[name="service"]:checked');radios.length>0&&(data.service=radios.get(0).value),(radios=$('input[name="helpful"]:checked')).length>0&&(data.helpful=radios.get(0).value),(radios=$('input[name="recommend"]:checked')).length>0&&(data.recommend=radios.get(0).value),(radios=$('input[name="transcript"]:checked')).length>0&&(data.transcript=radios.get(0).value),data.transcriptEmail=$("#transcriptEmail").val(),$('input[name="transcript"]:checked').length>0&&!commonUtilService.validateEmail(data.transcriptEmail)?(noError=!1,$("#transcriptEmail").addClass("error")):(noError=!0,$("#transcriptEmail").removeClass("error")),!0===noError&&window.chatSession.sendFormData(variables.currentFormRequestId,variables.currentFormName,data)}),$("#endChat").on("click",function(){window.chatSession.disconnectSession()}),$callMe.on("click",function(){if(window.chatSession.internalParty){window.chatSession.callPrompt=$("#call-prompt"),snippetCheckDeviceSupport();var offerVideo=!widgetConfiguration.getParams()||widgetConfiguration.isVisitorVideoEnabled();window.chatSession.webRTCSignaling(window.chatSession.internalParty.id).requestCall(offerVideo)}}),$shareScreen.on("click",function(){$shareScreen.hasClass("stop-sharing")?window.parent.postMessage("bp-stop-cobrowsing","*"):window.parent.postMessage("bp-start-cobrowsing","*")}),$callConfirmationControls.find("#call-controls_reject").on("click",function(){window.chatSession.webRTC&&window.chatSession.webRTC.callRejected()}),$callConfirmationControls.find("#call-controls_accept").on("click",function(){window.chatSession.webRTC&&(window.chatSession.webRTC.toggleCallPrompt(!0),window.chatSession.webRTC.callConfirmed())}),$inCallControls.find("#call-controls_mute-audio").on("click",function(){if(window.chatSession.webRTC){var control=$(this);control.hasClass("off")?(control.removeClass("off"),window.chatSession.webRTC.unmuteAudio()):(control.addClass("off"),window.chatSession.webRTC.muteAudio())}}),$inCallControls.find("#call-controls_mute-video").on("click",function(){if(window.chatSession.webRTC){var $myCam=$("#myCam"),$video=$("#video"),control=$(this);control.hasClass("off")?(control.removeClass("off"),window.chatSession.webRTC.unmuteVideo(),htmlUtilService.displayBlock($myCam),htmlUtilService.displayBlock($video),window.chatSession.webRTC.updateChatView()):(control.addClass("off"),window.chatSession.webRTC.muteVideo(),htmlUtilService.displayNone($myCam),htmlUtilService.displayNone($video),window.chatSession.webRTC.updateChatView())}}),$inCallControls.find("#call-controls_end-call").on("click",function(){window.chatSession.webRTC&&(window.chatSession.webRTC.closeConnection(),$inCallControls.find("#call-controls_mute-audio").removeClass("off"),$inCallControls.find("#call-controls_mute-video").removeClass("off"),$("#callMode").removeClass("enabled"))}),$attachFile.on("keydown",function(event){13===event.keyCode&&$attachFile.click()}),$attachFile.on("click",function(){sessionStorage.setItem("blockConnectionInterruptCheck",!0),$("#file-upload-form").html('<input type="file" id="attach-file" name="file-upload-input"/>'),$("#attach-file").on("change",function(event){clientChatPageUploadFiles(event.target.files)}),$("#attach-file").click()}),$minimizeChat.on("click",function(){resetMinMessageCounter(),window.parent.postMessage("bp-start-minimized","*"),sessionStorage.setItem("bp-minimized",!0),onChatMinimized()}),$(".min-chat-tab").on("click",function(e){onRestoreChatFromMinimization()}),$("#min_inner_chat .sp-round-button").on("click",function(e){onRestoreChatFromMinimization()}),$minMsgCounter.on("click",function(e){onRestoreChatFromMinimization()}),$("#min_messages").on("click",function(e){onRestoreChatFromMinimization()}),$minDismissButton.on("click",function(e){$minDismissButton.css("display","none"),resetMinMessageCounter(),$minMsgContainer.empty(),commonUtilService.updateParentDimensions({height:{value:"0"}})}),"true"===sessionStorage.getItem("bp-minimized")){var currentMsgNumber=Number(sessionStorage.getItem("bp-min-message-counter"));currentMsgNumber>0&&($minMsgCounter.text(currentMsgNumber),$minMsgCounter.removeClass("message-counter-small message-counter-medium message-counter-big"),currentMsgNumber<5?$minMsgCounter.addClass("message-counter-small"):currentMsgNumber<10?$minMsgCounter.addClass("message-counter-medium"):currentMsgNumber>=10&&$minMsgCounter.addClass("message-counter-big"),$minDismissButton.css("display","inline-flex")),onChatMinimized()}},persistentChat=function(){var persistentChatEnabled=!1,historyKey="",historyLoadedHandlers=[],historyLoaded=!1,pendingFix=!1;function fixHistoryMessagesRaw(){var sessionId=sessionStorage.getItem("sp-chat-session");!function(sessionId){$('div[id^="'+sessionId+'-"] .msg-file-link').css("display",""),$('div[id^="'+sessionId+'-"] .msg-file-stub').css("display","none"),setTimeout(clientChatPageUpdateScrollbar)}(sessionId),function(sessionId){$('.new-msg-container:not([id^="'+sessionId+'"]) .agentImage').css({"background-color":"#999 !important",display:"flex","align-items":"center","justify-content":"center","font-size":"1.3rem",color:"#fff","font-weight":"600","user-select":"none"}).text("A")}(sessionId)}function decodeContentCache(str){if(!str)return null;var decoded=decodeURI(str),deobfuscated=commonUtilService.deobfuscate(decoded,3);return JSON.parse(deobfuscated)}function encodeContentCache(data){var stringifyed=JSON.stringify(data),obfuscated=commonUtilService.obfuscate(stringifyed,3);return encodeURI(obfuscated)}var chatHistoryCacheLifetime=7776e6;return{loadChatHistory:function(parentOrigin){SERVICE_PATTERN_CHAT_CONFIG&&SERVICE_PATTERN_CHAT_CONFIG.enableClientSideChatHistory&&(persistentChatEnabled=!0);const styling=widgetConfiguration.getDefinitionStyling();var data;if(styling&&styling.enableClientSideChatHistory&&(persistentChatEnabled=!0),persistentChatEnabled)try{var decoded=decodeContentCache(localStorage.getItem("bp-temp-cache"))||{};data=decoded,Object.keys(data).forEach(function(key){data[key]=data[key].filter(function(dataItem){return dataItem.date>Date.now()-chatHistoryCacheLifetime})});var encoded=encodeContentCache(decoded);localStorage.setItem("bp-temp-cache",encoded);var allowedDomains=SERVICE_PATTERN_CHAT_CONFIG.sharedDomains||SERVICE_PATTERN_CHAT_CONFIG.sharedHistoryDomains;const parentHostname=commonUtilService.extractHostname(parentOrigin);if(historyKey=parentHostname,allowedDomains&&allowedDomains.length){for(var domainMatch=!1,i=0;i<allowedDomains.length;++i){var domainSuffix=(!allowedDomains[i].length||"."!==allowedDomains[i][0]&&allowedDomains[i]!==parentHostname?".":"")+allowedDomains[i];if(parentHostname.length>=domainSuffix.length&&parentHostname.substring(parentHostname.length-domainSuffix.length)===domainSuffix){domainMatch=!0;break}}domainMatch&&(historyKey=JSON.stringify(allowedDomains))}var hostnameData=decoded[historyKey]||[];hostnameData.sort(function(data1,data2){return data1.date>data2.date?1:-1}),i=0;var lastDate=null;setTimeout(function appendChunk(){i<hostnameData.length?(hostnameData[i].messages.forEach(function(msg,index){if(msg.history=!0,msg.sessionId=hostnameData[i].id,!(0!==index||lastDate&&commonUtilService.areDatesEqual(lastDate,hostnameData[i].date))){var dateMsg={event:"date-message",history:!0,date:hostnameData[i].date,sessionId:hostnameData[i].id};clientChatUiAppendLog(dateMsg),lastDate=hostnameData[i].date}index===hostnameData[i].messages.length-1&&(msg.last=!0),clientChatUiAppendLog(msg)}),i++,setTimeout(appendChunk)):(function(lastDate){if(lastDate){lastDate=new Date(lastDate);var now=new Date,sessionId=sessionStorage.getItem("sp-chat-session");if(!commonUtilService.areDatesEqual(lastDate,now)){var dateMsg={event:"date-message",history:!0,date:Date.now(),sessionId:sessionId};clientChatUiAppendLog(dateMsg)}}}(lastDate),historyLoaded=!0,historyLoadedHandlers.forEach(function(handler){try{handler()}catch(e){}}),pendingFix&&fixHistoryMessagesRaw())})}catch(e){console.error("Unable to load chat history: ",e)}},addMessageToChatHistory:function(msg){if(persistentChatEnabled)try{var data=decodeContentCache(localStorage.getItem("bp-temp-cache"))||{},hostnameData=data[historyKey];hostnameData||(hostnameData=[],data[historyKey]=hostnameData);var sessionId=sessionStorage.getItem("sp-chat-session"),sessionData=hostnameData.filter(function(dataItem){return dataItem.id===sessionId});sessionData.length?sessionData=sessionData[0]:(sessionData={id:sessionId,date:Date.now(),messages:[]},hostnameData.push(sessionData)),sessionData.messages.push(msg);var encoded=encodeContentCache(data);localStorage.setItem("bp-temp-cache",encoded)}catch(e){console.error("Unable to write chat history: ",e)}},fixHistoryMessages:function(){pendingFix=!0,historyLoaded&&fixHistoryMessagesRaw()},fixHistoryMessagesRaw:fixHistoryMessagesRaw,removeSessionMessages:function(sessionId){sessionId&&persistentChatEnabled&&$("#messages_history_separator").prevAll().filter('[id^="'+sessionId+'-"]').remove()},isEnabled:function(){return persistentChatEnabled},isHistoryLoaded:function(){return historyLoaded},onHistoryLoaded:function(handler){historyLoadedHandlers.push(handler)}}}(),clientChatPageSafeEndSession=function(){if(window.chatSession)if("connected"===window.chatSession.sessionStatus){var endChatMessage="Do you want to end the chat session?",definition=widgetConfiguration.getDefinition();definition&&definition.chatWidgetStyling&&definition.chatWidgetStyling.endSessionDialogText&&(endChatMessage=definition.chatWidgetStyling.endSessionDialogText),window.parent.postMessage(JSON.stringify({message:"bp-show-close-chat-dialog",text:endChatMessage}),"*")}else window.sessionStorage.getItem("bp-cobrowsing")&&window.chatSession.sendCobrowsingEnded(),window.chatSession.sessionEnded?window.chatSession.uiCallbacks.onSessionEnded():window.chatSession.endSession();else window.setTimeout(function(){localStorage.removeItem("bp-sent-message-id"),sessionStorage.removeItem("bp-last-message-timestamp"),sessionStorage.removeItem("bp-min-message-counter"),sessionStorage.removeItem("bp-minimized"),sessionStorage.removeItem("bp-cobrowsing"),window.parent.postMessage("sp-session-end","*")},50)},clientChatPageSafeEndSessionConfirm=function(){window.chatSession.sessionStatus=void 0,window.sessionStorage.getItem("bp-cobrowsing")&&window.chatSession.sendCobrowsingEnded(),window.chatSession.disconnectSession()},clientChatPageShowForm=function(fn,frId,msg){var variables=clientChatPageVariables,nf=variables.forms[fn];if(!variables.forms[fn]){nf=variables.forms.custom_form;var form_name=fn}if(nf){var frm=document.getElementById("content-form");frm&&(variables.currentForm&&"function"==typeof variables.currentForm.onHide&&variables.currentForm.onHide(form_name,msg),frm.innerHTML=nf.html,variables.currentForm=nf,frId&&(variables.currentFormName=fn,variables.currentFormRequestId=frId),"function"==typeof variables.currentForm.onShow&&variables.currentForm.onShow(form_name))}},clientChatPageUpdateScrollbar=function(){var outer=$("#messages-div-outer"),inner=$("#messages-div-inner"),ih=inner.height(),oh=outer.height();outer.perfectScrollbar("update"),inner.css("bottom",ih>oh?"auto":"0"),inner.css("top",ih>oh?"0":"auto"),ih>oh&&outer.scrollTop(ih-oh)},clientChatPageUploadFiles=function(files){function uploadFile(file){var formData=new FormData,id=clientChatPageMakeId(),sessionId=sessionStorage.getItem("sp-chat-session");formData.append("file-upload-input",file),$.chatUI.appendLog({fromClass:"me",msg:'Uploading "'+file.name+'"',msgId:id,sessionId:sessionId}),function(cp,formData){var uploadFilesEndpoint="files?tenantUrl="+encodeURIComponent(cp.tenantUrl);return chatApiSessionSendXhr(cp,uploadFilesEndpoint,"POST",formData)}(window.chatSession.cp,formData).fail(function(fail){var errorMessage="";fail&&fail.responseJSON&&(errorMessage=fail.responseJSON.error_message||""),$("#"+sessionId+"-"+id).detach(),$.chatUI.appendLog({fromClass:"sys",msg:"Error: "+errorMessage})}).done(function(done){if($("#"+sessionId+"-"+id).detach(),done&&done.file_id&&window.chatSession){var type="attachment";file.type.match("image.*")?type="image":clientChatPageUpdateScrollbar(),window.chatSession.fileUploaded(done.file_id,type,done.file_name)}})}for(var item,i=0;item=files[i];i++)uploadFile(item);sessionStorage.setItem("blockConnectionInterruptCheck",!1)},clientChatPageVariables=function(){function checkAndCloseCustomForm(msg){var sessionEvents=commonConstants.events.chat.session;!msg||msg.event!==sessionEvents.SECURE_FORM_CANCEL&&msg.event!==sessionEvents.FORM_DATA_CANCEL||htmlUtilService.displayNone($("#customForm"))}var variables={cp:function(url){for(var hash,vars={},hashes=url.slice(url.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++)vars[(hash=hashes[i].split("="))[0]]=decodeURIComponent(hash[1]);return vars}(window.location.href),currentFormName:"",currentFormRequestId:"",currentForm:null,extChatData:{},forms:{MobileChatCustomerData:{html:"",onShow:function(){window.parent.postMessage("sp-chat-init","*"),htmlUtilService.displayBlock($("#offline-form"));var definition=widgetConfiguration.getDefinition();$("#agent-name").text(definition.preChat.title),$("#min_agent_name").text(definition.preChat.title),window.chatSession&&window.chatSession.reassignUICallbacks({onLogEvent:function(event){$.chatUI.appendLog(event),clientChatPageUpdateScrollbar()}})},onHide:function(){htmlUtilService.displayNone($("#offline-form")),htmlUtilService.displayNone($("#questionForm"))},onSubmit:function(){}},find_agent_form:{html:"",onShow:function(){window.chatSession.sessionStatus="queued",window.parent.postMessage("sp-chat-drag","*");var definition=widgetConfiguration.getDefinition();if(definition&&definition.chatWidgetStyling&&($("#agent-name").text(definition.chatWidgetStyling.title),$("#min_agent_name").text(definition.chatWidgetStyling.title)),htmlUtilService.displayBlock($("#chat-body")),$("#chat-body").removeClass("sp-readonly"),$("#messages-div-outer").perfectScrollbar({useBothWheelAxes:!1}),$(".min-scroll").perfectScrollbar({useBothWheelAxes:!1}),window.chatSession){var showAgentPic=definition.chatWidgetStyling.showAgentPic||"";if("show"===showAgentPic||"always_default"===showAgentPic){var url=window.chatSession.getProfilePhotoUrl();$(".avatar-image").attr("style","background-image:url('"+url+"')"),$("#min_agent_image").attr("style","background-image:url('"+url+"')"),$(".avatar-image-wrapper").removeClass("collapse"),$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions").removeClass("narrow")}window.chatSession.reassignUICallbacks({onLogEvent:function(event){var definition=widgetConfiguration.getDefinition();if($.chatUI.appendLog(event),clientChatPageUpdateScrollbar(),definition&&definition.chatWidgetStyling){var showAgentPic=definition.chatWidgetStyling.showAgentPic||"";window.chatSession.internalParty?($("#agent-name").text(window.chatSession.internalParty.displayName),$(".agent-name").text(window.chatSession.internalParty.displayName),$("#min_agent_name").text(window.chatSession.internalParty.displayName),$(".avatar-image-wrapper").removeClass("collapse"),$("#agent-name").attr("title",$("#agent-name").text()),$("#min_agent_name").attr("title",$("#agent-name").text())):($("#agent-name").text(definition.chatWidgetStyling.title),$("#min_agent_name").text(definition.chatWidgetStyling.title));var agentId=window.chatSession.internalParty?window.chatSession.internalParty.id:void 0,url=window.chatSession.getProfilePhotoUrl(agentId);"show"!==showAgentPic&&"always_default"!==showAgentPic||($(".avatar-image").attr("style","background-image:url('"+url+"')"),$("#min_agent_image").attr("style","background-image:url('"+url+"')"),$(".avatar-image-wrapper").removeClass("contain"),$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions").removeClass("narrow")),"none"===showAgentPic&&($("#header-avatar .avatar").hide(),$("#min_agent_image").hide(),$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions").addClass("narrow")),window.parent.postMessage(JSON.stringify({type:"bp-update-agent-data",data:{name:window.chatSession.internalParty?window.chatSession.internalParty.displayName:definition.chatWidgetStyling.title,url:"show"===showAgentPic||"always_default"===showAgentPic?url:void 0}}),"*")}}})}},onHide:function(){window.chatSession.sessionStatus=void 0,htmlUtilService.displayNone($("#chat-body"))},onSubmit:function(){}},start_form:{html:"",onShow:function(){window.parent.postMessage("sp-chat-drag","*"),htmlUtilService.displayBlock($("#chat-body")),$("#chat-body").removeClass("sp-readonly"),$("#messages-div-outer").perfectScrollbar({useBothWheelAxes:!1}),$(".min-scroll").perfectScrollbar({useBothWheelAxes:!1}),window.chatSession&&window.chatSession.reassignUICallbacks({onLogEvent:function(event){$.chatUI.appendLog(event),clientChatPageUpdateScrollbar()}})},onHide:function(formName,msg){htmlUtilService.displayNone($("#chat-body")),checkAndCloseCustomForm(msg)},onSubmit:function(){}},connect_chat_form:{html:"",onShow:function(){var definition=widgetConfiguration.getDefinition();window.chatSession.sessionStatus="connected",htmlUtilService.displayBlock($("#chat-body")),$("#callMe").removeClass("hang-up");var connection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection;definition&&!1===definition.chatWidgetStyling.videoCallEnabled?$("#callMe").remove():$("#callMe").css("display",connection?"flex":"none"),definition&&!1===definition.chatWidgetStyling.visitorVideoEnabled&&$("#call-controls_mute-video, #myCam").remove(),definition&&void 0===definition.chatWidgetStyling.widgetMinimizationEnabled||!0===definition.chatWidgetStyling.widgetMinimizationEnabled?$("#minimizeChat").css("display","flex"):$("#minimizeChat").css("display","none"),commonUtilService.stringIsTrue(clientChatPageGetUrlVars(window.location.href).togetherjs_enabled)&&htmlUtilService.displayFlex($("#shareScreen")),htmlUtilService.displayBlock($("#endChat")),$("#chat-body").removeClass("sp-readonly"),$("#messages-div-inner").css({bottom:"0",top:"auto"}),$("#messages-div-outer").perfectScrollbar({useBothWheelAxes:!1}),$(".min-scroll").perfectScrollbar({useBothWheelAxes:!1}),clientChatPageUpdateScrollbar(),window.parent.postMessage("sp-get-status-together","*"),window.chatSession&&(definition&&!0===definition.chatWidgetStyling.webNotificationsEnabled&&window.parent.postMessage("sp-session-start","*"),window.chatSession.reassignUICallbacks({onLogEvent:function(event){var definition=widgetConfiguration.getDefinition();if("/ban"===event.msg){return window.parent.postMessage(JSON.stringify({action:"sp-storage",key:"bp-bc",value:"1"}),"*"),window.chatSession.disconnectSession(),void window.chatSession.endSession()}event=$.chatUI.appendLog(event),commonUtilService.saveLastEventTimestamp(event);var currentSessionHistoryLoaded=!window.chatSession.historyReceived||window.chatSession.historyRendered;if(!event.history&&currentSessionHistoryLoaded&&"me"!==event.fromClass&&"sys"!==event.fromClass){var profilePhotoUrl=event.profilePhotoUrl;definition&&definition.chatWidgetStyling&&"none"===definition.chatWidgetStyling.showAgentPic&&(profilePhotoUrl="");var a={action:"sp-notification",photo:profilePhotoUrl,msg:event.buttonsData?event.buttonsData.message:event.originalMsg,name:event.fromName};window.parent.postMessage(JSON.stringify(a),"*")}if(window.chatSession.internalParty){$("#agent-name").text(window.chatSession.internalParty.displayName),$("#min_agent_name").text(window.chatSession.internalParty.displayName),$("#agent-name").attr("title",$("#agent-name").text()),$("#min_agent_name").attr("title",$("#agent-name").text());var agentId=window.chatSession.internalParty?window.chatSession.internalParty.id:void 0,url=window.chatSession.getProfilePhotoUrl(agentId);if(definition&&definition.chatWidgetStyling){var showAgentPic=definition.chatWidgetStyling.showAgentPic;"show"!==showAgentPic&&"always_default"!==showAgentPic||($(".avatar-image").attr("style","background-image:url('"+url+"')"),$(".min_agent_image").attr("style","background-image:url('"+url+"')"),$(".avatar-image-wrapper").removeClass("contain"),$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions").removeClass("narrow")),"none"===showAgentPic&&($("#header-avatar .avatar").hide(),$(".min_agent_image").hide(),$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions").addClass("narrow"))}}if(currentSessionHistoryLoaded&&event.event&&"chat_session_secure_form_show"===event.event){var index=-1,i18n=clientChatUiI18n();if(variables.currentFormRequestId=event.form_request_id,definition){for(var key in definition.forms)definition.forms.hasOwnProperty(key)&&definition.forms[key].id==event.form_id&&(index=key);var customFormConfig=definition.forms[index];clientChatPageGenerateInputs(customFormConfig.fields,".customFormFields"),$('.customFormFields *[required="true"]').parents(".customFormFields").append('<div class="reqDescr">'+i18n.refersToRequiredFields+"</div>"),$("#customForm").css("display","block"),$("#customForm").addClass("secure"),$("#customFormFields").scrollTop(0),$("#custom_submit").val(customFormConfig.submitButtonText),$("#custom_cancel").text(customFormConfig.cancelButtonText),$("#agent-name").attr("data-original-name",$("#agent-name").text()),$("#agent-name").text(customFormConfig.title),$("#header-avatar-container .avatar").css({display:"none"})}}clientChatPageUpdateScrollbar()},onSessionTyping:function(a){var i18n=clientChatUiI18n();$("#agent-typing").css("display","block");var agentTypingMessage=i18n.agentTypingIndicator;commonUtilService.includes(agentTypingMessage,"$(name)")&&(agentTypingMessage=agentTypingMessage.replace("$(name)",a.displayName)),commonUtilService.includes(agentTypingMessage,"$(firstName)")&&(agentTypingMessage=agentTypingMessage.replace("$(firstName)",a.firstName||a.displayName)),commonUtilService.includes(agentTypingMessage,"$(lastName)")&&(agentTypingMessage=agentTypingMessage.replace("$(lastName)",a.lastName||a.displayName)),$(".agent-typing-wrapper").text(agentTypingMessage)},onSessionNotTyping:function(){$("#agent-typing").css("display","none")},onAddLocalStream:function(stream){var video2=$("#myCam");try{video2.attr("src",URL.createObjectURL(stream))}catch(e){try{video2.prop("srcObject",stream)}catch(b){}}},onAddStream:function(stream){var $video=$("#video"),$callMode=$("#callMode");try{$video.attr("src",URL.createObjectURL(stream))}catch(e){try{$video.prop("srcObject",stream)}catch(b){}}window.chatSession.webRTC.muteVideo(),$callMode.addClass("enabled");var callMode=sessionStorage.getItem("callMode");void 0!==callMode&&"voice"===callMode&&$callMode.addClass("voice")},hideChatInput:function(){htmlUtilService.displayNone($("#input-div")),$("#chat-body").addClass("sp-readonly")},showChatInput:function(){htmlUtilService.displayBlock($("#input-div")),$("#chat-body").removeClass("sp-readonly")}}))},onHide:function(formName,msg){checkAndCloseCustomForm(msg),window.chatSession.sessionStatus=void 0,$("#endChat").css("display","none"),$("#chat-body").css("display","none"),$("#video").css("display","none"),$("#servicepattern-chat").css("top","0"),$("#callMe").css("display","none"),$("#shareScreen").css("display","none"),$("#minimizeChat").css("display","none"),$("#header-avatar .avatar").hide(),$("#min_agent_image").hide(),$("#header-avatar, #sp-close-frame, #chat-body, #inner-chat, #sp-drag-handle, .conversationOptions").addClass("narrow"),clientChatPageUpdateScrollbar()},onSubmit:function(){this.submitForm()},submitForm:function(){window.chatSession.sendFormData(variables.currentFormRequestId,variables.currentFormName,{})}},chat_unavailable_form:{html:"",onShow:function(){variables.currentFormName="chat_unavailable_form",window.chatSession.sessionStatus=void 0,htmlUtilService.displayBlock($("#offline-form")),htmlUtilService.displayBlock($("#unavailableForm"))},onHide:function(formName,msg){},onSubmit:function(){}},custom_form:{html:"",onShow:function(form_name){var definition=widgetConfiguration.getDefinition(),index=-1,i18n=clientChatUiI18n();if(definition){for(var key in definition.forms)definition.forms.hasOwnProperty(key)&&definition.forms[key].name==form_name&&(index=key);if(-1!==index){var customFormConfig=definition.forms[index];customFormConfig&&customFormConfig.title&&($("#agent-name").html(customFormConfig.title),$("#min_agent_name").html(customFormConfig.title)),clientChatPageGenerateInputs(customFormConfig.fields,".customFormFields"),$('.customFormFields *[required="true"]').parents(".customFormFields").append('<div class="reqDescr">'+i18n.refersToRequiredFields+"</div>"),htmlUtilService.displayBlock($("#offline-form")),htmlUtilService.displayBlock($("#customForm")),$("#custom_submit").val(customFormConfig.submitButtonText),$("#custom_cancel").text(customFormConfig.cancelButtonText),$("#agent-name").attr("data-original-name",$("#agent-name").text()),$("#agent-name").text(customFormConfig.title),$("#header-avatar-container .avatar").css({display:"none"})}else window.chatSession.sendFormData(variables.currentFormRequestId,form_name,"Form not found")}},onHide:function(formName,msg){checkAndCloseCustomForm(msg)},onSubmit:function(form_name){$("#agent-name").text($("#agent-name").attr("data-original-name")),$("#agent-name").attr("data-original-name",""),$("#header-avatar-container .avatar").css({display:""})}},survey_form:{html:"",onShow:function(){var i18n=clientChatUiI18n();window.parent.postMessage("sp-chat-init","*"),htmlUtilService.displayBlock($("#offline-form")),htmlUtilService.displayBlock($("#surveyForm")),$("#agent-name").text(i18n.surveyFormTitle),$("#min_agent_name").text(i18n.surveyFormTitle),$("#agent-name").attr("title",$("#agent-name").text()),$("#min_agent_name").attr("title",$("#agent-name").text()),$("#transcriptEmail").val(variables.extChatData.email)},onHide:function(formName,msg){htmlUtilService.displayNone($("#offline-form")),htmlUtilService.displayNone($("#surveyForm"))},onSubmit:function(){},submitForm:function(){}},MobileChatSurvey:{html:"",onShow:function(){var i18n=clientChatUiI18n();window.parent.postMessage("sp-chat-init","*"),htmlUtilService.displayBlock($("#offline-form")),htmlUtilService.displayBlock($("#surveyForm")),$("#agent-name").text(i18n.surveyFormTitle),$("#min_agent_name").text(i18n.surveyFormTitle),$("#agent-name").attr("title",$("#agent-name").text()),$("#min_agent_name").attr("title",$("#agent-name").text()),$("#transcriptEmail").val(variables.extChatData.email)},onHide:function(formName,msg){htmlUtilService.displayNone($("#offline-form")),htmlUtilService.displayNone($("#surveyForm"))},onSubmit:function(){},submitForm:function(){}}}};return variables}(),clientChatUiAppendLog=function(){var buttonsCmdTypes=["buttons-column","buttons","choice"],buttonsCmdRegexp=new RegExp("^(?:.*?)\\/(?:"+buttonsCmdTypes.join("|")+")((?:\\s*)\\[[^\\[\\]]+?\\])+$","mi");return function(event){var i18n=clientChatUiI18n(),e=clientChatUiPrepareEvent(event),date=e.timestamp?new Date(parseInt(commonUtilService.fixTimestamp(e.timestamp))):new Date,time=date.format("HH:MM"),minimized=sessionStorage.getItem("bp-minimized"),eventStatus=commonUtilService.getIncomingEventStatus(e);if(e.msg&&"true"===minimized&&"new"===eventStatus){var msgCounterDiv=$(".min-message-counter"),currentMsgNumber=Number(sessionStorage.getItem("bp-min-message-counter"));currentMsgNumber++,sessionStorage.setItem("bp-min-message-counter",currentMsgNumber),msgCounterDiv.removeClass("message-counter-small message-counter-medium message-counter-big"),currentMsgNumber<5?msgCounterDiv.addClass("message-counter-small"):currentMsgNumber<10?msgCounterDiv.addClass("message-counter-medium"):currentMsgNumber>=10&&msgCounterDiv.addClass("message-counter-big"),currentMsgNumber>0&&$("#min_dismiss_button").css("display","inline-flex"),msgCounterDiv.text(currentMsgNumber),$(".min-scroll").perfectScrollbar("update")}if(e.msg){var messageType,ariaLabel,textColor,backgroundColor,fromClass=e.fromClass,icon="",fromName="",collapsedIconClass="",msg=e.msg,logoUrl="none"==sessionStorage.getItem("logoUrl")?"":sessionStorage.getItem("logoUrl"),logoUrldefault=sessionStorage.getItem("logoUrldefault"),logo=!logoUrl||"none"==logoUrl||"agent"!==fromClass&&"sys"!==fromClass?e.profilePhotoUrl:logoUrl;"none"==logoUrl&&$("#messages-div").addClass("noAgentImage"),"none"==e.profilePhotoUrl&&(collapsedIconClass=" collapsed"),e.options&&e.options.alternateMsg&&(e.options.alternateMsg.fromClass&&(fromClass=e.options.alternateMsg.fromClass),e.options.alternateMsg.msg&&(msg=e.options.alternateMsg.msg)),commonUtilService.includes(e.msg,i18n.clickToStartCobrowsingPrompt)?(fromClass="sys",msg=i18n.screenSharingRequestedMessageText):e.msg===i18n.screenSharingEndedMessageText&&(fromClass="sys");var lastMsg=event.last?"msg-last-in-session":"",messageId=event.msgId?event.msgId:event.msg_id?event.msg_id:"",messageFullId=event.sessionId+"-"+messageId;"me"===fromClass?(messageType="clientMessage",ariaLabel="client message",backgroundColor="main-background-color",textColor="second-color"):"sys"===fromClass?(messageType="systemMessage",ariaLabel="system message",backgroundColor="system-message",textColor="main-color",fromName="system message",icon='<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><path d="M9.811 2.327l-4.023 4.056-.045.069c-.073.074-.159.126-.249.16l-.03.008-.159.031-.121-.002-.123-.024-.063-.02c-.085-.032-.165-.083-.233-.153l-1.265-1.273c-.27-.272-.27-.713 0-.985.271-.272.708-.272.978 0l.848.854 3.59-3.621c.247-.249.646-.249.895 0 .246.248.246.651 0 .9zm-4.848-.994c-2.01 0-3.64 1.642-3.64 3.667 0 2.026 1.63 3.667 3.64 3.667 1.828 0 3.337-1.358 3.596-3.127l1.303-1.312c.038.252.064.509.064.772 0 2.762-2.222 5-4.963 5s-4.963-2.238-4.963-5c0-2.761 2.222-5 4.963-5 .991 0 1.911.296 2.686.799l-.963.971c-.513-.278-1.1-.437-1.723-.437z"/></svg>',msg=e.msg,commonUtilService.includes(msg,"$(name)")&&(msg=msg.replace("$(name)",htmlUtilService.escapeHtml(e.fromName))),commonUtilService.includes(msg,"$(firstName)")&&(msg=msg.replace("$(firstName)",htmlUtilService.escapeHtml(e.firstName||e.fromName))),commonUtilService.includes(msg,"$(lastName)")&&(msg=msg.replace("$(lastName)",htmlUtilService.escapeHtml(e.lastName||e.fromName)))):(messageType="agentMessage",ariaLabel="agent message",fromName=e.fromName,"session_msg"===fromClass&&(ariaLabel="session message",fromName="session message"),backgroundColor="agent-message",textColor="base-font");var background,noBg=!("none"!=logo&&!commonUtilService.isUndefined(logo));if(background="sys"===fromClass||commonUtilService.isUndefined(fromClass)||commonUtilService.stringIsTrue(logoUrldefault)?noBg?"":' style="background:url('+logo+') center center no-repeat;background-size:contain!important;border-radius:0"':noBg?"":' style="background:url('+logo+') center center no-repeat;background-size:cover!important;"',null!=e.attachments)try{for(var tmp=(new DOMParser).parseFromString(parsedMsg,"text/html");;){var nodes=tmp.getElementsByTagName("attachment");if(null==nodes||0==nodes.length)break;var node=nodes.item(0),id=node.getAttribute("id"),att=void 0;if(Array.isArray(e.attachments)){var i=0;for(i=0;i<e.attachments.length;i++)if(e.attachments[i].id==id){att=e.attachments[i];break}}if(null!=att){var contentType=att.contentType;if("application/vnd.microsoft.card.adaptive"==contentType){var card=JSON.parse(att.content),adaptiveCard=new window.AdaptiveCards.AdaptiveCard;adaptiveCard.onExecuteAction=function(action){this.open(action.url)},adaptiveCard.parse(card);var renderedCard=adaptiveCard.render();null!=renderedCard&&null!=node.parentNode&&node.parentNode.replaceChild(renderedCard,node)}else"application/vnd.microsoft.card.hero"==contentType?(newNode=tmp.createElement("div"),newNode.innerHTML="Unsupported Hero Card",node.parentNode.replaceChild(newNode,node)):"application/vnd.microsoft.teams.card.list"==contentType?(newNode=tmp.createElement("div"),newNode.innerHTML="Unsupported List Card",node.parentNode.replaceChild(newNode,node)):"application/vnd.microsoft.teams.card.o365connector"==contentType?(newNode=tmp.createElement("div"),newNode.innerHTML="Unsupported Office 365 Connector Card",node.parentNode.replaceChild(newNode,node)):"application/vnd.microsoft.card.thumbnail"==contentType?(newNode=tmp.createElement("div"),newNode.innerHTML="Unsupported Thumbnail Card",node.parentNode.replaceChild(newNode,node)):"application/vnd.microsoft.card.codesnippet"==contentType?(newNode=tmp.createElement("div"),newNode.innerHTML="Unsupported Code Snippet Card",node.parentNode.replaceChild(newNode,node)):0===contentType.lastIndexOf("application/vnd.microsoft",0)?(newNode=tmp.createElement("div"),newNode.innerHTML="Card: "+contentType,node.parentNode.replaceChild(newNode,node)):(newNode=tmp.createElement("div"),newNode.innerHTML="File: "+att.name,node.parentNode.replaceChild(newNode,node))}else node.parentNode.removeChild(node)}parsedMsg=tmp.documentElement.outerHTML}catch(exc){}var parsedMsg="",additionalClass="";if(e.buttonsData=function(str){try{if(str=htmlUtilService.htmlDecode(str).trim(),!buttonsCmdRegexp.test(str))return null;for(var buttonsCmdType=null,cmdIndex=-1,i=0;i<buttonsCmdTypes.length;++i)if(-1!==(cmdIndex=str.indexOf("/"+buttonsCmdTypes[i]))){buttonsCmdType=buttonsCmdTypes[i];break}var textMessage=str.slice(0,cmdIndex).trim();str=str.slice(cmdIndex);var buttons=[];i=str.indexOf("[");do{var endI=(str=str.slice(i+1)).indexOf("]");buttons.push(str.slice(0,endI)),i=(str=str.slice(endI+1)).indexOf("[")}while(-1!==i);return{message:textMessage,buttons:buttons,type:buttonsCmdType}}catch(e){console.error("Error in the message parsing (buttons): ",e)}return null}(msg),e.buttonsData){additionalClass="btns "+e.buttonsData.type;var clickedButtons=sessionStorage.getItem("bp-clicked-buttons-msg-id");clickedButtons=clickedButtons?JSON.parse(clickedButtons):[];var colorClass="choice"===e.buttonsData.type?" second-color":"";if(e.buttonsData.message&&(parsedMsg+='<span class="visible-message'+colorClass+'" tabindex="2" aria-live="polite" aria-label="'+htmlUtilService.escapeHtml(e.buttonsData.message)+'">'+e.buttonsData.message+"</span>"),-1===clickedButtons.indexOf(messageFullId)&&(parsedMsg+='<ul class="msg-buttons-container">'+e.buttonsData.buttons.reduce(function(str,buttonText){return str+'<li class="msg-button" tabindex="2"><button class="main-background-color second-color base-font" role="option" aria-label="'+htmlUtilService.escapeHtml(buttonText)+'">'+buttonText+"</button></li>"},"")+"</ul>"),""===parsedMsg)return e}else parsedMsg=function(str){var a=document.createElement("div");a.innerHTML=str;for(var c=a.childNodes,i=c.length;i--;)if(1==c[i].nodeType)return!0;return!1}(msg)?'<span class="visible-message">'+msg+"</span>":'<span class="visible-message" aria-live="polite" aria-label="'+htmlUtilService.escapeHtml(msg)+'">'+msg+"</span>";if(backgroundColor=backgroundColor+=commonUtilService.includes(additionalClass,"choice")?" main-background-color-important":"","true"===minimized&&"old"!==eventStatus){var passedTimeLabel=commonUtilService.getPassedTimeText(Number(e.timestamp)),popupMsgTmpl='<div id="min-'+messageFullId+'" class="min-msg-block slide-in-fwd-center '+additionalClass+'" data-timestamp="'+e.timestamp+'">'+("agent message"!==ariaLabel?"":'<div class="min-msg-sender" tabindex="2" aria-live="polite" aria-label="'+i18n.replyFromMessageText+" "+htmlUtilService.escapeHtml(fromName)+'"><span class="main-color">'+i18n.replyFromMessageText+'</span><span class="min-msg-agent-name">'+(fromName||" ").split(" ")[0]+"</span></div>")+'<div class="hidden-message" aria-live="polite" aria-label="'+ariaLabel+'">'+ariaLabel+'</div><div class="min-msg-text" tabindex="2">'+parsedMsg+'</div><div class="min-msg-time">'+passedTimeLabel+"</div></div>";$("#min_messages").append(popupMsgTmpl),commonUtilService.updateParentDimensions({height:{auto:!0}})}var tmpl="";if("date-message"===e.event)tmpl='<div tabindex="2" class="new-msg-container date-message '+lastMsg+'" data-timestamp="'+date.getTime()+'">'+parsedMsg+"</div>";else tmpl='<div id="'+messageFullId+'" class="'+("new-msg-container new-msg-animate "+messageType+collapsedIconClass+" "+additionalClass+" "+lastMsg)+'" data-timestamp="'+date.getTime()+'"><div class="pip '+backgroundColor+'"></div><div class="new-msg-body '+messageType+" "+backgroundColor+'"><div class="new-msg-body-inner"><div class="new-msg-text" style="height: auto; text-align: left">'+("agent message"===ariaLabel?'<div class="agent-image-wrapper"><div class="agent-image-background-filler main-background-color"></div><div tabindex="2" aria-live="polite" aria-label="'+htmlUtilService.escapeHtml(fromName)+'" class="agentImage"'+background+"></div></div>":"")+'<div tabindex="2" style="position: relative" class="new-msg-text-inner '+textColor+'">'+icon+'<div class="hidden-message" aria-live="polite" aria-label="'+ariaLabel+'">'+ariaLabel+"</div>"+parsedMsg+'</div></div></div><div class="new-time">'+("sys"!==fromClass?time:"")+"</div></div>";if($(tmpl).insertBefore(e.history?$("#messages_history_separator"):e.sessionHistory?$("#messages_session_history_separator"):$("#messages-div-inner-clear")),messageId){var buttonAction=function(e){window.chatSession.send(e.target.textContent.trim()),$("#"+messageFullId+" .msg-buttons-container").remove(),$("#"+messageFullId+" .new-msg-body, #"+messageFullId+" .pip").removeClass("main-background-color-important"),$("#"+messageFullId+" .visible-message").removeClass("second-color"),""===$("#"+messageFullId+" .visible-message").text().trim()&&$("#"+messageFullId).remove();var clickedButtons=sessionStorage.getItem("bp-clicked-buttons-msg-id");(clickedButtons=clickedButtons?JSON.parse(clickedButtons):[]).push(messageFullId),sessionStorage.setItem("bp-clicked-buttons-msg-id",JSON.stringify(clickedButtons)),setTimeout(clientChatPageUpdateScrollbar)},msgButtons=$("#"+messageFullId+" .msg-button, #min-"+messageFullId+" .msg-button");msgButtons.on("click touchend",buttonAction),msgButtons.on("keypress click touchend",function(e){13!==e.which&&32!==e.which||buttonAction(e)})}}return e}}(),clientChatUiChatMessageTyping=function(session,msg){var variables=clientChatUiVariables;variables.typingTimer?window.clearTimeout(variables.typingTimer):(session.sendTyping(msg),variables.msgTypingInterval=window.setInterval(function(){session.sendTyping($("#input-field").val())},1e3*variables.msgTypingTimeout)),variables.typingTimer=window.setTimeout(function(){clientChatUiNotTyping(session)},1e3*variables.notTypingTimeout)},clientChatUiEscapeHtml=function(string,escapeHtml){var div=document.createElement("div");escapeHtml?div.innerText=string:div.innerHTML=string;var links=[],patterns=[{pattern:/(?:^|(?!\s))((?:https?|ftp):\/\/\S+)/gim,template:'<a href="$1" target="_blank">$1</a>',isUrl:!0},{pattern:/(?:^|(?!\s))(www\.\S+)/gim,template:'<a href="http://$1" target="_blank">$1</a>',isUrl:!0,withoutProtocol:!0},{pattern:/(?:^|(?!\s))([a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+)/gim,template:'<a href="mailto:$1">$1</a>'}];return function traverse(node){switch(node.nodeType){case Node.TEXT_NODE:for(var chunks=function(text){for(var chunks=[],i=0;i<text.length;++i){var iType="\n"===text[i]?"new-line":"text";chunks.length&&chunks[chunks.length-1].type===iType?chunks[chunks.length-1].value+=text[i]:chunks.push({type:iType,value:text[i]})}return chunks}(node.textContent),k=0;k<chunks.length;++k)if("new-line"===chunks[k].type){var textNode=document.createTextNode(chunks[k].value);node.parentNode.insertBefore(textNode,node)}else if("text"===chunks[k].type)for(var result=replace(chunks[k].value),i=0;i<result.length;i++)node.parentNode.insertBefore(result[i],node);node.parentNode.removeChild(node);break;case Node.ELEMENT_NODE:if("A"!==node.nodeName)for(var i=0;i<node.childNodes.length;i++)traverse(node.childNodes[i])}}(div),div.innerHTML;function replace(text){var tempDiv=document.createElement("div");tempDiv.innerText=text;var escaped=tempDiv.innerHTML;patterns.forEach(function(pattern){escaped=escaped.replace(pattern.pattern,function(match,$1){if(pattern.isUrl&&!function(url,withoutProtocol){var tempAnchor=document.createElement("a");tempAnchor.href=withoutProtocol?"http://"+url:url;return!!tempAnchor.host}($1,pattern.withoutProtocol))return $1;var id="$$$link$$$"+Math.random().toString(36).slice(2)+"$$$";return links.push({template:pattern.template,id:id,match:$1}),id})}),links.forEach(function(link){var html=link.template.replace("$1",link.match).replace("$1",link.match);escaped=escaped.replace(link.id,html)}),tempDiv.innerHTML=escaped;for(var result=[],i=0;i<tempDiv.childNodes.length;i++)result.push(tempDiv.childNodes[i]);return result}},clientChatUiI18n=function(){var definition=widgetConfiguration.getDefinition(),chatWidgetStyling=definition?definition.chatWidgetStyling:null,defaultWidgetStyling={inactivityTimeoutMessage:"Your session has expired due to inactivity.",inactivityWarningMessage:"We have not heard from you for some time. Please respond within the next few minutes to keep your chat session connected.",sessionEndedMessage:"Chat session has ended",networkConnectionErrorMessage:"Internet connection error",networkConnectionEstablishedMessage:"Internet connection established",agentJoinedMessage:"has joined the chat",agentLeftMessage:"has left the chat",imageWasSent:"has sent you an image",fileWasSent:"has sent you an attachment",refersToRequiredFields:"* Refers to Required Fields",requiredField:"Please fill",invalidInputField:"Invalid input",file:"File",isNotAvailable:"is not available",notificationsPrompt:"When prompted, please allow notifications from this window, so you could see responses when this window is hidden.",allowMicroPrompt:"When prompted, please allow access to your microphone.",allowMicroVideoPrompt:"When prompted, please allow access to your camera and microphone.",cobrowsingDialogText:"By clicking Accept, an agent will join you on the page you are currently viewing. The agent can view and help you as you browse the web in this tab. The agent will not see login details, passwords, other browser tabs or programs you have opened. You can stop co-browsing at any time, by clicking X in the menu or by closing this tab in your browser.",cobrowsingDialogHeader:"Start co-browsing",cobrowsingDialogAcceptLabel:"Accept",cobrowsingDialogCancelLabel:"Cancel",sessionCompletedWidgetTitle:"Session completed",agentTypingIndicator:"$(name) is typing",replyFromMessageText:"Reply from",justNowMessageArrivalTimeIndicator:"just now",minutesAgoMessageArrivalTimeIndicator:"m ago",hoursAgoMessageArrivalTimeIndicator:"h ago",daysAgoMessageArrivalTimeIndicator:"d ago",someTimeAgoMessageArrivalTimeIndicator:"Some time ago",hintMessageTextBox:"Text...",showChatTooltip:"Show chat",endChatTooltip:"End chat",minimizeChatTooltip:"Minimize chat",shareScreenTooltip:"Share screen",webRtcCallTooltip:"Call me",webRtcSwitchVideoTooltip:"Switch video",webRtcEndCallTooltip:"End call",emojiTooltip:"Emoji",sendFileTooltip:"Send file",minimizedDismissMessagesTooltip:"Dismiss",screenSharingRequestedMessageText:"Screen sharing request sent",screenSharingEndedMessageText:"Screen sharing session ended",clickToStartCobrowsingPrompt:"Click to start co-browsing session",cobrowsingRequestedMessageText:"Co-browsing session requested",cobrowsingRejectedMessageText:"Co-browsing session rejected",cobrowsingStartedMessageText:"Co-browsing session started",cobrowsingEndedMessageText:"Co-browsing session ended",cameraNotDetectedText:"Web camera not detected",microNotDetectedText:"Microphone not detected",surveyFormTitle:"Please leave us feedback",surveyFormWasIssueResolvedQuestion:"Did we provide the service you were looking for?",surveyFormWasIssueResolvedPositiveAnswer:"yes",surveyFormWasIssueResolvedNegativeAnswer:"no",surveyFormContactSatisfactionQuestion:"How helpful was our representative?",surveyFormNetPromoterScoreQuestion:"How likely are you to recommend our products and services in the future?",surveyFormSendChatTranscriptQuestion:"Send me transcript of the chat by email?",surveyFormEmailFieldLabel:"Your email*",surveyFormEmailValidationErrorText:"Wrong value"};function getTranslation(propName){return chatWidgetStyling&&commonUtilService.isDefined(chatWidgetStyling[propName])?chatWidgetStyling[propName]:defaultWidgetStyling[propName]}return{inactivityTimeoutMessage:getTranslation("inactivityTimeoutMessage"),inactivityWarningMessage:getTranslation("inactivityWarningMessage"),sessionEndedMessage:getTranslation("sessionEndedMessage"),networkConnectionErrorMessage:getTranslation("networkConnectionErrorMessage"),networkConnectionEstablishedMessage:getTranslation("networkConnectionEstablishedMessage"),agentJoinedMessage:getTranslation("agentJoinedMessage"),agentLeftMessage:getTranslation("agentLeftMessage"),refersToRequiredFields:getTranslation("refersToRequiredFields"),requiredField:getTranslation("requiredField"),imageWasSent:getTranslation("imageWasSent"),fileWasSent:getTranslation("fileWasSent"),invalidInputField:getTranslation("invalidInputField"),file:getTranslation("file"),isNotAvailable:getTranslation("isNotAvailable"),notificationsPrompt:getTranslation("notificationsPrompt"),allowMicroPrompt:getTranslation("allowMicroPrompt"),allowMicroVideoPrompt:getTranslation("allowMicroVideoPrompt"),cobrowsingDialogText:getTranslation("cobrowsingDialogText"),cobrowsingDialogHeader:getTranslation("cobrowsingDialogHeader"),cobrowsingDialogAcceptLabel:getTranslation("cobrowsingDialogAcceptLabel"),cobrowsingDialogCancelLabel:getTranslation("cobrowsingDialogCancelLabel"),sessionCompletedWidgetTitle:getTranslation("sessionCompletedWidgetTitle"),agentTypingIndicator:getTranslation("agentTypingIndicator"),replyFromMessageText:getTranslation("replyFromMessageText"),justNowMessageArrivalTimeIndicator:getTranslation("justNowMessageArrivalTimeIndicator"),minutesAgoMessageArrivalTimeIndicator:getTranslation("minutesAgoMessageArrivalTimeIndicator"),hoursAgoMessageArrivalTimeIndicator:getTranslation("hoursAgoMessageArrivalTimeIndicator"),daysAgoMessageArrivalTimeIndicator:getTranslation("daysAgoMessageArrivalTimeIndicator"),someTimeAgoMessageArrivalTimeIndicator:getTranslation("someTimeAgoMessageArrivalTimeIndicator"),hintMessageTextBox:getTranslation("hintMessageTextBox"),showChatTooltip:getTranslation("showChatTooltip"),endChatTooltip:getTranslation("endChatTooltip"),minimizeChatTooltip:getTranslation("minimizeChatTooltip"),shareScreenTooltip:getTranslation("shareScreenTooltip"),webRtcCallTooltip:getTranslation("webRtcCallTooltip"),webRtcSwitchVideoTooltip:getTranslation("webRtcSwitchVideoTooltip"),webRtcEndCallTooltip:getTranslation("webRtcEndCallTooltip"),emojiTooltip:getTranslation("emojiTooltip"),sendFileTooltip:getTranslation("sendFileTooltip"),minimizedDismissMessagesTooltip:getTranslation("minimizedDismissMessagesTooltip"),screenSharingRequestedMessageText:getTranslation("screenSharingRequestedMessageText"),screenSharingEndedMessageText:getTranslation("screenSharingEndedMessageText"),clickToStartCobrowsingPrompt:getTranslation("clickToStartCobrowsingPrompt"),cobrowsingRequestedMessageText:getTranslation("cobrowsingRequestedMessageText"),cobrowsingRejectedMessageText:getTranslation("cobrowsingRejectedMessageText"),cobrowsingStartedMessageText:getTranslation("cobrowsingStartedMessageText"),cobrowsingEndedMessageText:getTranslation("cobrowsingEndedMessageText"),cameraNotDetectedText:getTranslation("cameraNotDetectedText"),microNotDetectedText:getTranslation("microNotDetectedText"),surveyFormTitle:getTranslation("surveyFormTitle"),surveyFormWasIssueResolvedQuestion:getTranslation("surveyFormWasIssueResolvedQuestion"),surveyFormWasIssueResolvedPositiveAnswer:getTranslation("surveyFormWasIssueResolvedPositiveAnswer"),surveyFormWasIssueResolvedNegativeAnswer:getTranslation("surveyFormWasIssueResolvedNegativeAnswer"),surveyFormContactSatisfactionQuestion:getTranslation("surveyFormContactSatisfactionQuestion"),surveyFormNetPromoterScoreQuestion:getTranslation("surveyFormNetPromoterScoreQuestion"),surveyFormSendChatTranscriptQuestion:getTranslation("surveyFormSendChatTranscriptQuestion"),surveyFormEmailFieldLabel:getTranslation("surveyFormEmailFieldLabel"),surveyFormEmailValidationErrorText:getTranslation("surveyFormEmailValidationErrorText")}},clientChatUiMsgKeyPress=function(event,session){if(13==event.which&&"keyup"!==event.type)if(event.shiftKey){var chatLog=$("#chatLog"),msg=$("#input-field,.emoji-wysiwyg-editor"),scroll1=msg.scrollTop();setTimeout(function(){if(msg.scrollTop()>scroll1){if(chatLog.height()>64){var h=msg.height();msg.height(h+16),0===scroll1&&msg.scrollTop(0)}}},10),clientChatUiChatMessageTyping(session)}else event.preventDefault(),event.stopImmediatePropagation(),clientChatUiSendMessage(session),$(".emoji-wysiwyg-editor").html("");else clientChatUiChatMessageTyping(session)},clientChatUiNotTyping=function(session){var variables=clientChatUiVariables;variables.typingTimer&&(window.clearInterval(variables.msgTypingInterval),variables.msgTypingInterval=null,$("input-field").val()?session.sendTyping($("#input-field").val()):session.sendNotTyping(),variables.typingTimer=null)},clientChatUiPrepareEvent=function(event){var i18n=clientChatUiI18n();function updateEventData(event,msg,originalMsg,fromClass){event.msg=msg,event.originalMsg=originalMsg,commonUtilService.isUndefined(fromClass)||(event.fromClass=fromClass)}switch(event.event){case commonConstants.events.chat.session.PARTY_JOINED:updateEventData(event,i18n.agentJoinedMessage,event.msg);break;case commonConstants.events.chat.session.PARTY_LEFT:updateEventData(event,i18n.agentLeftMessage,event.msg);break;case commonConstants.events.chat.session.NETWORK_CONNECTION_ERROR:updateEventData(event,i18n.networkConnectionErrorMessage,event.msg);break;case commonConstants.events.chat.session.NETWORK_CONNECTION_ESTABLISHED:updateEventData(event,i18n.networkConnectionEstablishedMessage,event.msg);break;case commonConstants.events.chat.session.ENDED:updateEventData(event,i18n.sessionEndedMessage,event.msg);break;case commonConstants.events.chat.session.TIMEOUT_WARNING:updateEventData(event,i18n.inactivityWarningMessage,event.msg);break;case commonConstants.events.chat.session.INACTIVITY_TIMEOUT:updateEventData(event,i18n.inactivityTimeoutMessage,event.msg);break;case commonConstants.events.chat.session.COBROWSING_REQUESTED:updateEventData(event,i18n.cobrowsingRequestedMessageText,event.msg);break;case commonConstants.events.chat.session.COBROWSING_REJECTED:updateEventData(event,i18n.cobrowsingRejectedMessageText,event.msg);break;case commonConstants.events.chat.session.COBROWSING_STARTED:updateEventData(event,i18n.cobrowsingStartedMessageText,event.msg);break;case commonConstants.events.chat.session.COBROWSING_ENDED:updateEventData(event,i18n.cobrowsingEndedMessageText,event.msg);break;case commonConstants.events.chat.session.FILE:var originalMsg,link='<a target="_blank" href="__href__" '+(event.history?'style="display: none;"':"")+' class="msg-file-link">__text__</a>',text="";"image"===event.file_type?(originalMsg=event.fromName+" "+i18n.imageWasSent,text='<img class="thumb" style="vertical-align: top;" src="'+event.fileUrl+'" />'):(originalMsg=event.fromName+" "+i18n.fileWasSent+' "'+event.file_name+'"',text='Download "'+event.file_name+'"'),msg=link.replace("__href__",event.fileUrl).replace("__text__",text),event.history&&(msg+='<span class="msg-file-stub">'+i18n.file+' "'+event.file_name+'" '+i18n.isNotAvailable+"</span>"),updateEventData(event,msg,originalMsg);break;case"date-message":updateEventData(event,msg=dateFormat(parseInt(event.date),dateFormat.masks.mediumDate),msg);break;default:var msg;updateEventData(event,msg=event.msg?clientChatUiEscapeHtml(event.msg,!1):void 0,event.msg)}return event},clientChatUiSendLocation=function(session){navigator.geolocation.getCurrentPosition(function(position){session.sendLocation(position.coords.latitude,position.coords.longitude)},function(failure){alert(failure.message)})},clientChatUiSendMessage=function(session){var messageValue=$(".emoji-wysiwyg-editor").html();messageValue&&(session.send(messageValue),$("#input-field").val(""),$(".emoji-wysiwyg-editor").html(""),clientChatUiNotTyping(session))},clientChatUiSendNavigation=function(session,href,title){session.sendNavigation(href,title)},clientChatUiVariables={typingTimer:null,msgTypingInterval:null,notTypingTimeout:30,msgTypingTimeout:3,entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}},callbackUtilService=function(){var errorStyle="position: relative;\ntop: -39px;\nbackground: #fbf0d1;\ncolor: #434343;\npadding: 4px;\nfloat: right;\nborder: 1px solid #f7ecc5;\nborder-radius: 4px;\n";function insertError(field,text){var i18n=clientChatUiI18n(),fieldError=document.createElement("div"),message=text||i18n.requiredField;fieldError.setAttribute("id","error-"+field.id),fieldError.setAttribute("style",errorStyle),fieldError.classList.add("error-message"),fieldError.innerText=message,field.parentNode.insertBefore(fieldError,field.nextSibling)}function loopFormFields(formId,callback){var form=document.getElementById(formId);if(void 0!==form){var fields=form.getElementsByTagName("input");if(void 0!==fields&&fields.length)for(var i=0;i<fields.length;i++){callback(fields[i])}}}return{isCallbackFormValid:function(formId){var isFormValid=!0,radioGroupValidated=[];return function(className){for(var elements=document.getElementsByClassName(className);elements.length>0;)elements[0].parentNode.removeChild(elements[0])}("error-message"),loopFormFields(formId,function(field){var isFieldValid=!0,type=field.type;if(field&&field.attributes&&field.attributes.hasOwnProperty("required")&&!field.value&&(isFieldValid=!1,insertError(field)),"radio"===type&&-1===radioGroupValidated.indexOf(field.name)){var radioGroup=document.getElementsByName(field.name),isRadioChecked=!1;radioGroupValidated.push(field.name);for(var i=0;i<radioGroup.length;i++)radioGroup[i].checked&&(isRadioChecked=!0);isRadioChecked||insertError(radioGroup[radioGroup.length-1]),isFieldValid=isRadioChecked}isFieldValid||(isFormValid=!1)}),isFormValid},getSnippetFormValues:function(formId){var platform=window.platform,resultConfig={parameters:{user_platform:{browser:platform.name+" "+platform.version,os:platform.os.toString(),description:platform.description}}},spConf=SERVICE_PATTERN_CHAT_CONFIG;loopFormFields(formId,function(field){var fieldId=field.id,fieldValue=field.value;("radio"!==field.type||(fieldId=field.name,field.checked))&&void 0!==fieldId&&void 0!==fieldValue&&(fieldId=fieldId.split("sp-callback-").reverse().join(""),!fieldValue&&spConf[fieldId]&&(fieldValue=spConf[fieldId]),"phone_number"!==fieldId&&"phone"!==fieldId||(resultConfig[fieldId]=fieldValue),resultConfig.parameters[fieldId]=fieldValue)});for(var spConfFields=["email","last_name","first_name","account_number","logging","location","phone_number"],i=0;i<spConfFields.length;i++)"phone_number"!==(key=spConfFields[i])&&"phone"!==key||resultConfig[key]||!spConf[key]||(resultConfig[key]=spConf[key]),!resultConfig.parameters[key]&&spConf[key]&&(resultConfig.parameters[key]=spConf[key]);if(spConf.parameters)for(var key in spConf.parameters)spConf.parameters.hasOwnProperty(key)&&spConf.parameters[key]&&!resultConfig.parameters[key]&&(resultConfig.parameters[key]=spConf.parameters[key]);return resultConfig}}}(),commonUtilService=function(){function isDefined(item){return void 0!==item}function isString(item){return"string"==typeof item}function isLeapYear(year){return year%4==0&&year%100!=0||year%400==0}function getIncomingEventStatus(event){var bpLastMessageTimestampData=sessionStorage.getItem("bp-last-message-timestamp");if(!bpLastMessageTimestampData)return"new";if(bpLastMessageTimestampData=JSON.parse(bpLastMessageTimestampData),isDefined(event.timestamp)){if(!bpLastMessageTimestampData.timestamp)return"new";try{var newTimestampNumber=Number(event.timestamp),lastTimestampMinNumber=Number(bpLastMessageTimestampData.timestampMin),lastTimestampNumber=Number(bpLastMessageTimestampData.timestamp);return bpLastMessageTimestampData.timestampMin?newTimestampNumber>lastTimestampNumber?"new":newTimestampNumber>lastTimestampMinNumber?"not-viewed":"old":newTimestampNumber>lastTimestampNumber?"new":"old"}catch(e){}}return"old"}var defaultData={height:{value:void 0,auto:!0},width:{value:void 0,auto:!0}};function obfuscate(str,key,n){if(void 0===n&&(n=126),"number"!=typeof key||key%1!=0||"number"!=typeof key||key%1!=0)return str;for(var chars=str.split(""),i=0;i<chars.length;i++){chars[i].charCodeAt(0)<=n&&(chars[i]=String.fromCharCode((chars[i].charCodeAt(0)+key)%n))}return chars.join("")}return{includes:function(str1,str2){return isString(str1)&&isString(str1)&&-1!==str1.indexOf(str2)},isUndefined:function(item){return void 0===item},isDefined:isDefined,isObject:function(item){return"object"==typeof item},isString:isString,isNumber:function(item){return"number"!=typeof item},isJsonString:function(str){try{JSON.parse(str)}catch(e){return!1}return!0},forEach:function(array,callback){if(Array.isArray(array))for(var i=0;i<array.length;i++)callback(array[i],i)},merge:function(object1,object2){var newObj={};for(var key in object1)newObj[key]=object1[key];for(var key in object2)newObj[key]=object2[key];return newObj},startsWith:function(str,prefix){return"string"==typeof str&&str.substring(0,prefix.length)===prefix},stringIsTrue:function(str){var result=!1;try{result=!0===JSON.parse(str)}catch(err){}return result},stringIsFalse:function(str){var result=!1;try{result=!1===JSON.parse(str)}catch(err){}return result},isServiceAvailable:function(){return"true"==sessionStorage.getItem("serviceAvailable")},isServiceNotAvailable:function(){return"false"==sessionStorage.getItem("serviceAvailable")},isEWTExceedThreshold:function(threshold){var ewt=sessionStorage.getItem("ewt")||0;return console.log("EWT: "+ewt),ewt>threshold},validateDate:function(dateString){if(!dateString.match(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/))return!1;var parts=dateString.split("/"),day=parseInt(parts[1],10),month=parseInt(parts[0],10),year=parseInt(function(year){var currentYear=(new Date).getFullYear();return 2===year.length&&(year=parseInt("20"+year)>currentYear?"19"+year:"20"+year),year}(parts[2]),10);if(year<1e3||year>3e3||0==month||month>12)return!1;var monthLength=[31,isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31];return day>0&&day<=monthLength[month-1]},validateEmail:function(email){return email.length<=255&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)&&!/[^\x00-\x7F]/g.test(email)},validatePhoneNumber:function(phone){if(phone.length<=30){var phoneArr=phone.split("");return(-1===phoneArr.indexOf("+")||!(phone.split("+").length-1>1||0!==phoneArr.indexOf("+")))&&/^[0-9+().\/\\\-\s]*$/gm.test(phone)}return!1},isIE:function(){return ua=navigator.userAgent,ua.indexOf("MSIE ")>-1||ua.indexOf("Trident/")>-1},isSafari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},getIncomingEventStatus:getIncomingEventStatus,saveLastEventTimestamp:function(event){if("new"===getIncomingEventStatus(event)){var bpLastMessageTimestampData=sessionStorage.getItem("bp-last-message-timestamp");bpLastMessageTimestampData&&(bpLastMessageTimestampData=JSON.parse(bpLastMessageTimestampData));var timestampMin=null;bpLastMessageTimestampData&&"true"===sessionStorage.getItem("bp-minimized")&&(timestampMin=bpLastMessageTimestampData.timestampMin?bpLastMessageTimestampData.timestampMin:bpLastMessageTimestampData.timestamp);var timestamp=event.timestamp?event.timestamp:bpLastMessageTimestampData?bpLastMessageTimestampData.timestamp:null;sessionStorage.setItem("bp-last-message-timestamp",JSON.stringify({timestamp:timestamp,timestampMin:timestampMin}))}},getPassedTimeText:function(timestampInSeconds){timestampInSeconds=parseInt(timestampInSeconds);var ret,i18n=clientChatUiI18n(),secondsNow=Math.floor(Date.now()/1e3),label="";try{var minutes=Math.floor((secondsNow-timestampInSeconds)/60);if(minutes<=1)return i18n.justNowMessageArrivalTimeIndicator;if(minutes<60)ret=minutes,label=i18n.minutesAgoMessageArrivalTimeIndicator;else{var hours=Math.floor(minutes/60);hours<24?(ret=hours,label=i18n.hoursAgoMessageArrivalTimeIndicator):(ret=Math.floor(hours/24),label=i18n.daysAgoMessageArrivalTimeIndicator)}}catch(e){}return!ret||isNaN(ret)?i18n.someTimeAgoMessageArrivalTimeIndicator:ret+label},updateParentDimensions:function(data){data||(data=defaultData);var iter=0;!function updateCall(){if(!(iter>20)){iter++;var minInnerChat=document.getElementById("min_inner_chat");if(minInnerChat){var cmpStyle=getComputedStyle(minInnerChat),boundingRect=minInnerChat.getBoundingClientRect();if("none"===cmpStyle.display||"auto"===cmpStyle.height)return setTimeout(updateCall,50);var currentMsgNumber=Number(sessionStorage.getItem("bp-min-message-counter"));parent.postMessage(JSON.stringify({type:"bp-dimensions",data:{height:data.height&&data.height.value?data.height.value:data.height&&data.height.auto?currentMsgNumber>0?boundingRect.height+"px":"0":void 0,width:data.width&&data.width.value?data.width.value:data.width&&data.width.auto&&"auto"!==cmpStyle.width?boundingRect.width+"px":void 0}}),"*")}}}()},obfuscate:obfuscate,deobfuscate:function(str,key,n){return void 0===n&&(n=126),"number"!=typeof key||key%1!=0||"number"!=typeof key||key%1!=0?str:obfuscate(str,n-key)},extractHostname:function(url){return(url.indexOf("//")>-1?url.split("/")[2]:url.split("/")[0]).split(":")[0].split("?")[0]},areDatesEqual:function(date1,date2){try{return date1=new Date(parseInt(date1)),date2=new Date(parseInt(date2)),date1.getFullYear()===date2.getFullYear()&&date1.getMonth()===date2.getMonth()&&date1.getDate()===date2.getDate()}catch(e){console.error("Unable to parse date: ",date1," or ",date2)}return!1},fixTimestamp:function(timestamp){return"string"==typeof timestamp?10===timestamp.length?timestamp+"000":timestamp:"number"==typeof timestamp&&timestamp<9999999999?1e3*timestamp:timestamp}}}(),commonConstants={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",events:{chat:{session:{NETWORK_CONNECTION_ERROR:"network_connection_error",NETWORK_CONNECTION_ESTABLISHED:"network_connection_established",SECURE_FORM_CANCEL:"chat_session_secure_form_cancel",SECURE_FORM_SHOW:"chat_session_secure_form_show",SECURE_FORM_DATA:"chat_session_secure_form_data",FORM_DATA:"chat_session_form_data",FORM_DATA_CANCEL:"chat_form_data_cancel",INFO:"chat_session_info",TYPING:"chat_session_typing",NOT_TYPING:"chat_session_not_typing",FORM_SHOW:"chat_session_form_show",STATUS:"chat_session_status",ENDED:"chat_session_ended",PARTY_JOINED:"chat_session_party_joined",PARTY_LEFT:"chat_session_party_left",MESSAGE:"chat_session_message",FILE:"chat_session_file",TIMEOUT_WARNING:"chat_session_timeout_warning",INACTIVITY_TIMEOUT:"chat_session_inactivity_timeout",LOCATION:"chat_session_location",NAVIGATION:"chat_session_navigation",END:"chat_session_end",DISCONNECT:"chat_session_disconnect",SIGNALING:"chat_session_signaling",COBROWSING_REQUESTED:"chat_session_cobrowsing_requested",COBROWSING_REJECTED:"chat_session_cobrowsing_rejected",COBROWSING_STARTED:"chat_session_cobrowsing_started",COBROWSING_ENDED:"chat_session_cobrowsing_ended",CASE_SET:"chat_session_case_set"},actions:{HIDE:"hide"}}}},htmlUtilService={wrapWithDiv:function(classWrapper,inner,id){return"<div "+(id?'id="'+id+'" ':"")+(classWrapper?'class="'+classWrapper+'"':"")+">"+inner+"</div>"},wrapWithLabel:function(classWrapper,inner,id,forAttr){return"<label "+(id?'id="'+id+'" ':"")+(forAttr?'for="'+forAttr+'" ':"")+(classWrapper?'class="'+classWrapper+'"':"")+">"+inner+"</label>"},generateInput:function(type,id,value,validate,name,placeholder,isRequired,ariaRequired,className){return'<input class="'+className+'" value="'+value+'" type="'+type+'" id="'+id+'" name="'+name+'" placeholder="'+placeholder+'" '+(validate?'data-validate="'+validate+'" ':"")+("true"===isRequired?'required="'+isRequired+'" ':"")+(ariaRequired?'aria-required="'+ariaRequired+'"':"")+" />"},generateTextArea:function(id,name,value,placeholder,rows,isRequired,ariaRequired,className){return'<textarea class="'+className+'" id="'+id+'" name="'+name+'" placeholder="'+placeholder+'" '+("true"===isRequired?'required="'+isRequired+'" ':"")+(""!==rows?'rows="'+rows+'" ':'height="80px" ')+(ariaRequired?'aria-required="'+ariaRequired+'"':"")+">"+value+"</textarea>"},insertStyles:function(target,position,pathArray){Array.isArray(pathArray)&&commonUtilService.forEach(pathArray,function(path){target.insertAdjacentHTML(position,'<link href="'+path+'" type="text/css" rel="stylesheet" />')})},displayNone:function(element){element&&element.css&&element.css("display","none")},displayBlock:function(element){element&&element.css&&element.css("display","block")},displayInlineBlock:function(element){element&&element.css&&element.css("display","inline-block")},displayFlex:function(element){element&&element.css&&element.css("display","flex")},hasElementRequiredFields:function(elementSelector){return $(elementSelector+' *[required="true"]').length>0},setDivHoverById:function(elementId,title){if(document&&elementId&&title){var element=document.getElementById(elementId);element&&element.setAttribute("title",title)}},htmlDecode:function(input){return"function"!=typeof DOMParser?input:(new DOMParser).parseFromString(input,"text/html").documentElement.textContent},escapeHtml:function(unsafe){return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},buildProactiveOfferPreview=function(){var config=widgetConfiguration.getObject(),styling=config.styling,properties=config.properties,$offer=$(".proactive-offer"),$content=$offer.find(".proactive-offer__content");if("proactive_offer"===config.widgetType){var paAnimationIn=styling.animationIn,paAnimationOut=styling.animationOut,paPosition=styling.location||"center",paAnimationInAttr=commonUtilService.includes(paAnimationIn,"slide")?paPosition+"_"+paAnimationIn:paAnimationIn,paAnimationOutAttr=commonUtilService.includes(paAnimationOut,"slide")?paPosition+"_"+paAnimationOut:paAnimationOut,$body=$offer.find(".proactive-offer__body"),$callButton=$offer.find(".proactive-offer__button_type_call"),$chatButton=$offer.find(".proactive-offer__button_type_chat"),$closeButton=$offer.find(".proactive-offer__close.proactive-offer__button"),$close=$offer.find(".proactive-offer__close.close-icon");$callButton.toggleClass("proactive-offer__button_hide_yes",!properties.callButtonEnabled),$chatButton.toggleClass("proactive-offer__button_hide_yes",!properties.chatButtonEnabled),$callButton.text(properties.callButtonText),$chatButton.text(properties.chatButtonText),$closeButton.text(properties.cancelButtonText),$close.toggleClass("proactive-offer__close_hide_yes",!properties.closeButtonEnabled),$content.html(properties.htmlContent),$body.width(styling.width).height(styling.height)}widgetConfiguration.isPreviewMode()&&($offer.removeClass(),$offer.addClass("widget-background proactive-offer base-font"),$offer&&($offer.removeAttr("data-animationIn"),$offer.attr("data-animationIn",paAnimationInAttr),$offer.removeClass("position_center"),$offer.addClass("position_"+paPosition),styling&&sessionStorage.getItem("data-animationOut")!=paAnimationOutAttr&&(sessionStorage.setItem("runOutAnimation",!0),setTimeout(function(){sessionStorage.removeItem("runOutAnimation")},1e3))),sessionStorage.getItem("runOutAnimation")&&($offer.removeAttr("data-animationIn").removeAttr("data-animationOut").removeClass("removing"),$offer.attr("data-animationOut",paAnimationOutAttr),$offer.addClass("removing"),setTimeout(function(){$offer.removeAttr("data-animationOut").removeClass("removing"),sessionStorage.removeItem("runOutAnimation")},700)),styling&&sessionStorage.setItem("data-animationOut",paAnimationOutAttr))},proactiveChatStarter=function(chatCb){var poConfig=widgetConfiguration.getProactiveOffer();if(poConfig&&poConfig.conditions){var conf={proactiveOfferCondition:poConfig.conditions,proactiveOfferStyling:poConfig.styling},proactiveChatRuleMatcher={days_of_week:{days:["SU","MO","TU","WE","TH","FR","SA"],fnCheck:function(args){var d=new Date,day=this.days[d.getDay()];return!!this.values[day]},fnCopyConf:function(confObj,rtObj,checker){rtObj.fnCheck=this.fnCheck,rtObj.values={};for(var i=0;i<confObj.values.length;++i)rtObj.values[confObj.values[i]]=!0;return rtObj.days=this.days,checker.timerCbMin=!0,rtObj}},days_of_month:{fnCheck:function(args){var day=(new Date).getDate();return!!this.values[day]},fnCopyConf:function(confObj,rtObj,checker){rtObj.fnCheck=this.fnCheck,rtObj.values=[];for(var i=0;i<confObj.values.length;++i)rtObj.values[parseInt(confObj.values[i])]=!0;return checker.timerCbMin=!0,rtObj}},time_of_day:{fnCheck:function(args){var d=new Date,sec=3600*d.getHours()+60*d.getMinutes()+d.getSeconds();return this.from<=sec&&this.to>sec},fnCopyConf:function(confObj,rtObj,checker){return rtObj.fnCheck=this.fnCheck,rtObj.from=confObj.from,rtObj.to=confObj.to,checker.timerCbSec=!0,rtObj}},months:{months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],fnCheck:function(args){var d=new Date,mon=this.month[d.getMonth()];return!!this.values[mon]},fnCopyConf:function(confObj,rtObj,checker){rtObj.fnCheck=this.fnCheck,rtObj.values={};for(var i=0;i<confObj.values.length;++i)rtObj.values[confObj.values[i]]=!0;return rtObj.month=this.months,checker.timerCbMin=!0,rtObj}},referring_url:{fnCopyConf:function(confObj,rtObj,checker){return new RegEx(confObj.value,"i").test(document.referrer)?rtObj.fnCheck=function(){return!0}:checker.noCheck=!0,rtObj}},language:{fnCopyConf:function(confObj,rtObj,checker){return navigator.language==confObj.value||navigator.language==confObj.value.substr(0,2)?rtObj.fnCheck=function(){return!0}:checker.noCheck=!0,rtObj}},mobile:{fnCopyConf:function(confObj,rtObj,checker){return widgetConfiguration.isMobile()?rtObj.fnCheck=function(){return!0}:checker.noCheck=!0,rtObj}},nonmobile_browser:{fnCopyConf:function(confObj,rtObj,checker){return widgetConfiguration.isMobile()?checker.noCheck=!0:rtObj.fnCheck=function(){return!0},rtObj}},js_variable:{fnCheck:function(args){var ret=!1;try{ret=!!eval(this.value)}catch(e){}return ret},fnCopyConf:function(confObj,rtObj,checker){var v=confObj.value.toString();return/[$a-zA-Z_][$a-zA-Z0-9_]*/.exec(v)!=v?(checker.noCheck=!0,rtObj):(rtObj.fnCheck=this.fnCheck,rtObj.value="!!"+v,checker.timerCbSec=!0,rtObj)}},number_of_clicks:{fnCheck:function(args){return!1},fnCopyConf:function(confObj,rtObj,checker){rtObj.fnCheck=this.fnCheck;var nc=parseInt(confObj.value);if(nc<1)return checker.noCheck=!0,rtObj;rtObj.clicksLeft=nc;var cb={ev:"click",el:document,fn:function(){--rtObj.clicksLeft<=0&&(rtObj.fnCheck=function(){return!0})}};return checker.eventCb.push(cb),rtObj}},cookie:{fnCopyConf:function(confObj,rtObj,checker){for(var name=confObj.value,ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return rtObj.fnCheck=function(){return!0},rtObj}return checker.noCheck=!0,rtObj}},page_url:{fnCopyConf:function(confObj,rtObj,checker){var uri=document.baseURI;return new RegExp(confObj.value,"i").test(uri)?(rtObj.fnCheck=function(){return!0},rtObj):(checker.noCheck=!0,rtObj)}},about_to_exit:{fnCheck:function(args){return!1},fnCopyConf:function(confObj,rtObj,checker){rtObj.fnCheck=this.fnCheck;var cb={ev:"mouseout",el:document,fn:function(e){(e=e||window.event).pageY<=10&&(rtObj.fnCheck=function(){return!0})}};return checker.eventCb.push(cb),rtObj}},url_in_history:{fnCopyConf:function(confObj,rtObj,checker){var uri=document.baseURI,history=window.localStorage.getItem("pagesVisitedUrls").split(",");for(let i=0;i<history.length;i++){if(new RegExp(history[i],"i").test(uri))return rtObj.fnCheck=function(){return!0},rtObj}return checker.noCheck=!0,rtObj}},first_visit:{fnCopyConf:function(confObj,rtObj,checker){return checker.visitStat.firstVisit?(rtObj.fnCheck=function(){return!0},rtObj):(checker.noCheck=!0,rtObj)}},pages_visited_n:{fnCopyConf:function(confObj,rtObj,checker){return checker.visitStat.pagesVisited>=parseInt(confObj.value)?(rtObj.fnCheck=function(){return!0},rtObj):(checker.noCheck=!0,rtObj)}},visit_duration:{fnCheck:function(args){return Date.now()/1e3>=this.visitStop},fnCopyConf:function(confObj,rtObj,checker){return rtObj.fnCheck=this.fnCheck,rtObj.visitStop=Date.now()/1e3+parseInt(confObj.value),checker.timerCbSec=!0,rtObj}},max_wait_time:{fnCheck:function(args){var ewt=parseInt(sessionStorage.getItem("ewt"));return parseInt(this.visitStop)>=ewt},fnCopyConf:function(confObj,rtObj,checker){return rtObj.fnCheck=this.fnCheck,rtObj.visitStop=parseInt(confObj.value),checker.timerCbSec=!0,rtObj}},estimated_wait_time:{fnCheck:function(args){var ewt=parseInt(sessionStorage.getItem("ewt"));return parseInt(this.visitStop)>=ewt},fnCopyConf:function(confObj,rtObj,checker){return rtObj.fnCheck=this.fnCheck,rtObj.visitStop=parseInt(confObj.value),checker.timerCbSec=!0,rtObj}},chatted_before:{fnCopyConf:function(confObj,rtObj,checker){return"true"==window.localStorage.getItem("chattedBefore")?(window.localStorage.removeItem("chattedBefore"),rtObj.fnCheck=function(){return!0},rtObj):(checker.noCheck=!0,rtObj)}},scrolls_to_depth:{fnCheck:function(args){return!1},fnCopyConf:function(confObj,rtObj,checker){rtObj.fnCheck=this.fnCheck,rtObj.value=parseInt(confObj.value);var cb={ev:"scroll",el:window,fn:function(){var h=document.getElementsByTagName("HTML")[0].offsetHeight,s=window.pageYOffset,w=window.innerHeight;if(!(w>=h)){var s100=h-w;(100*s+s100-1)/s100>=rtObj.value&&(rtObj.fnCheck=function(){return!0})}}};return checker.eventCb.push(cb),rtObj}}};if(!commonUtilService.isUndefined(conf)&&!commonUtilService.isUndefined(chatCb)&&null!=conf&&null!=chatCb){var conditions=conf.proactiveOfferCondition;if(conditions){var ruleChecker={callBack:chatCb,ruleSets:[],timerCbMin:!1,timerCbSec:!1,eventCb:[],clean:function(){if(this.timerCbMin&&(window.clearInterval(this.timerCbMin),this.timerCbMin=null),this.timerCbSec&&(window.clearInterval(this.timerCbSec),this.timerCbSec=null),this.events){for(var elName in this.events){var el=this.events[elName];if(this.events.hasOwnProperty(elName)&&"object"==typeof el&&el.events)for(var ev in el.events){var evt=el.events[ev];el.events.hasOwnProperty(ev)&&evt.fn&&el.el.removeEventListener(ev,evt.fn)}}this.events=null}},check:function(){if(0!=this.ruleSets.length)for(var s=0;s<this.ruleSets.length;++s){for(var rules=this.ruleSets[s],bSatisfy=!0,i=0;i<rules.length;++i)if(!rules[i].fnCheck()){bSatisfy=!1;break}if(bSatisfy){this.clean(),this.callBack();break}}}},storage=window.localStorage,ls={firstVisit:!0,pagesVisited:0,lastVisit:Date.now()/1e3};if(void 0!==storage)if(void 0!==storage.proactiveVisitCount&&storage.proactiveVisitCount&&""!==storage.proactiveVisitCount?(ls.firstVisit=!1,ls.pagesVisited=parseInt(storage.proactiveVisitCount),storage.proactiveVisitCount=ls.pagesVisited+1):(ls.firstVisit=!0,ls.pagesVisited=0,storage.proactiveVisitCount=1),void 0!==storage.pagesVisitedUrls&&storage.pagesVisitedUrls&&""!==storage.pagesVisitedUrls?-1==storage.pagesVisitedUrls.indexOf(window.location.pathname)&&(storage.pagesVisitedUrls+=","+window.location.pathname):storage.pagesVisitedUrls=window.location.pathname,void 0===storage.proactiveVisitTime||""===storage.proactiveVisitTime)storage.proactiveVisitTime=ls.lastVisit,storage.proactiveVisitCount=1,ls.pagesVisited=0;else{var lv=parseInt(storage.proactiveVisitTime);storage.proactiveVisitTime=ls.lastVisit,ls.lastVisit-lv>3600&&(storage.proactiveVisitCount=1,ls.pagesVisited=0),ls.lastVisit=lv}for(var j=0;j<conditions.length;++j){var condition=conditions[j],rules=condition.rules;if(rules&&"object"==typeof rules){for(var set=[],checker={timerCbMin:null,timerCbSec:null,eventCb:[],visitStat:ls},i=0;i<rules.length;++i){var rule=rules[i];if("object"==typeof rule){var ruleType=rule.ruleType,ruleCheck=proactiveChatRuleMatcher[ruleType];if("object"==typeof ruleCheck&&(set.push(ruleCheck.fnCopyConf(rule,{},checker)),checker.noCheck))break}}if(!checker.noCheck&&set.length>0){checker.eventCb.length>0&&(ruleChecker.eventCb=ruleChecker.eventCb.concat(checker.eventCb));for(var bDone=!0,r=0;r<set.length;++r)if(!set[r].fnCheck()){bDone=!1;break}if(bDone)return void chatCb();checker.timerCbMin&&(ruleChecker.timerCbMin=!0),checker.timerCbSec&&(ruleChecker.timerCbSec=!0),ruleChecker.ruleSets.push(set)}}}for(var cbs={},pseudoId="#$%876adr_0_",i=0;i<ruleChecker.eventCb.length;++i){var ecb=ruleChecker.eventCb[i],eid;ecb.el===window?eid="thisBrowserWindow":ecb.el===document?eid="thisDocument":(eid=ecb.el.getAttribute("id"))||(eid=pseudoId+i,ecb.el.setAttribute("id",eid)),cbs[eid]||(cbs[eid]={el:ecb.el,events:{}});var evts=cbs[eid].events;if(evts[ecb.ev])evts[ecb.ev].cb.push(ecb.fn);else{var obj=evts[ecb.ev]={cb:[ecb.fn]};obj.fn=function(evt){for(var e=0;e<obj.cb.length;++e)obj.cb[e](evt);ruleChecker.check()},ecb.isJqueryEvent?$(ecb.el).on(ecb.ev,obj.fn):ecb.el.addEventListener(ecb.ev,obj.fn,!1)}}for(var eid in cbs)if(cbs.hasOwnProperty(eid)&&0==eid.indexOf(pseudoId)){var els=cbs[eid];els.el.removeAttribute("id")}this.eventCb=[],ruleChecker.events=cbs,ruleChecker.timerCbMin&&(ruleChecker.timerCbSec?ruleChecker.timerCbMin=!1:ruleChecker.timerCbMin=window.setInterval(function(){ruleChecker.check()},6e4)),ruleChecker.timerCbSec&&(ruleChecker.timerCbSec=window.setInterval(function(){ruleChecker.check()},1e3))}}}},proactiveOfferService=function(){var animationIn,animationOut;function createButton(className,innerText,dataTab){return dataTab?'<button class="'+className+'" data-tab="'+dataTab+'">'+innerText+"</button>":'<button class="'+className+'">'+innerText+"</button>"}function getProactiveOfferHtml(){var width="",height="",content="",position="center",buttons=function(){var paLeaveMessage,paCloseButton,poConfig=widgetConfiguration.getProactiveOffer(),paCallButton="",paChatButton="",paCloseButtonText="";if(poConfig&&poConfig.properties){var properties=poConfig.properties;properties.callButtonEnabled&&(paCallButton=createButton("button-primary proactive-offer__button main-background-color second-color proactive-offer__button_type_call",properties.callButtonText,"call")),properties.chatButtonEnabled&&(paChatButton=createButton("button-primary proactive-offer__button main-background-color second-color proactive-offer__button_type_chat",properties.chatButtonText,"chat")),properties.cancelButtonText&&(paCloseButtonText=properties.cancelButtonText)}return paCloseButton=createButton("button-primary proactive-offer__button main-background-color second-color proactive-offer__close",paCloseButtonText),paLeaveMessage=createButton("button-primary proactive-offer__button main-background-color second-color proactive-offer__button_type_email","Leave message"),commonUtilService.isServiceAvailable()?paCloseButton+paChatButton+paCallButton:paCloseButton+paLeaveMessage}(),properties=null,styling=null,closeIcon="",poConfig=widgetConfiguration.getProactiveOffer();return animationIn="",animationOut="",poConfig&&(styling=poConfig.styling,properties=poConfig.properties,styling&&(position=styling.location,animationIn=styling.animationIn,animationOut=styling.animationOut,width=styling.width,height=styling.height),properties&&(content=properties.htmlContent,closeIcon=properties.closeButtonEnabled?'<div class="proactive-offer__close-wrapper"><svg class="proactive-offer__close close-icon" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path clip-rule="evenodd" d="M14.318 15l-6.818-6.818-6.818 6.818-.682-.682 6.819-6.818-6.819-6.818.682-.682 6.818 6.818 6.818-6.818.682.682-6.818 6.818 6.818 6.818-.682.682z" /></svg></div>':"")),animationIn=commonUtilService.includes(animationIn,"slide")?position+"_"+animationIn:animationIn,animationOut=commonUtilService.includes(animationOut,"slide")?position+"_"+animationOut:animationOut,'<div class="proactive-offer base-font position_'+position+'" data-animationIn="'+animationIn+'" ><div class="widget-border widget-border-radius"><div style="width:'+width+"px;height:"+height+'px;" class="proactive-offer__body widget-background"><div class="proactive-offer__content-wrapper">'+closeIcon+'<div class="proactive-offer__content">'+content+'</div><div class="proactive-offer__button-wrapper">'+buttons+"</div></div></div></div></div>"}function updateProactiveOfferStyles(){var poConfig=widgetConfiguration.getProactiveOffer(),proactiveOffer=document.querySelector(".proactive-offer"),poContent=document.querySelector(".proactive-offer__content"),poBtnWrapper=document.querySelector(".proactive-offer__button-wrapper"),contentHeight=poContent?poContent.offsetHeight:0,contentWidth=poContent?poContent.offsetWidth:0,buttonsHeight=poBtnWrapper?poBtnWrapper.offsetHeight:0,buttonsWidth=30,screenWidth=proactiveOffer?proactiveOffer.offsetWidth:0,screenHeight=proactiveOffer?proactiveOffer.offsetHeight:0,buttons=document.querySelectorAll(".proactive-offer__button-wrapper > *");[].forEach.call(buttons,function(button){buttonsWidth+=button.offsetWidth-30});var POheight=contentHeight+buttonsHeight,POwidth=Math.max.apply(Math,[contentWidth,buttonsWidth]);if(POwidth>screenWidth)var coefX=screenWidth/POwidth;if(POheight>screenHeight)var coefY=screenHeight/POheight;if(coefX||coefY){var scale=100/Math.max.apply(Math,[coefX,coefY]);document.querySelector(".proactive-offer__content-wrapper>div").setAttribute("style","transform:scale(' + coef + ');"),document.querySelector(".proactive-offer__content").style.width=scale+"%"}if(null!==document.querySelector(".proactive-offer__button_type_chat")){var paBody=document.querySelector(".proactive-offer__body"),isMobile=widgetConfiguration.isMobile(),availableHeight=isMobile&&window.screen?window.screen.availHeight:window.innerHeight,availableWidth=isMobile&&window.screen?window.screen.availWidth:window.innerWidth,calculatedHeight=Math.min(poConfig.styling.height,availableHeight),calculatedWidth=Math.min(poConfig.styling.width,availableWidth);paBody&&paBody.style&&(paBody.style.width=calculatedWidth+"px",paBody.style.height=calculatedHeight+"px")}}function build(){if(!(document.getElementsByClassName("proactive-offer").length>0)){if(!document.querySelector("#sp-chat-iframe")){var paCode=getProactiveOfferHtml();document.querySelector("body").insertAdjacentHTML("beforeend",paCode);var offers=document.querySelectorAll(".proactive-offer.base-font");[].forEach.call(offers,function(offer){offer.setAttribute("style","display:block")})}setTimeout(function(){updateProactiveOfferStyles()})}}function isAllowedToShow(){var allowed=!0,isMobile=widgetConfiguration.isMobile(),conditions=widgetConfiguration.getProactiveOfferConditions();return isMobile?conditions.forEach(function(condition){condition&&Array.isArray(condition.rules)&&condition.rules.length&&condition.rules.forEach(function(rule){rule&&"nonmobile_browser"===rule.ruleType&&(allowed=!1)})}):allowed=!0,allowed}function windowResizeListener(){isAllowedToShow()?updateProactiveOfferStyles():(removeProactiveOffer(),window.removeEventListener("resize",windowResizeListener,!1))}function removeProactiveOffer(){var offer=document.querySelector(".proactive-offer");offer&&offer.parentNode.removeChild(offer)}return{buildProactiveOffer:function(openChat){var chatPath,poConfig,eventsCallback=SERVICE_PATTERN_CHAT_CONFIG.callbacks;isAllowedToShow()&&(poConfig=widgetConfiguration.getProactiveOffer())&&poConfig.properties&&poConfig.properties.enabled&&(window.addEventListener("resize",windowResizeListener,!1),chatPath=widgetConfiguration.getChatPath(),document.querySelector("head").insertAdjacentHTML("beforeend","<link href='"+chatPath+"css/proactive-offer.css' type='text/css' rel='stylesheet' />"),commonUtilService.isServiceNotAvailable()||(proactiveChatStarter(build),function(openChat,eventsCallback){function loopButtons(e,buttons,isClose){var helper=snippetHelperFunctions();[].forEach.call(buttons,function(button){e.target===button&&(isClose?(document.querySelector(".proactive-offer").setAttribute("data-animationOut",animationOut),helper.addClass(document.querySelector(".proactive-offer"),"removing"),setTimeout(function(){removeProactiveOffer()},500),eventsCallback&&eventsCallback.proactiveNo&&eventsCallback.proactiveNo()):(document.querySelector(".proactive-offer").setAttribute("data-animationOut",animationOut),helper.addClass(document.querySelector(".proactive-offer"),"removing"),setTimeout(function(){removeProactiveOffer()},500),eventsCallback&&eventsCallback.proactiveYes&&eventsCallback.proactiveYes(),sessionStorage.setItem("tab",button.getAttribute("data-tab")),openChat(),snippetOpenChat(!0),sessionStorage.setItem("source","proactive")))})}document.addEventListener("click",function(e){var poButtons=document.querySelectorAll(".proactive-offer__button:not(.proactive-offer__close)"),poCloses=document.querySelectorAll(".proactive-offer__close");loopButtons(e,poButtons,!1),loopButtons(e,poCloses,!0)})}(openChat,eventsCallback),eventsCallback&&eventsCallback.proactiveChatOffered&&eventsCallback.proactiveChatOffered()))},removeProactiveOffer:removeProactiveOffer,resetProactiveOffer:function(){proactiveChatStarter(build)}}}(),scaleProactiveOffer=function(){var offer=$(".proactive-offer");if(offer){var content=offer.find(".proactive-offer__content");if(content){var contentHeight=content.outerHeight(),contentWidth=content.outerWidth(),buttonsHeight=$(".proactive-offer__button-wrapper").outerHeight(),buttonsWidth=0,screenWidth=offer.width(),screenHeight=offer.height();$(".proactive-offer__button-wrapper > *").each(function(){buttonsWidth+=$(this).width()+10});var POheight=contentHeight+buttonsHeight,POwidth=Math.max.apply(Math,[contentWidth,buttonsWidth]);if(POwidth>screenWidth)var coefX=screenWidth/POwidth;if(POheight>screenHeight)var coefY=screenHeight/POheight;if(coefX||coefY){var coef=Math.max.apply(Math,[coefX,coefY]),scale=100/coef;$(".proactive-offer__content-wrapper>div").attr("style","transform:scale("+coef+");"),content.css("width",scale+"%"),setTimeout(function(){0},3e3)}}}},widgetConfiguration=function(){function getParams(){return sessionStorage.getItem("confParams")}function getFullConfiguration(){return sessionStorage.getItem("fullConf")}function getObject(){return JSON.parse(getParams())}function getTarget(){return getChatConfiguration(getObject())}function getDefinition(){var object=getObject();return object?object.definition:null}function getCobrowsing(){var object=getObject();return object?object.cobrowsing:null}function getItem(itemName,indexName){var definition=getDefinition(),index=getItemIndex(indexName);return definition&&definition[itemName]&&commonUtilService.isDefined(index)?definition[itemName][index]:null}function getItemIndex(propName){var target=getTarget();return target&&target[propName]?target[propName].widgetIndex:null}function getSnippet(){return getItem("chatInitiations","chatInitiation")}function getProactiveOffer(){return getItem("proactiveOffers","proactiveOffer")}function getChatConfiguration(data){var obj=data&&data.widget?data.widget:data,output={};function findUrls(section,item,weight){var result={};if(section)for(let i=0;i<section.data.length;i++)for(let key in section.data[i].urls)if(section.data[i].urls.hasOwnProperty(key)){var comparedUrl=section.data[i].urls[key],compareResult=chatCompareUrl(comparedUrl);compareResult.check&&compareResult.weight>weight&&(weight=compareResult.weight,result.widgetIndex=i,result.url=comparedUrl)}return result}function getDefaultData(data){return data?{data:data,widgetIndex:-1,target:{}}:{}}function getWidgetOutput(targetSection,widgetType){var widgetOutput={data:{},styles:data.styles},sourceId=data.id;for(var key in targetSection)targetSection.hasOwnProperty(key)&&sourceId===targetSection[key].id&&(widgetOutput.index=key,widgetOutput.data=targetSection[key],widgetType&&(widgetOutput.data.widgetType=widgetType));return widgetOutput}if(data)if(widgetConfiguration.isPreviewMode())switch(output={data:{},styles:data.styles},data.section){case"chat_initiation":output=getWidgetOutput(obj.chatInitiations);break;case"proactive_offer":output=getWidgetOutput(obj.proactiveOffers,"proactive_offer");break;case"form":output=getWidgetOutput(obj.forms,"form");break;case"on_page_form":output=getWidgetOutput(obj.onPageForms,"onPageForm");break;case"chat_styling":output.data=obj.chatWidgetStyling,output.data.widgetType="chat_styling";var chatInit=obj.chatInitiations[0];chatInit&&(output.data.contactTab=chatInit.contactTab)}else{var chatInitiations=data.definition?getDefaultData(data.definition.chatInitiations):{},proactiveOffers=data.definition?getDefaultData(data.definition.proactiveOffers):{},forms=data.definition?getDefaultData(data.definition.forms):{};output.chatInitiation=findUrls(chatInitiations,0,0),output.proactiveOffer=findUrls(proactiveOffers,0,0),output.form=findUrls(forms,0,0)}return output}function getDefinitionStyling(){var definition=getDefinition();if(definition&&definition.chatWidgetStyling)return definition.chatWidgetStyling}return{getSnippetIndex:function(){return getItemIndex("chatInitiation")},getProactiveOfferIndex:function(){return getItemIndex("proactiveOffer")},getFormIndex:function(){return getItemIndex("form")},isMobile:function(){var agent=navigator.userAgent||navigator.vendor||window.opera,check1=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|iP(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(agent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(agent.substr(0,4)),check2=/iP(ad|hone|od).+Version\/[\d\.]+.*Safari/i.test(navigator.userAgent);return check2||check1},getDefinition:getDefinition,getDefinitionStyling:getDefinitionStyling,getStyles:function(){var object=getObject();return object?object.styles:null},getCobrowsing:getCobrowsing,getSurflyWidgetKey:function(){var cobrowsing=getCobrowsing();return cobrowsing&&"SURFLY"===cobrowsing.provider?cobrowsing.widget_key:null},getSnippet:getSnippet,getProactiveOffer:getProactiveOffer,getProactiveOfferConditions:function(){var conditions=[],po=getProactiveOffer();return po&&po.conditions&&(conditions=po.conditions),conditions},getForm:function(){return getItem("forms","form")},getOrientation:function(){var snippet=getSnippet(),util=commonUtilService;if(snippet&&snippet.contactTab&&snippet.contactTab.location)return util.includes(snippet.contactTab.location,"right_")||util.includes(snippet.contactTab.location,"left_")?"vertical":"horizontal"},getPreChat:function(){var snippet=getSnippet();return snippet&&snippet.preChat?snippet.preChat:null},getChatPath:function(){if(SERVICE_PATTERN_CHAT_CONFIG&&SERVICE_PATTERN_CHAT_CONFIG.chatPath){var path=SERVICE_PATTERN_CHAT_CONFIG.chatPath;return"/"===path.substr(path.length-1)?path:path+"/"}return""},isPreviewMode:function(){var urlVars=clientChatPageGetUrlVars(window.location.href);return!(!urlVars||!commonUtilService.isDefined(urlVars.brightpattern))&&"previewmode"===urlVars.brightpattern},getParams:getParams,getObject:getObject,getTarget:getTarget,getFullConfiguration:getFullConfiguration,getFullConfigurationObject:function(){return JSON.parse(getFullConfiguration())},getChatConfiguration:getChatConfiguration,getServicePatternChatConfig:function(){var deferred=jQuery.Deferred();return window.addEventListener("message",function(event){event&&event.data&&"setServicePatternChatConfig"===event.data.eventName&&(deferred.resolve(event.data.params.servicePatternChatConfig),window.removeEventListener("message",null,!1))}),window.parent.postMessage("getServicePatternChatConfig","*"),deferred.promise()},isCobrowsingTogetherJS:function(){var enabled=!1,cobrowsing=getCobrowsing(),spConfig=SERVICE_PATTERN_CHAT_CONFIG,forceTogetherJSEnabled=spConfig?spConfig.togetherJS_enabled:void 0;return enabled=cobrowsing&&"TOGETHERJS"===cobrowsing.provider,commonUtilService.isDefined(forceTogetherJSEnabled)&&(enabled=commonUtilService.stringIsTrue(forceTogetherJSEnabled)||!0===forceTogetherJSEnabled),enabled},isCobrowsingEditEnabled:function(){var enabled=!0,chatWidgetStyling=getDefinitionStyling();return chatWidgetStyling&&commonUtilService.isDefined(chatWidgetStyling.remoteEditing)&&(enabled=!!chatWidgetStyling.remoteEditing),enabled},isFileAttachEnabled:function(){var enabled=!0,chatWidgetStyling=getDefinitionStyling();return chatWidgetStyling&&commonUtilService.isDefined(chatWidgetStyling.fileUploadEnabled)&&(enabled=!!chatWidgetStyling.fileUploadEnabled),enabled},isEmojiPickerEnabled:function(){var enabled=!0,chatWidgetStyling=getDefinitionStyling();return chatWidgetStyling&&commonUtilService.isDefined(chatWidgetStyling.emojiSelector)&&(enabled=!!chatWidgetStyling.emojiSelector),enabled},isVisitorVideoEnabled:function(){var chatWidgetStyling=getDefinitionStyling();return!!chatWidgetStyling&&!1!==chatWidgetStyling.visitorVideoEnabled}}}(),chatCompareUrl=function(comparedUrl){var parentHost=sessionStorage.getItem("parentHost"),sourceRelativeUrl=parentHost?sessionStorage.getItem("parentPath"):window.location.pathname.split("#")[0],sourceAbsoluteUrl=parentHost?sessionStorage.getItem("parentHost")+sessionStorage.getItem("parentPath"):window.location.host+window.location.pathname.split("#")[0],sourceRelativeUrlSegments=sourceRelativeUrl.split("#")[0].split("/"),sourceAbsoluteUrlSegments=sourceAbsoluteUrl.split("#")[0].split("/"),comparedUrlSegments=comparedUrl.split("#")[0].split("/"),check=!1,urlItemType_path="/"===comparedUrl.substring(0,1)?"relative":"absolute",urlItemType_object="/"===comparedUrl.substring(comparedUrl.length-1,comparedUrl.length)?"folder":"file",weight=0;function updateWeight(sourceUrlSegments){for(let i=0;i<comparedUrlSegments.length-1;i++){var current=i+1;comparedUrlSegments[i]===sourceUrlSegments[i]&&weight++,check=current===weight}}return"file"===urlItemType_object&&(comparedUrl===sourceAbsoluteUrl&&"absolute"===urlItemType_path&&(weight=999),comparedUrl===sourceRelativeUrl&&"relative"===urlItemType_path&&(weight=998),check=!0),"folder"===urlItemType_object&&("relative"===urlItemType_path&&updateWeight(sourceRelativeUrlSegments),"absolute"===urlItemType_path&&updateWeight(sourceAbsoluteUrlSegments)),{check:check,weight:weight}},constructorConfigurationPreview=function(data,styles){var helper=snippetHelperFunctions(),conf=widgetConfiguration.getObject(),fullConf=widgetConfiguration.getFullConfigurationObject(),frameHeight=Math.min.apply(Math,[fullConf.widget.chatWidgetStyling.height,window.innerHeight-20]),widget=document.querySelector("#sp-chat-widget"),frame=document.querySelector("#sp-chat-frame"),body=document.querySelector("body"),labelText=document.querySelector("#sp-chat-label-text"),labelIcon=document.querySelector("#sp-chat-label-icon"),avatarImageWrapper=document.querySelector(".avatar-image-wrapper"),avatar=document.querySelector(".avatar-image"),messagesDiv=document.querySelector("#messages-div"),previewAgentImage=document.querySelector(".previewAgentImage"),preChatForm=document.querySelector(".pre_chat_form #preChatForm"),preChatFrame=document.querySelector(".pre_chat_form #sp-chat-frame"),agentName=document.querySelector(".pre_chat_form #agent-name"),screenTitle=document.querySelector("#screen-title");document.querySelector(".questionFormInner"),document.querySelector(".offlineFields"),document.querySelector(".custom-form-fields"),document.querySelector("#messages-div-outer");if(frame&&(frame.offsetHeight=frameHeight,frame.offsetWidth=fullConf.widget.chatWidgetStyling.width),helper.addClass(body,"preview_body"),conf.contactTab){var icon=conf.contactTab.iconUrl||"";0==icon.length?labelIcon&&helper.addClass(labelIcon,"collapse"):labelIcon&&helper.removeClass(labelIcon,"collapse"),labelIcon.style.cssText=icon.length>0?'width: 28px;margin: 6px 10px;background:url("'+icon+'") center center no-repeat/contain':"",labelText&&(labelText.innerHTML=conf.contactTab.agentsAvailableMsg||""),0==conf.contactTab.enabled?widget&&helper.hide(widget):widget&&helper.show(widget)}if(fullConf&&fullConf.widget.chatInitiations[0]){var src=fullConf.widget.chatInitiations[0].contactTab.iconUrl?fullConf.widget.chatInitiations[0].contactTab.iconUrl:"";0==src.length?(avatarImageWrapper&&helper.addClass(avatarImageWrapper,"collapse"),messagesDiv&&helper.addClass(messagesDiv,"noAgentImage")):(avatarImageWrapper&&helper.removeClass(avatarImageWrapper,"collapse"),messagesDiv&&helper.removeClass(messagesDiv,"noAgentImage")),avatar&&(avatar.style.cssText="background-image:url('"+src+"')"),previewAgentImage&&(previewAgentImage.style.cssText="background:url("+src+") center center no-repeat;background-size:contain!important;border-radius:0"),sessionStorage.setItem("logoUrl",src)}if(conf.preChat){var pcConfig=conf.preChat;0==pcConfig.enabled?(preChatForm&&helper.hide(preChatForm),preChatFrame&&helper.hide(preChatFrame),frame&&(frame.style.display="")):(preChatForm&&(preChatForm.style.display=""),preChatFrame&&(preChatFrame.style.display="")),agentName&&(agentName.innerHTML=pcConfig.title)}if(conf.leaveMessage){var lmConfig=conf.leaveMessage;screenTitle&&(screenTitle.innerHTML=lmConfig.title)}},constructorHelpers=function(){var helper=snippetHelperFunctions(),helpers={listener:function(event){var preview=document.querySelector("#preview");if(commonUtilService.isJsonString(event.data)){sessionStorage.setItem("fullConf",event.data);var config=JSON.parse(event.data),target=widgetConfiguration.getChatConfiguration(config);config.screen&&(preview&&(preview.setAttribute("class",""),helper.addClass(preview,config.screen)),sessionStorage.setItem("confParams",JSON.stringify(target.data)),sessionStorage.setItem("styles",JSON.stringify(config.styles)),helpers.applyConfiguration(target.data,target.styles))}},applyConfiguration:function(data,styles){snippetConfigurationSnippet(data,styles),constructorConfigurationPreview(data,styles),widgetConfiguration.isPreviewMode()&&loadScripts(["js/libraries/jquery/jquery-3.2.1.min.js","js/libraries/perfect-scrollbar/perfect-scrollbar.min.js"],function(){clientChatPageConfigurationChat(),buildProactiveOfferPreview(),scaleProactiveOffer()})},showChat:function(){var content=document.querySelector(".chat-preview-content");content&&helper.show(content)}};return helpers},constructorPreviewCode=function(){var variables=snippetVariables(),chatPath=widgetConfiguration.getChatPath(),fullConf=JSON.parse(sessionStorage.getItem("fullConf")),isRoundButton=!1,i18n=clientChatUiI18n();return fullConf&&fullConf.widget&&fullConf.widget.chatWidgetStyling&&(isRoundButton="round"===fullConf.widget.chatWidgetStyling.tabStyle),'<div id="preview"><div class="chat-preview-content"><div id="sp-chat-widget"><div class="sp-round-button main-background-color second-fill-color" style="'+(isRoundButton?"":"display:none")+'"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 74 74"><path transform="scale(1.3) translate(15 15)" d="M14,2C7.458,2,2,6.769,2,12.8S7.458,23.6,14,23.6c.415,0,.8-.083,1.2-.122v3.834l1.849-1.186c2.595-1.665,8.213-5.988,8.883-12.192A9.906,9.906,0,0,0,26,12.8C26,6.769,20.542,2,14,2Zm0,2.4c5.389,0,9.6,3.828,9.6,8.4a7.5,7.5,0,0,1-.052.867v0l0,0c-.415,3.841-3.489,6.857-5.946,8.824V20.687l-1.437.291A10.918,10.918,0,0,1,14,21.2c-5.389,0-9.6-3.828-9.6-8.4S8.611,4.4,14,4.4Z"/></svg></div><div class="sp-chat-widget__content main-background-color contact-tab-border" style="'+(isRoundButton?"display:none":"")+'"><div id="sp-chat-label-icon"></div><div id="sp-chat-label-text" class="base-font contact-tab-font second-color">text</div></div></div><div class="proactive-offer base-font position_center"><div class="widget-border widget-border-radius"><div class="proactive-offer__body widget-background"><div class="proactive-offer__close-wrapper"><svg class="proactive-offer__close close-icon" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path clip-rule="evenodd" d="M14.318 15l-6.818-6.818-6.818 6.818-.682-.682 6.819-6.818-6.819-6.818.682-.682 6.818 6.818 6.818-6.818.682.682-6.818 6.818 6.818 6.818-.682.682z" /></svg></div><div class="proactive-offer__content-wrapper"><div class="proactive-offer__content"></div><div class="proactive-offer__button-wrapper"><button class="button-primary proactive-offer__button proactive-offer__close main-background-color second-color"></button><button class="button-primary proactive-offer__button proactive-offer__button_type_chat main-background-color second-color"></button><button class="button-primary proactive-offer__button proactive-offer__button_type_call main-background-color second-color"></button></div></div></div></div></div><div id="sp-chat-frame" class="base-font"><div id="sp-drag-handle"></div><div id="sp-side-bar"><div id="sp-close-frame" class="close-icon"><svg xmlns="http://www.w3.org/2000/svg" class="main-path-color" width="15" height="15"><path clip-rule="evenodd" d="M14.318 15l-6.818-6.818-6.818 6.818-.682-.682 6.819-6.818-6.819-6.818.682-.682 6.818 6.818 6.818-6.818.682.682-6.818 6.818 6.818 6.818-.682.682z" /></svg></div></div><div id="sp-iframe-container"><div id="sp-chat-iframe2" class="widget-border-radius dialog-shadow"><div id="inner-chat" class="widget-border widget-border-radius base-font"><div id="servicepatternsite-iframe-chat"><div id="header-avatar" class="main-background-color"><div id="header-avatar-container"><div class="has-avatar"><div class="avatar"><div class="avatar-image-wrapper"><div class="avatar-image" style="background-image:url('+variables.SP.chatPath+'/images/logo-big.png)"></div></div></div><div class="info second-color title-font"><div id="agent-name" class="agent-name"></div></div></div></div><div class="clear"></div><div class="sound_player"></div><div class="conversationOptions"><div id="callMe" class="main-path-color"><svg class="startCall" xmlns="http://www.w3.org/2000/svg" width="20" height="19.001"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.246 14.774l-.258.119.012.108c0 1.656-1.343 3-3 3h-2.101c-.208.58-.748 1-1.399 1s-1.191-.42-1.399-1h-.101v-1h.101c.208-.58.748-1 1.399-1s1.191.42 1.399 1h1.101c1.36 0 2.496-.912 2.863-2.153-.507-.24-.863-.748-.863-1.347v-5c0-.829.672-1.5 1.5-1.5.277 0 .523.096.746.228 1.594.526 2.754 2.002 2.754 3.772s-1.16 3.247-2.754 3.773zm-.246-6.273c0-.276-.224-.5-.5-.5s-.5.225-.5.5v5c0 .276.224.5.5.5s.5-.224.5-.5v-5zm1 .315v4.371c.602-.545 1-1.309 1-2.186 0-.876-.398-1.64-1-2.185zm-8-7.816c-3.313 0-6 2.688-6 6.001h-1c0-3.866 3.134-7.001 7-7.001s7 3.135 7 7.001h-1c0-3.313-2.687-6.001-6-6.001zm-5 7.501v5c0 .828-.672 1.5-1.5 1.5-.277 0-.523-.096-.746-.228-1.594-.525-2.754-2.002-2.754-3.772s1.16-3.247 2.754-3.772c.223-.132.469-.228.746-.228.828 0 1.5.672 1.5 1.5zm-3 .315c-.602.545-1 1.309-1 2.185 0 .877.398 1.641 1 2.186v-4.371zm2-.315c0-.276-.224-.5-.5-.5s-.5.225-.5.5v5c0 .276.224.5.5.5s.5-.224.5-.5v-5z"/></svg></div><div id="minimizeChat" class="main-stroke-color" style="display: none;"><svg class="minimizeChat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><line x1="0" y1="30" x2="32" y2="30" stroke-width="2"></line></svg></div></div></div><form id="content-form" method="POST"></form><div id="offline-form"><div id="offline-form-inner"><div id="preChatForm" class="question__chat-tab_active agent-message"><div class="tabs"><div class="tab tab_active tabChat main-color widget-background"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="17"><path clip-rule="evenodd" d="M15.001 12.001h-3.601l-6.4 5v-5h-1c-.552 0-1-.447-1-1v-7c0-.552.448-1 1-1h11c.552 0 1 .448 1 1v7c.001.553-.447 1-.999 1zm-1-7h-9.001v5h2v3.391l3.827-3.391h3.174v-5zm-12.001 3.999h-1c-.552 0-1-.448-1-1v-7c0-.553.448-1 1-1h9c.552 0 1 .447 1 1v1h-9v7z" fill="none"/></svg><span>Chat</span></div><div class="tab tabChat"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="17"><path clip-rule="evenodd" d="M15.001 12.001h-3.601l-6.4 5v-5h-1c-.552 0-1-.447-1-1v-7c0-.552.448-1 1-1h11c.552 0 1 .448 1 1v7c.001.553-.447 1-.999 1zm-1-7h-9.001v5h2v3.391l3.827-3.391h3.174v-5zm-12.001 3.999h-1c-.552 0-1-.448-1-1v-7c0-.553.448-1 1-1h9c.552 0 1 .447 1 1v1h-9v7z" fill="none"/></svg><span>Chat</span></div><div class="tab tab_active tabPhone main-color widget-background"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17"><path clip-rule="evenodd" d="M12.492 17c-.444 0-.883-.075-1.302-.224-5.191-1.836-9.303-6.056-11.001-11.289-.509-1.573.032-3.302 1.346-4.305l.838-.639c.465-.355 1.022-.543 1.609-.543 1 0 1.905.553 2.363 1.444l1.417 2.751c.134.262.206.555.206.848 0 .466-.174.912-.49 1.256l-.295.321c-.293.318-.357.791-.159 1.175.484.937 1.235 1.688 2.174 2.171.377.196.864.129 1.175-.157l.321-.295c.56-.514 1.432-.632 2.105-.285l2.754 1.415c.893.458 1.447 1.362 1.447 2.362 0 .701-.271 1.363-.768 1.865l-.958.969c-.728.738-1.742 1.16-2.782 1.16zm-8.51-15.407c-.235 0-.457.075-.642.216l-.838.639c-.777.594-1.097 1.618-.796 2.549 1.545 4.765 5.289 8.607 10.017 10.279.828.293 1.803.068 2.418-.555l.958-.97c.198-.201.308-.466.308-.745 0-.399-.223-.762-.58-.945l-2.754-1.415c-.111-.057-.246-.007-.299.041l-.321.295c-.793.728-2.025.895-2.983.4-1.235-.636-2.226-1.624-2.861-2.858-.503-.976-.342-2.173.4-2.981l.294-.32c.032-.035.07-.094.07-.179l-.029-.12-1.416-2.752c-.183-.358-.546-.579-.946-.579z" /></svg><span>Phone</span></div><div class="tab tabPhone"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17"><path clip-rule="evenodd" d="M12.492 17c-.444 0-.883-.075-1.302-.224-5.191-1.836-9.303-6.056-11.001-11.289-.509-1.573.032-3.302 1.346-4.305l.838-.639c.465-.355 1.022-.543 1.609-.543 1 0 1.905.553 2.363 1.444l1.417 2.751c.134.262.206.555.206.848 0 .466-.174.912-.49 1.256l-.295.321c-.293.318-.357.791-.159 1.175.484.937 1.235 1.688 2.174 2.171.377.196.864.129 1.175-.157l.321-.295c.56-.514 1.432-.632 2.105-.285l2.754 1.415c.893.458 1.447 1.362 1.447 2.362 0 .701-.271 1.363-.768 1.865l-.958.969c-.728.738-1.742 1.16-2.782 1.16zm-8.51-15.407c-.235 0-.457.075-.642.216l-.838.639c-.777.594-1.097 1.618-.796 2.549 1.545 4.765 5.289 8.607 10.017 10.279.828.293 1.803.068 2.418-.555l.958-.97c.198-.201.308-.466.308-.745 0-.399-.223-.762-.58-.945l-2.754-1.415c-.111-.057-.246-.007-.299.041l-.321.295c-.793.728-2.025.895-2.983.4-1.235-.636-2.226-1.624-2.861-2.858-.503-.976-.342-2.173.4-2.981l.294-.32c.032-.035.07-.094.07-.179l-.029-.12-1.416-2.752c-.183-.358-.546-.579-.946-.579z" /></svg><span>Phone</span></div></div><div class="questionFormInner ps-container widget-background"><div class="fieldsWrapper"><div class="commonFields"></div><div class="chatFields"></div><div class="phoneFields"></div></div></div><div class="prechat__action-buttons base-font"><input id="cancelPreChatForm" type="button" value="Cancel" class="button-primary cancel main-background-color second-color preview"><input id="submitChat" type="button" value="Call tab" class="button-primary accept main-background-color second-color"><input id="submitPhone" type="button" value="Phone tab" class="button-primary phone main-background-color second-color"></div></div><div id="unavailableForm"><div id="offline-form-fields" class="ps-container"><div class="offlineFields"></div><div class="buttons"><div id="uncancelWrapper" class="left-button preview"><button id="uncancel" class="servicepatternBtn cancel main-background-color second-color">Cancel</button></div><div><input id="unsubmit" type="button" value="Send" class="servicepatternBtn main-background-color second-color"></div></div><div class="clear"></div><div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 3px;"><div class="ps-scrollbar-x" style="left: 0px; width: 0px;"></div></div><div class="ps-scrollbar-y-rail" style="top: 0px; right: 3px;"><div class="ps-scrollbar-y" style="top: 0px; height: 0px;"></div></div></div></div><div id="surveyForm" style="display: none;"><div class="field-wrapper serviceSurvey"><div class="description">Did we provide the service you were looking for?</div><input type="radio" name="service" id="service-1" value="1" checked="checked"><label for="service-1">yes</label><input type="radio" name="service" id="service-0" value="0"><label for="service-0">no</label></div><div class="field-wrapper helpfulSurvey radioStars"><div class="description">How helpful was our representative?</div><div class="stars"><input type="radio" name="helpful" id="helpful-1" value="2"><label for="helpful-1"></label><input type="radio" name="helpful" id="helpful-2" value="4"><label for="helpful-2"></label><input type="radio" name="helpful" id="helpful-3" value="6"><label for="helpful-3"></label><input type="radio" name="helpful" id="helpful-4" value="8"><label for="helpful-4"></label><input type="radio" name="helpful" id="helpful-5" value="10"><label for="helpful-5"></label></div></div><div class="field-wrapper recommendSurvey radioStars"><div class="description">How likely are you to recommend our products and services in the future?</div><div class="stars"><input type="radio" name="recommend" id="recommend-1" value="2"><label for="recommend-1"></label><input type="radio" name="recommend" id="recommend-2" value="4"><label for="recommend-2"></label><input type="radio" name="recommend" id="recommend-3" value="6"><label for="recommend-3"></label><input type="radio" name="recommend" id="recommend-4" value="8"><label for="recommend-4"></label><input type="radio" name="recommend" id="recommend-5" value="10"><label for="recommend-5"></label></div></div><div class="field-wrapper transcriptSurvey"><input type="checkbox" name="transcript" id="transcript" value="1"><label for="transcript" class="description small">Send me transcript of the chat by email?</label></div><div class="field-wrapper emailSurvey"><div class="description">Your email*</div><input type="text" name="transcriptEmail" id="transcriptEmail"/></div><div class="buttons" style="margin-top: -10px;"><div><input id="submitSurvey" type="button" value="Submit" class="servicepatternBtn main-background-color second-color"></div></div></div><div id="customForm"><div class="custom-form-fields ps-container widget-background"><div class="customFormFields"></div></div><div class="buttons"><div class="left-button"><button id="custom_cancel" class="servicepatternBtn cancel main-background-color second-color">Cancel</button></div><div><input id="custom_submit" type="button" value="Send" class="servicepatternBtn main-background-color second-color"></div></div></div></div></div><div id="chat-body" class="widget-background"><div class="chat-body__content"><video id="video" style="display: none; height: 100px; width: 100%" autoplay=""></video><div id="notification-prompt" style="display: none;" class="promptMessage">Whenprompted, pleaseallow notifications from this window, so you could see responses when this window ishidden.</div><div id="call-controls" class="widget-background" style="display: none;"><div id="call-controls_before-call" style="display: none;"><p class="second-color">Accept <span>video</span> call from <span class="agent-name">[Agent name]</span></p><button id="call-controls_accept" class="servicepatternBtn second-color">Accept</button><button id="call-controls_reject" class="servicepatternBtn second-color">Reject</button></div><div id="call-controls_in-call" style="display: none;"><button id="call-controls_mute-audio" class="servicepatternBtn second-color"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"><path fill="#fff" d="M11.615 26.764a.373.373 0 110-.745h3.522v-3.963a6.18 6.18 0 01-5.927-6.048v-3.717a.381.381 0 01.388-.37.381.381 0 01.392.37v3.714a5.44 5.44 0 005.54 5.322 5.683 5.683 0 002.606-.628l.385.635a6.476 6.476 0 01-2.6.719v3.963h3.524a.373.373 0 110 .745zM9.19 4.003l.776-.512 13.77 22.636-.776.606zm2.505 12.2v-6.124l5.66 9.342a3.913 3.913 0 01-1.829.465 3.758 3.758 0 01-3.831-3.68zm8.627 2.455a5.135 5.135 0 00.744-2.653v-3.714a.388.388 0 01.776 0v3.713a5.851 5.851 0 01-1.079 3.378zM12.458 5.733a3.862 3.862 0 013.068-1.496 3.756 3.756 0 013.83 3.679v8.291a3.593 3.593 0 01-.078.74z"/></svg></button><button id="call-controls_mute-video" class="servicepatternBtn second-color"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"><path d="M7.169 22.681a1.364 1.364 0 01-1.358-1.37v-9.594a1.36 1.36 0 011.263-1.361L19.2 22.587a1.33 1.33 0 01-.482.093zm1.817-12.334h9.731a1.364 1.364 0 011.358 1.37v9.594a1.348 1.348 0 01-.02.2zM25.04 21.12l-3.605-3.236v-1.371h4.755v4.112a.683.683 0 01-.68.685.674.674 0 01-.47-.19zm-3.605-4.607v-1.366l3.626-3.255a.673.673 0 01.449-.171.683.683 0 01.68.685v4.111z" fill="#fff"/><path d="M6.829 7.264l17.322 17.473" stroke-miterlimit="10" fill="none" stroke="#fff"/></svg></button><button id="call-controls_end-call" class="servicepatternBtn second-color"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><path fill="#db2828" d="M31.161 16.019A15.144 15.144 0 1116.02.875 15.144 15.144 0 0131.16 16.019"/><path fill="#fff" d="M17.548 13.267h-2.05c-.984 0-8.44.823-8.44 3.818 0 0 .16 2.29 1.1 2.29a14.105 14.105 0 003.316-.762c.683-.22.944-.503 1.125-1.548a1.65 1.65 0 011.733-1.448c.55-.026 1.438-.026 1.97-.024h.44c.53 0 1.42 0 1.968.024a1.65 1.65 0 011.729 1.447c.18 1.045.44 1.326 1.125 1.547a14.105 14.105 0 003.315.764c.945 0 1.1-2.292 1.1-2.292.009-2.993-7.447-3.816-8.431-3.816"/></svg></button></div></div><div id="call-prompt" style="display: none;" class="promptMessage agent-message">When prompted, pleaseallowaccess to your camera and microphone.</div><div id="servicepattern-chat"><div id="scrollbar-container"><div id="messages-div" class="viewport"><div id="messages-div-outer" class="ps-container"><div id="messages-div-inner" class="overview messages-div-inner"style="bottom: 0px; top: auto;"><div class="new-msg-container agentMessage new-msg-animate agent-message"><div class="pip agent-message base-font"></div><div class="new-msg-body agentMessage"><div class="new-msg-body-inner"><div class="new-msg-text" style="height: auto;"><div class="new-msg-text-inner base-font">Please wait while wearelooking for an available representative...</div></div></div></div><div class="new-time">00:00</div></div><div id=""class="new-msg-container agentMessage new-msg-animate agent-message"><div class="new-msg-body agentMessage"><div class="pip agent-message base-font"></div><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner base-font">Representative found. Connecting...</div></div></div></div><div class="new-time">00:00</div></div><div class="new-msg-container systemMessage new-msg-animate main-color"><div class="new-msg-body systemMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner agentJoinedMessage"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><path class="main-fill-color" d="M9.811 2.327l-4.023 4.056-.045.069c-.073.074-.159.126-.249.16l-.03.008-.159.031-.121-.002-.123-.024-.063-.02c-.085-.032-.165-.083-.233-.153l-1.265-1.273c-.27-.272-.27-.713 0-.985.271-.272.708-.272.978 0l.848.854 3.59-3.621c.247-.249.646-.249.895 0 .246.248.246.651 0 .9zm-4.848-.994c-2.01 0-3.64 1.642-3.64 3.667 0 2.026 1.63 3.667 3.64 3.667 1.828 0 3.337-1.358 3.596-3.127l1.303-1.312c.038.252.064.509.064.772 0 2.762-2.222 5-4.963 5s-4.963-2.238-4.963-5c0-2.761 2.222-5 4.963-5 .991 0 1.911.296 2.686.799l-.963.971c-.513-.278-1.1-.437-1.723-.437z"/></svg><span></span></div></div></div></div><div class="new-time"></div></div><div class="new-msg-container clientMessage new-msg-animate main-background-color"><div class="pip main-background-color second-color"></div><div class="new-msg-body clientMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner second-color">User message</div></div></div></div><div class="new-time">00:00</div></div><div class="new-msg-container agentMessage new-msg-animate agent-message"><div class="pip agent-message base-font"></div><div class="new-msg-body agentMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="agent-image-wrapper"><div class="agent-image-background-filler main-background-color"></div><div class="agentImage previewAgentImage" style="background:url('+chatPath+'images/man-with-glasses.jpg) center center no-repeat/contain"></div></div><div class="new-msg-text-inner base-font">Agent message</div></div></div></div><div class="new-time">00:00</div></div><div class="new-msg-container systemMessage new-msg-animate main-color"><div class="new-msg-body systemMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner inactivityWarningText"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><path class="main-fill-color" d="M9.811 2.327l-4.023 4.056-.045.069c-.073.074-.159.126-.249.16l-.03.008-.159.031-.121-.002-.123-.024-.063-.02c-.085-.032-.165-.083-.233-.153l-1.265-1.273c-.27-.272-.27-.713 0-.985.271-.272.708-.272.978 0l.848.854 3.59-3.621c.247-.249.646-.249.895 0 .246.248.246.651 0 .9zm-4.848-.994c-2.01 0-3.64 1.642-3.64 3.667 0 2.026 1.63 3.667 3.64 3.667 1.828 0 3.337-1.358 3.596-3.127l1.303-1.312c.038.252.064.509.064.772 0 2.762-2.222 5-4.963 5s-4.963-2.238-4.963-5c0-2.761 2.222-5 4.963-5 .991 0 1.911.296 2.686.799l-.963.971c-.513-.278-1.1-.437-1.723-.437z"/></svg><span></span></div></div></div></div><div class="new-time"></div></div><div class="new-msg-container systemMessage new-msg-animate main-color"><div class="new-msg-body systemMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner inactivityTimeoutText"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><path class="main-fill-color" d="M9.811 2.327l-4.023 4.056-.045.069c-.073.074-.159.126-.249.16l-.03.008-.159.031-.121-.002-.123-.024-.063-.02c-.085-.032-.165-.083-.233-.153l-1.265-1.273c-.27-.272-.27-.713 0-.985.271-.272.708-.272.978 0l.848.854 3.59-3.621c.247-.249.646-.249.895 0 .246.248.246.651 0 .9zm-4.848-.994c-2.01 0-3.64 1.642-3.64 3.667 0 2.026 1.63 3.667 3.64 3.667 1.828 0 3.337-1.358 3.596-3.127l1.303-1.312c.038.252.064.509.064.772 0 2.762-2.222 5-4.963 5s-4.963-2.238-4.963-5c0-2.761 2.222-5 4.963-5 .991 0 1.911.296 2.686.799l-.963.971c-.513-.278-1.1-.437-1.723-.437z"/></svg><span></span></div></div></div></div><div class="new-time"></div></div><div class="new-msg-container systemMessage new-msg-animate main-color"><div class="new-msg-body systemMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner agentLeftText"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><path class="main-fill-color" d="M9.811 2.327l-4.023 4.056-.045.069c-.073.074-.159.126-.249.16l-.03.008-.159.031-.121-.002-.123-.024-.063-.02c-.085-.032-.165-.083-.233-.153l-1.265-1.273c-.27-.272-.27-.713 0-.985.271-.272.708-.272.978 0l.848.854 3.59-3.621c.247-.249.646-.249.895 0 .246.248.246.651 0 .9zm-4.848-.994c-2.01 0-3.64 1.642-3.64 3.667 0 2.026 1.63 3.667 3.64 3.667 1.828 0 3.337-1.358 3.596-3.127l1.303-1.312c.038.252.064.509.064.772 0 2.762-2.222 5-4.963 5s-4.963-2.238-4.963-5c0-2.761 2.222-5 4.963-5 .991 0 1.911.296 2.686.799l-.963.971c-.513-.278-1.1-.437-1.723-.437z"/></svg><span></span></div></div></div></div><div class="new-time"></div></div><div class="new-msg-container systemMessage new-msg-animate main-color"><div class="new-msg-body systemMessage"><div class="new-msg-body-inner"><div class="new-msg-text " style="height: auto;"><div class="new-msg-text-inner sessionEndedText"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><path class="main-fill-color" d="M9.811 2.327l-4.023 4.056-.045.069c-.073.074-.159.126-.249.16l-.03.008-.159.031-.121-.002-.123-.024-.063-.02c-.085-.032-.165-.083-.233-.153l-1.265-1.273c-.27-.272-.27-.713 0-.985.271-.272.708-.272.978 0l.848.854 3.59-3.621c.247-.249.646-.249.895 0 .246.248.246.651 0 .9zm-4.848-.994c-2.01 0-3.64 1.642-3.64 3.667 0 2.026 1.63 3.667 3.64 3.667 1.828 0 3.337-1.358 3.596-3.127l1.303-1.312c.038.252.064.509.064.772 0 2.762-2.222 5-4.963 5s-4.963-2.238-4.963-5c0-2.761 2.222-5 4.963-5 .991 0 1.911.296 2.686.799l-.963.971c-.513-.278-1.1-.437-1.723-.437z"/></svg><span></span></div></div></div></div><div class="new-time"></div></div><div id="messages-div-inner-clear"></div></div><div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 3px;"><div class="ps-scrollbar-x" style="left: 0px; width: 0px;"></div></div><div class="ps-scrollbar-y-rail" style="top: 0px; right: 0px;"><div class="ps-scrollbar-y" style="top: 0px; height: 0px;"></div></div></div><div id="agent-typing" style="display: none;"><div class="agent-typing-wrapper"></div></div></div></div></div></div><div id="input-div" class="chat-body__input agent-message"><div class="input-div-table"><div class="td-textarea"><textarea id="input-field" data-emoji-input="unicode" data-emojiable="true" rows="1" name="input-field" maxlength="1000" placeholder="'+i18n.hintMessageTextBox+'" autocomplete="off" style="resize: none;"></textarea></div><i class="emoji-picker-icon emoji-picker fa fa-smile-o" data-type="picker"></i><div id="attachFile" class="preview"></div><div class="td-button"><input id="input-button" type="button" value="Send" class="servicepatternBtn accept"></div></div></div></div></div><form name="file-upload-form" id="file-upload-form" target="_blank" method="post" enctype="multipart/form-data" style="display:none;"></form></div></div></div></div><div class="sp-callback-form" id="sp-callback-form" class="sp-callback-form"><div class="fields"><label>Request a callback</label><input type="text" id="sp-callback-test" placeholder="test" /><label>test</label></div><button id="sp-callback-submit">Chat</button><button id="sp-callback-submit">Call</button></div></div></div>'},chatPreview=function(){var helpers=constructorHelpers();window.addEventListener?window.addEventListener("message",helpers.listener):window.attachEvent("onmessage",helpers.listener),helpers.showChat()},chatSnippet=function(){setTimeout(function(){widgetConfiguration.isPreviewMode()&&chatPreview(),snippetBuild()})},snippetBuild=function(){if(widgetConfiguration.isPreviewMode())snippetOnInitialize();else{var config=snippetVariables();config.SP.tenantUrl&&config.SP.appId&&(config.SP.cp={url:config.SP.apiUrl,crossDomain:!0,tenantUrl:config.SP.tenantUrl,appId:config.SP.appId,clientId:"WebChat",phoneNumber:config.SP.phoneNumber,parameters:config.SP.parameters,onFormShow:config.SP.onFormShow,onAddStream:config.SP.onAddStream,onAddLocalStream:config.SP.onAddLocalStream},snippetOnInitialize())}},snippetChatUrl=function(f,l,p,e){var config=snippetVariables(),first=f||encodeURIComponent(config.SP.first_name||""),last=l||encodeURIComponent(config.SP.last_name||""),phone=p||encodeURIComponent(config.SP.phone_number||""),email=e||encodeURIComponent(config.SP.email||""),location="";config.SP.location&&(location+="&latitude="+encodeURIComponent(config.SP.location.latitude+""),location+="&longitude="+encodeURIComponent(config.SP.location.longitude+""));var chatPath=widgetConfiguration.getChatPath(),chatHtmlName=config.SP.chatHtmlName,isCobrowsingTogetherJS=widgetConfiguration.isCobrowsingTogetherJS();if(chatPath+=chatHtmlName+"?tenantUrl="+encodeURIComponent(config.SP.tenantUrl)+"&appId="+config.SP.appId+"&referrer="+encodeURIComponent(window.location.href)+"&referrerTitle="+encodeURIComponent(window.document.title)+"&webServer="+encodeURIComponent(config.SP.apiUrl)+"&logging="+encodeURIComponent(config.SP.logging||"")+location+"&phone_number="+phone+"&from="+encodeURIComponent(config.SP.from||"")+"&email="+email+"&account_number="+encodeURIComponent(config.SP.account_number||"")+"&first_name="+first+"&last_name="+last+"&togetherjs_enabled="+encodeURIComponent(isCobrowsingTogetherJS||"")+"&autostartVideocall="+encodeURIComponent(config.SP.autostartVideocall||""),config.SP.parameters)for(let property1 in config.SP.parameters)config.SP.parameters.hasOwnProperty(property1)&&(chatPath+="&custom_"+property1+"="+encodeURIComponent(config.SP.parameters[property1]||""));return chatPath},snippetCheckAddFrame=function(startSession){var config=snippetVariables();if(!document.querySelector("#sp-chat-iframe")){config.SP.sound_notification&&(config.audioElement.setAttribute("src",config.SP.sound_notification_file),config.audioElement.load());var definition=widgetConfiguration.getDefinition(),chatWidgetConfig=definition?definition.chatWidgetStyling:{},frame=document.querySelector("#sp-chat-frame"),isChatMinimized="true"===sessionStorage.getItem("bp-minimized");if(widgetConfiguration.isMobile())isChatMinimized||(frame.style.height="100%",frame.style.width="100%");else{if(!isChatMinimized){var frameHeight=Math.min.apply(Math,[chatWidgetConfig.height,window.innerHeight-20]);frame.style.height=frameHeight+"px",frame.style.width=chatWidgetConfig.width+"px"}try{window.parent.addEventListener("resize",function(){if(!isChatMinimized){var frameHeight=Math.min.apply(Math,[chatWidgetConfig.height,window.innerHeight-20]);frame.style.height=frameHeight+"px"}})}catch(e){console.warn("Snippet parent page is on a different domain")}}var url=startSession?snippetChatUrl(startSession.session.cp.parameters.first_name,startSession.session.cp.parameters.last_name,startSession.session.cp.phone_number,startSession.session.cp.parameters.email):snippetChatUrl(),start=startSession?"&start="+startSession.session.sessionId:"",styles="";"true"===sessionStorage.getItem("bp-minimized")&&(styles=' style="box-shadow:none;background:none;" ');var html="<iframe lang='en-US' title='Chat widget' id='sp-chat-iframe' "+styles+"allow='camera; microphone' class='widget-border-radius dialog-shadow' frameborder='0' scrolling='no' src="+url+start+"></iframe>";document.querySelector("#sp-iframe-container").insertAdjacentHTML("beforeend",html)}},snippetCheckAvailability=function(needToHandleAvailability){var cachedConfUrl=sessionStorage.getItem("cachedConfUrl"),cachedConf=widgetConfiguration.getParams();function whenConfigLoaded(){"round"===widgetConfiguration.getDefinitionStyling().tabStyle?document.querySelector("#sp-chat-widget .sp-round-button").style.display="":document.querySelector("#sp-chat-widget .sp-chat-widget__content").style.display="",loadCobrowsingSolution(),sendRequestToClientWebserver("availability",function(xmlhttp){var available="available"===JSON.parse(xmlhttp.responseText).chat,ewt=JSON.parse(xmlhttp.responseText).ewt||"0";sessionStorage.setItem("serviceAvailable",available),sessionStorage.setItem("ewt",ewt),needToHandleAvailability&&snippetHandleAvailability(available)}),sendRequestToClientWebserver("iceservers",function(xmlhttp){var iceServersConfiguration=JSON.parse(xmlhttp.responseText).servers;sessionStorage.setItem("iceServersConfiguration",JSON.stringify(iceServersConfiguration))})}if(!(cachedConfUrl&&chatCompareUrl(cachedConfUrl)&&cachedConf))return sendRequestToClientWebserver("configuration",function(xmlhttp){sessionStorage.setItem("confParams",xmlhttp.responseText),whenConfigLoaded()});function sendRequestToClientWebserver(resource,callback){var xmlhttp,url=SERVICE_PATTERN_CHAT_CONFIG.apiUrl+"/"+resource+"?tenantUrl="+encodeURIComponent(SERVICE_PATTERN_CHAT_CONFIG.tenantUrl)+"&domain="+encodeURIComponent(window.location.host)+"&appId="+encodeURIComponent(SERVICE_PATTERN_CHAT_CONFIG.appId);return(xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){4===xmlhttp.readyState&&200===xmlhttp.status&&callback(xmlhttp)},xmlhttp.withCredentials=!0,xmlhttp.crossDomain=!0,xmlhttp.open("GET",url,!0),xmlhttp.setRequestHeader("Authorization",'MOBILE-API-140-327-PLAIN appId="'+SERVICE_PATTERN_CHAT_CONFIG.appId+'", clientId="'+SERVICE_PATTERN_CHAT_CONFIG.clientId+'"'),xmlhttp.send(),xmlhttp.onreadystatechange()}whenConfigLoaded()},snippetCheckDeviceSupport=function(){navigator.enumerateDevices=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?function(cb){navigator.mediaDevices.enumerateDevices().then(cb)}:navigator.enumerateDevices;var f="undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||!(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices),handleErrors=function(cam,mic){cam?$("#call-prompt .error.camera").hide():$("#call-prompt .error.camera").show(),mic?$("#call-prompt .error.microphone").hide():$("#call-prompt .error.microphone").show()},dev=new Array,mic=!1,micFlag=!1,cam=!1,camFlag=!1;f&&(navigator.enumerateDevices?navigator.enumerateDevices=!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources?navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack):!navigator.enumerateDevices&&navigator.enumerateDevices?navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator):navigator.enumerateDevices:handleErrors(cam,mic),navigator.enumerateDevices(function(elements){elements.forEach(function(props){switch(dev.forEach(function(d){d.id!==props.id||(d.kind,props.kind)}),props.deviceId=props.deviceId?props.deviceId:props.id,props.id=props.id?props.id:props.deviceId,props.kind){case"audio":props.kind="audioinput";case"video":props.kind="videoinput";case"videoinput":cam=!0,camFlag=!camFlag;break;case"audioinput":mic=!0,micFlag=!micFlag;break;case"audiooutput":!0}dev.push(props)}),handleErrors(cam,mic)}))};window.cobrowsingSolution=null;var loadCobrowsingSolution=function(){var surflyWidgetKey=widgetConfiguration.getSurflyWidgetKey();if(surflyWidgetKey){var surflySnippetScript=document.createElement("script");surflySnippetScript.innerHTML="(function(s,u,r,f,l,y){s[f]=s[f]||{init:function(){s[f].q=arguments}};l=u.createElement(r);y=u.getElementsByTagName(r)[0];l.async=1;l.src='https://surfly.com/surfly.js';y.parentNode.insertBefore(l,y);})(window,document,'script','Surfly');",document.body.appendChild(surflySnippetScript),window.cobrowsingSolution=snippetSurfly,window.cobrowsingSolution.init(surflyWidgetKey,function(){sessionStorage.getItem("bp-cobrowsing-dialog")&&window.cobrowsingSolution.askToStart()})}else widgetConfiguration.isCobrowsingTogetherJS()&&loadScripts(["build/togetherjs/togetherjs.js"],function(){window.cobrowsingSolution=snippetTogetherJs,window.cobrowsingSolution.init()})},removeCobrowsingPopup=function(){var bgOverlay=document.getElementById("bp_surfly_overlay");bgOverlay&&document.body.removeChild(bgOverlay),sessionStorage.removeItem("bp-cobrowsing-dialog")},showCobrowsingStartPopup=function(onAccept,onReject){var i18n=clientChatUiI18n(),title=i18n.cobrowsingDialogHeader,content=i18n.cobrowsingDialogText,accept=i18n.cobrowsingDialogAcceptLabel,cancel=i18n.cobrowsingDialogCancelLabel;"disable"===content&&onAccept&&onAccept();var popupHtml='<div id="bp_surfly_overlay" class="bp-surfly-overlay"><div class="bp-surfly-popup" ><div class="bp-surfly-title">'+title+'</div><div class="bp-surfly-body"><p class="bp-surfly-content">'+content+'</p><div class="bp-surfly-buttons"><button id="bp_surfly_cancel" class="bp-surfly-cancel">'+cancel+'</button><button id="bp_surfly_accept" class="bp-surfly-accept">'+accept+"</button></div></div></div></div>";document.getElementById("bp_surfly_overlay")||(document.body.insertAdjacentHTML("beforeend",popupHtml),sessionStorage.setItem("bp-cobrowsing-dialog","true"),setTimeout(function(){var cancelButton=document.getElementById("bp_surfly_cancel"),acceptButton=document.getElementById("bp_surfly_accept");cancelButton.onclick=function(){removeCobrowsingPopup(),onReject&&onReject()},acceptButton.onclick=function(){removeCobrowsingPopup(),onAccept&&onAccept()}}))},snippetConfigurationSnippet=function(config,styles){var previewMode=widgetConfiguration.isPreviewMode(),helper=snippetHelperFunctions();updateChatStyles(config,styles);var container=document.querySelector("#sp-root-container"),widget=document.querySelector("#sp-chat-widget"),fake=document.querySelector("#sp-chat-fake"),frame=document.querySelector("#sp-chat-frame"),proactiveOffers=document.querySelectorAll(".proactive-offer"),labelText=document.querySelector("#sp-chat-label-text"),roundButton=document.querySelector(".sp-round-button"),labelIcon=document.querySelector("#sp-chat-label-icon"),closeIcon=document.querySelector("#sp-close-frame"),dragHandle=document.querySelector("#sp-drag-handle"),minTab=document.querySelector("#sp-min-tab-wrapper"),definition=widgetConfiguration.getDefinition();function addElementClasses(element,orientation){element.removeAttribute("class"),helper.addClass(element,"position_"+config.contactTab.location),commonUtilService.isDefined(orientation)&&helper.addClass(element,orientation)}if(definition&&definition.chatWidgetStyling&&"none"===definition.chatWidgetStyling.showAgentPic&&(helper.addClass(closeIcon,"narrow"),helper.addClass(dragHandle,"narrow")),container&&helper.show(container),config&&config.contactTab){var text,icon=config.contactTab.iconUrl||"",isChatStyling=previewMode&&"chat_styling"===config.widgetType,orientation=widgetConfiguration.getOrientation();widget&&addElementClasses(widget,orientation),fake&&addElementClasses(fake,orientation),!isChatStyling&&frame&&addElementClasses(frame,orientation),minTab&&addElementClasses(minTab,orientation),config.contactTab.location.split("_").forEach(function(item,i){widget&&helper.addClass(widget,item+"_"+i),fake&&helper.addClass(fake,item+"_"+i),!isChatStyling&&frame&&helper.addClass(frame,item+"_"+i),minTab&&helper.addClass(minTab,item+"_"+i)}),commonUtilService.isServiceAvailable()?(text=config.contactTab.agentsAvailableMsg?config.contactTab.agentsAvailableMsg:"",previewMode||[].forEach.call(proactiveOffers,function(proactiveOffer){proactiveOffer.setAttribute("style","display:block")})):text=config.contactTab.outOfHoursMsg?config.contactTab.outOfHoursMsg:"",definition&&definition.chatWidgetStyling&&("round"===definition.chatWidgetStyling.tabStyle?helper.addClass(minTab,"use-round-button"):helper.addClass(minTab,"use-default-styling")),labelText&&(labelText.innerHTML=text||"",roundButton.setAttribute("title",text||"")),labelIcon?labelIcon.style.cssText=icon.length>0?'width: 28px;margin: 6px 10px;background:url("'+icon+'") center center no-repeat':"":helper.addClass(labelIcon,"collapse")}else widget&&helper.hide(widget)},snippetDraggable=function(){var selected=null,x_pos=0,y_pos=0,x_elem=0,y_elem=0;var target=document.querySelector("[data-draggable]"),handler=document.getElementById(target.getAttribute("data-draggable"));handler.onmousedown=function(){return x_elem=x_pos-(selected=target).offsetLeft,y_elem=y_pos-selected.offsetTop,!1},document.onmousemove=function(e){if(x_pos=document.all?window.event.clientX:e.pageX,y_pos=document.all?window.event.clientY:e.pageY,w=window.innerWidth,h=window.innerHeight,null!==selected){ew=selected.offsetWidth,eh=handler.offsetHeight;var eLeft=x_pos-x_elem,eTop=y_pos-y_elem,bottomBorder=h-eh,rightBorder=w-ew;eTop=(eTop=eTop>bottomBorder?bottomBorder:eTop)<1?1:eTop,eLeft=(eLeft=eLeft>rightBorder?rightBorder:eLeft)<1?1:eLeft,eLeft+="px",eTop+="px",selected.style.left=eLeft,selected.style.top=eTop,sessionStorage.setItem("chatLeft",eLeft),sessionStorage.setItem("chatTop",eTop)}},document.onmouseup=function(){selected=null}},snippetHandleAvailability=function(available){var contactTab,threshold,spChatWidget=document.querySelector("#sp-chat-widget"),spCallbackForm=document.querySelector("#sp-callback-form"),spConf=SERVICE_PATTERN_CHAT_CONFIG;function openPreChatTab(){var chatFrame=document.getElementById("sp-chat-iframe"),ev="call"===sessionStorage.getItem("tab")?"showCallTab":"showChatTab",sessionTab=sessionStorage.getItem("tab");ev="call"===sessionTab?"showCallTab":"chat"===sessionTab?"showChatTab":"showDefaultTab",chatFrame&&chatFrame.contentWindow.postMessage(ev,"*")}if(window.addEventListener("message",function(event){var chatFrame,data=event.data;"getTabName"===data&&openPreChatTab(),"getServicePatternChatConfig"===data&&(chatFrame=document.getElementById("sp-chat-iframe"))&&chatFrame.contentWindow.postMessage({eventName:"setServicePatternChatConfig",params:{servicePatternChatConfig:JSON.parse(JSON.stringify(SERVICE_PATTERN_CHAT_CONFIG))}},"*")},!1),!widgetConfiguration.isPreviewMode()){var confObj=widgetConfiguration.getObject(),target=widgetConfiguration.getTarget(),definition=widgetConfiguration.getDefinition(),snippetConfig=widgetConfiguration.getSnippet(),snippetIndex=widgetConfiguration.getSnippetIndex(),offerIndex=widgetConfiguration.getProactiveOfferIndex(),eventsCallback=spConf.callbacks,util=commonUtilService;if(0===document.querySelectorAll("#sp-callback-form.sp-callback-form").length&&definition&&function(definition,itemProp,targetProp){definition&&0===definition[itemProp].length?console.warn("No contact tab configuration for: "+itemProp):commonUtilService.isUndefined(target[targetProp].widgetIndex)&&console.warn("No contact tab configuration assigned for the current URL")}(definition,"chatInitiations","chatInitiation"),util.isDefined(snippetIndex)||util.isDefined(offerIndex)){if(snippetConfig&&(contactTab=snippetConfig.contactTab,threshold=contactTab.ewtThreshold,!contactTab.enabled||contactTab.doNotShowAfterHours&&!commonUtilService.isServiceAvailable()||contactTab.doNotShowAfterEWTThreshold&&commonUtilService.isEWTExceedThreshold(threshold)||spChatWidget.removeAttribute("data-hidden")),function(){var eventsCallback=spConf.callbacks,isAvailable=commonUtilService.isServiceAvailable(),isNotAvailable=commonUtilService.isServiceNotAvailable();eventsCallback&&eventsCallback.weAreOnline&&("true"===isAvailable&&eventsCallback.weAreOnline(),"false"===isNotAvailable&&eventsCallback.weAreOffline())}(),definition&&!1===definition.chatWidgetStyling.webNotificationsEnabled?window.localStorage.setItem("doNotShowNotifications","true"):window.localStorage.removeItem("doNotShowNotifications"),proactiveOfferService.buildProactiveOffer(openPreChatTab),spConf.hidden&&!sessionStorage.getItem("sp-chat-snippet"))return;snippetConfigurationSnippet(snippetConfig,confObj.styles),snippetConfig&&(spChatWidget.style.display="block",spChatWidget.style.cursor="pointer",spConf.autostartChat&&!sessionStorage.getItem("sp-chat-snippet")&&setTimeout(function(){sessionStorage.setItem("source","widget"),snippetOpenChat(!0),proactiveOfferService.removeProactiveOffer()},500)),spChatWidget.addEventListener("click",function(){sessionStorage.setItem("source","widget");var chatIframe=document.getElementById("sp-chat-iframe");chatIframe&&chatIframe.contentWindow&&chatIframe.contentWindow.postMessage("bp-request-minimize-off","*"),snippetOpenChat(!0),proactiveOfferService.removeProactiveOffer(),eventsCallback&&eventsCallback.reactiveChatButtonClicked&&eventsCallback.reactiveChatButtonClicked()})}spCallbackForm&&(spCallbackForm.style.display="inline-block");var spOfflineLabel=document.querySelector("#sp-offline-label"),spOnlineLabel=document.querySelector("#sp-online-label");spOfflineLabel&&(spOfflineLabel.style.display=available?"none":"block"),spOnlineLabel&&(spOnlineLabel.style.display=available?"block":"none"),sessionStorage.getItem("sp-chat-snippet")&&snippetOpenChat(!0)}},snippetHelperFunctions=function(){return{hasClass:function(el,className){return el.classList?el.classList.contains(className):!!el.className.match(new RegExp("(\\s|^)"+className+"(\\s|$)"))},addClass:function(el,className){el.classList?el.classList.add(className):hasClass(el,className)||(el.className+=" "+className)},removeClass:function(el,className){if(el.classList)el.classList.remove(className);else if(hasClass(el,className)){var reg=new RegExp("(\\s|^)"+className+"(\\s|$)");el.className=el.className.replace(reg," ")}},getRealDisplay:function(elem){return elem.currentStyle?elem.currentStyle.display:window.getComputedStyle?window.getComputedStyle(elem,null).getPropertyValue("display"):void 0},hide:function(el){el.getAttribute("displayOld")||el.setAttribute("displayOld",el.style.display),el.style.display="none"},isHidden:function(el){var width=el.offsetWidth,height=el.offsetHeight,tr="tr"===el.nodeName.toLowerCase();return 0===width&&0===height&&!tr||!(width>0&&height>0&&!tr)&&this.getRealDisplay(el)},toggle:function(el){this.isHidden(el)?this.show(el):this.hide(el)},show:function(el){var displayCache={};if("none"==this.getRealDisplay(el)){var old=el.getAttribute("displayOld");if(el.style.display=old||"","none"===this.getRealDisplay(el)){var display,nodeName=el.nodeName,body=document.body;if(displayCache[nodeName])display=displayCache[nodeName];else{var testElem=document.createElement(nodeName);body.appendChild(testElem),"none"===(display=this.getRealDisplay(testElem))&&(display="block"),body.removeChild(testElem),displayCache[nodeName]=display}el.setAttribute("displayOld",display),el.style.display=display}}}}},snippetKeepOpenedState=function(opened){opened?sessionStorage.setItem("sp-chat-snippet","true"):sessionStorage.removeItem("sp-chat-snippet")},snippetOnInitialize=function(){var variables=snippetVariables(),helper=snippetHelperFunctions(),head=document.querySelector("head"),body=document.querySelector("body"),spConfig=SERVICE_PATTERN_CHAT_CONFIG,i18n=clientChatUiI18n();function loadCss(target,fileNames){var chatPath=widgetConfiguration.getChatPath();Array.isArray(fileNames)&&fileNames.forEach(function(fileName){target.insertAdjacentHTML("beforeend","<link href='"+chatPath+"css/"+fileName+".css' type='text/css' rel='stylesheet' />")})}function startMinimized(){sessionStorage.setItem("bp-minimized",!0);var spChatIframe=document.getElementById("sp-chat-iframe"),spDragHandle=document.getElementById("sp-drag-handle"),spSideBar=document.getElementById("sp-side-bar"),spChatFrame=document.getElementById("sp-chat-frame");spChatIframe&&(spChatIframe.style.boxShadow="none",spChatIframe.style.background="none"),spDragHandle.style.display="none",spSideBar.style.display="none",spChatFrame.style.removeProperty("left"),spChatFrame.style.removeProperty("top")}function safeWrap(func,callback){func&&(commonUtilService.isDefined(console)&&console.log("Snippet will wrap the site function %o",func),func()),callback()}function onVisibilityChange(evt){var h="sp-hidden",evtMap={blur:h,focusout:h,pagehide:h};evt=evt||window.event;var spRoot=document.getElementById("sp-root-container");if(helper.removeClass(spRoot,h),evt.type in evtMap?helper.addClass(spRoot,evtMap[evt.type]):this.hidden&&helper.addClass(spRoot,h),helper.hasClass(spRoot,h))for(var arrayLength=variables.notifications.length,i=0;i<arrayLength;i++)variables.notifications[i].close()}function closeFrame(){spConfig.callbacks&&spConfig.callbacks.windowCloseIconClicked&&spConfig.callbacks.windowCloseIconClicked(),document.getElementById("sp-chat-iframe").contentWindow.postMessage("sp-disconnect","*")}function receiveMessage(event){var spChatIframe=document.getElementById("sp-chat-iframe"),spChatFrame=document.getElementById("sp-chat-frame"),spMinTab=document.getElementById("sp-min-tab-wrapper"),data=event.data;if(commonUtilService.isString(data)){var conf=widgetConfiguration.getParams(),snippetConfig=widgetConfiguration.getSnippet(),definition=widgetConfiguration.getDefinition(),chatWidgetStyling=widgetConfiguration.getDefinitionStyling(),width=320,height=720;if(definition&&chatWidgetStyling){width=chatWidgetStyling.width,height=void 0;try{height=Math.min.apply(Math,[parseInt(chatWidgetStyling.height)-10,window.parent.innerHeight-20])}catch(e){height=parseInt(chatWidgetStyling.height)-10}}if("ready"==event.data)spChatIframe.contentWindow.postMessage("[parentPath]="+window.location.pathname,"*"),spChatIframe.contentWindow.postMessage("[parentHost]="+window.location.host,"*"),spChatIframe.contentWindow.postMessage("[serviceAvailable]="+sessionStorage.getItem("serviceAvailable"),"*"),spChatIframe.contentWindow.postMessage("[source]="+sessionStorage.getItem("source"),"*"),spChatIframe.contentWindow.postMessage("[iceServers]="+sessionStorage.getItem("iceServersConfiguration"),"*"),spChatIframe.contentWindow.postMessage(conf,"*");else if("formsGenerated"==event.data);else if("sp-session-end"===data)window.setTimeout(function(){snippetOpenChat(!1,!0),window.cobrowsingSolution&&window.cobrowsingSolution.isRunning()&&window.cobrowsingSolution.stop()},500),spConfig.returnUrl&&window.location.replace(spConfig.returnUrl),removeCobrowsingPopup&&removeCobrowsingPopup();else if("sp-chat-init"==data){document.getElementById("sp-drag-handle").style.height="0px";var isChatMinimized="true"===sessionStorage.getItem("bp-minimized");widgetConfiguration.isMobile()||isChatMinimized||(spChatFrame.style.height=height+"px",spChatFrame.style.width=width+"px")}else if("sp-chat-maximize-on"==data)helper.addClass(spChatFrame,"sp-chat-frame-maximize");else if("sp-chat-maximize-off"==data)helper.removeClass(spChatFrame,"sp-chat-frame-maximize");else if("sp-chat-drag"==data&&snippetConfig){var location=snippetConfig.contactTab.location;-1===location.indexOf("_top")&&-1===location.indexOf("left_middle")&&-1===location.indexOf("left_bottom")&&-1===location.indexOf("right_")&&location.indexOf("top_right")}else if("sp-session-start"==data)window.Notification&&"denied"!==window.Notification.permission&&(spChatIframe.contentWindow.postMessage("sp-req-notification","*"),window.Notification.requestPermission(function(permission){spChatIframe.contentWindow.postMessage("sp-req-notification-end","*")}));else if(data.indexOf("sp-notification")>0){var parse=JSON.parse(data);snippetShowNotification(parse.name,parse.msg,parse.photo)}else if(data.indexOf("sp-storage")>0){var store=JSON.parse(data);window.localStorage.setItem(store.key,store.value)}else if("sp-get-status-together"===data)window.cobrowsingSolution&&(window.cobrowsingSolution.isRunning()?spChatIframe.contentWindow.postMessage("sp-started-together","*"):spChatIframe.contentWindow.postMessage("sp-stopped-together","*"));else if("sp-pre-chat-form-cancel-button-clicked"===data)spConfig.callbacks&&spConfig.callbacks.preChatWindowCancelButtonClicked&&spConfig.callbacks.preChatWindowCancelButtonClicked();else if("sp-pre-chat-form-phone-button-clicked"===data)spConfig.callbacks&&spConfig.callbacks.preChatWindowPhoneButtonClicked&&spConfig.callbacks.preChatWindowPhoneButtonClicked();else if("sp-pre-chat-form-chat-button-clicked"===data)spConfig.callbacks&&spConfig.callbacks.preChatWindowChatButtonClicked&&spConfig.callbacks.preChatWindowChatButtonClicked();else if("bp-cobrowsing-requested"===data)window.cobrowsingSolution&&window.cobrowsingSolution.askToStart();else if("bp-stop-cobrowsing"===data)window.cobrowsingSolution&&window.cobrowsingSolution.isRunning()?window.cobrowsingSolution.stop():removeCobrowsingPopup&&removeCobrowsingPopup();else if("bp-stop-cobrowsing-and-close-chat"===data)window.cobrowsingSolution&&window.cobrowsingSolution.isRunning()?(snippetKeepOpenedState(!1),window.cobrowsingSolution.stop()):removeCobrowsingPopup&&removeCobrowsingPopup();else if("bp-start-cobrowsing"===data&&window.cobrowsingSolution)window.cobrowsingSolution&&window.cobrowsingSolution.start();else if("bp-start-minimized"===data)startMinimized();else if("bp-stop-minimized"===data)!function(){sessionStorage.removeItem("bp-minimized");var spChatIframe=document.getElementById("sp-chat-iframe"),spIframeContainer=document.getElementById("sp-iframe-container"),spDragHandle=document.getElementById("sp-drag-handle"),spSideBar=document.getElementById("sp-side-bar"),spChatFrame=document.getElementById("sp-chat-frame"),spMinTab=document.getElementById("sp-min-tab-wrapper"),chatWidgetStyling=widgetConfiguration.getDefinitionStyling();if(spMinTab&&helper.removeClass(spMinTab,"show"),spIframeContainer)for(var i=0;i<spIframeContainer.classList.length;++i)if("min-"===spIframeContainer.classList[i].substr(0,4)){spIframeContainer.classList.remove(spIframeContainer.classList[i]);break}if(spChatIframe&&(spChatIframe.style.removeProperty("box-shadow"),spChatIframe.style.removeProperty("background")),spDragHandle&&spDragHandle.style.removeProperty("display"),spSideBar&&spSideBar.style.removeProperty("display"),spChatFrame)if(spChatFrame.style.left=sessionStorage.getItem("chatLeft"),spChatFrame.style.top=sessionStorage.getItem("chatTop"),widgetConfiguration.isMobile())spChatFrame.style.height="100%",spChatFrame.style.width="100%";else{var frameHeight=Math.min.apply(Math,[chatWidgetStyling.height,window.innerHeight-20]);spChatFrame.style.height=frameHeight+"px",spChatFrame.style.width=chatWidgetStyling.width+"px"}}();else if("bp-request-max-height"===data){var frameMaxHeight=Math.min.apply(Math,[chatWidgetStyling.height,window.innerHeight-20]);spChatIframe.contentWindow.postMessage(JSON.stringify({message:"bp-max-height",height:frameMaxHeight}),"*")}else try{var parsed=JSON.parse(data);if("bp-dimensions"!==parsed.type||window.__bpap){if("bp-update-agent-data"===parsed.type){var minAgentName=document.getElementById("min_agent_name"),minAgentImage=document.getElementById("min_agent_image");parsed.data.name&&minAgentName&&minAgentImage&&(minAgentName.textContent=parsed.data.name,parsed.data.url?(minAgentImage.style.display="block",minAgentImage.style.background="url("+parsed.data.url+") center center no-repeat"):minAgentImage.style.display="none")}else if("bp-show-close-chat-dialog"===parsed.message){window.confirm(parsed.text)&&spChatIframe.contentWindow.postMessage("bp-close-chat-confirmed","*")}}else sessionStorage.getItem("bp-minimized")&&(parsed.data.height&&("0px"===parsed.data.height||"0"===parsed.data.height?helper.addClass(spMinTab,"show"):helper.removeClass(spMinTab,"show"),spChatFrame.style.height=parsed.data.height),parsed.data.width&&!widgetConfiguration.isMobile()&&(spChatFrame.style.width=parsed.data.width))}catch(e){}}}widgetConfiguration.isPreviewMode()?function(){window.parent.postMessage("initialization","*");var code=constructorPreviewCode(),spChatWidget=document.getElementById("sp-chat-widget");loadCss(head,["wrong","override","preview","proactive-offer","snippet"]),body.insertAdjacentHTML("beforeend",code),spChatWidget&&spChatWidget.setAttribute("style","")}():(loadCss(head,["snippet"]),body.insertAdjacentHTML("beforeend","<div style='display:none' id='sp-root-container' class='"+(widgetConfiguration.isMobile()?"mobile-version":"desktop-version")+"'><div id='sp-chat-widget' data-hidden='hidden'> <div class='sp-round-button main-background-color second-fill-color' style='display:none' tabindex='100'><svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 74 74'><path transform='scale(1.3) translate(15 15)' d='M14,2C7.458,2,2,6.769,2,12.8S7.458,23.6,14,23.6c.415,0,.8-.083,1.2-.122v3.834l1.849-1.186c2.595-1.665,8.213-5.988,8.883-12.192A9.906,9.906,0,0,0,26,12.8C26,6.769,20.542,2,14,2Zm0,2.4c5.389,0,9.6,3.828,9.6,8.4a7.5,7.5,0,0,1-.052.867v0l0,0c-.415,3.841-3.489,6.857-5.946,8.824V20.687l-1.437.291A10.918,10.918,0,0,1,14,21.2c-5.389,0-9.6-3.828-9.6-8.4S8.611,4.4,14,4.4Z'/></svg></div><div class='sp-chat-widget__content main-background-color contact-tab-border' style='display:none' tabindex='100'><div id='sp-chat-label-icon'></div><div id='sp-chat-label-text' class='base-font contact-tab-font second-color'></div></div></div><div id='sp-chat-fake'></div><div id='sp-chat-frame' data-draggable='sp-drag-handle'><div id='sp-drag-handle'></div><div id='sp-side-bar'><div id='sp-close-frame' role='button' aria-label='Close' tabindex='2' class='close-icon'><svg class='main-path-color' xmlns='http://www.w3.org/2000/svg' width='15' height='15'><path clip-rule='evenodd' d='M14.318 15l-6.818-6.818-6.818 6.818-.682-.682 6.819-6.818-6.819-6.818.682-.682 6.818 6.818 6.818-6.818.682.682-6.818 6.818 6.818 6.818-.682.682z' /></svg></div></div><div id='sp-iframe-container'></div></div><div id='sp-min-tab-wrapper'><div class='sp-min-tab sp-round-button main-background-color second-fill-color' title='Show chat'><svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 74 74'><path transform='scale(1.3) translate(15 15)' d='M14,2C7.458,2,2,6.769,2,12.8S7.458,23.6,14,23.6c.415,0,.8-.083,1.2-.122v3.834l1.849-1.186c2.595-1.665,8.213-5.988,8.883-12.192A9.906,9.906,0,0,0,26,12.8C26,6.769,20.542,2,14,2Zm0,2.4c5.389,0,9.6,3.828,9.6,8.4a7.5,7.5,0,0,1-.052.867v0l0,0c-.415,3.841-3.489,6.857-5.946,8.824V20.687l-1.437.291A10.918,10.918,0,0,1,14,21.2c-5.389,0-9.6-3.828-9.6-8.4S8.611,4.4,14,4.4Z'/></svg></div><div class='sp-min-tab min-chat-tab main-background-color'><div class='min-tab-content' title='Show chat'><div id='min_agent_image' class='min-agent-image'></div><div id='min_agent_name' class='min-agent-name second-color title-font'></div></div></div></div></div>"),function(){var callback,wrapperCallback,hidden;if(window.addEventListener("message",receiveMessage,!1),snippetDraggable(),"true"===sessionStorage.getItem("bp-minimized"))startMinimized();else{var spChatFrame=document.querySelector("#sp-chat-frame");sessionStorage.getItem("chatLeft")&&(spChatFrame.style.left=sessionStorage.getItem("chatLeft")),sessionStorage.getItem("chatTop")&&(spChatFrame.style.top=sessionStorage.getItem("chatTop"))}function then(){var spCloseFrame,spMinTabs;snippetCheckAvailability(!0),(spCloseFrame=document.getElementById("sp-close-frame"))&&(spCloseFrame.addEventListener("click",function(){closeFrame()}),spCloseFrame.addEventListener("keyup",function(event){13===event.keyCode&&closeFrame()})),(spMinTabs=document.querySelectorAll(".sp-min-tab"))&&[].forEach.call(spMinTabs,function(tab){tab&&(tab.addEventListener("click",function(){var spChatIframe=document.getElementById("sp-chat-iframe");spChatIframe.contentWindow.postMessage("bp-request-minimize-off","*")}),tab.addEventListener("keyup",function(event){var spChatIframe=document.getElementById("sp-chat-iframe");13===event.keyCode&&spChatIframe.contentWindow.postMessage("bp-request-minimize-off","*")}))}),document.getElementById("sp-close-frame").setAttribute("title",i18n.endChatTooltip)}callback=onVisibilityChange,wrapperCallback=safeWrap,hidden="hidden",commonUtilService.isDefined(callback)&&(hidden in document?document.addEventListener("visibilitychange",callback):(hidden="mozHidden")in document?document.addEventListener("mozvisibilitychange",callback):(hidden="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",callback):(hidden="msHidden")in document?document.addEventListener("msvisibilitychange",callback):"onfocusin"in document?(document.onfocusin=wrapperCallback(document.onfocusin,callback),document.onfocusout=wrapperCallback(document.onfocusout,callback)):(window.onpageshow=wrapperCallback(window.onpageshow,callback),window.onpagehide=wrapperCallback(window.onpagehide,callback),window.onfocus=wrapperCallback(window.onfocus,callback),window.onblur=wrapperCallback(window.onblur,callback))),commonUtilService.isDefined(document.hidden)&&onVisibilityChange({type:document.hidden?"blur":"focus"}),spConfig.hidden=spConfig.hidden||null!=window.localStorage.getItem("bp-bc"),function(){var sharedDomains=spConfig.sharedDomains||spConfig.sharedHistoryDomains,currentDomainIsFromShared=!1;if(sharedDomains&&sharedDomains.length)for(var i=0;i<sharedDomains.length;++i){var domainSuffix=(!sharedDomains[i].length||"."!==sharedDomains[i][0]&&sharedDomains[i]!==location.hostname?".":"")+sharedDomains[i];if(location.hostname.length>=domainSuffix.length&&location.hostname.substring(location.hostname.length-domainSuffix.length)===domainSuffix){currentDomainIsFromShared=!0;break}}return currentDomainIsFromShared}()?function(thenCallback){var thenWasCalled=!1;setTimeout(function(){thenWasCalled||(thenCallback(),thenWasCalled=!0)},1e3),window.addEventListener("message",function tmpListener(event){var data=event.data,checkSessionIframe=document.getElementById("check-session-iframe");"bpc-session-exists"===data?(sessionStorage.setItem("sp-chat-snippet",!0),checkSessionIframe&&checkSessionIframe.parentElement.removeChild(checkSessionIframe),window.removeEventListener("mesage",tmpListener),thenCallback(),thenWasCalled=!0):"bpc-no-session"===data&&(checkSessionIframe&&checkSessionIframe.parentElement.removeChild(checkSessionIframe),window.removeEventListener("mesage",tmpListener),thenWasCalled||(thenCallback(),thenWasCalled=!0))});var url=widgetConfiguration.getChatPath()+"check-session.html?tenantUrl="+encodeURIComponent(variables.SP.cp.tenantUrl)+"&url="+encodeURIComponent(variables.SP.cp.url)+"&appId="+encodeURIComponent(variables.SP.cp.appId)+"&clientId="+encodeURIComponent(variables.SP.cp.clientId)+"&crossDomain="+encodeURIComponent(variables.SP.cp.crossDomain);body.insertAdjacentHTML("beforeend",'<iframe id="check-session-iframe" style="position:absolute;left:-1000px;top:-1000px;width:0;height:0;border:none" frameborder="0" src='+url+"></iframe>")}(then):then()}(),setTimeout(function(){htmlUtilService.setDivHoverById("sp-close-frame",i18n.endChatTooltip)},1e3))},snippetOpenChat=function(open,deleteIframe,startSession){var variables=snippetVariables(),helper=snippetHelperFunctions(),source=sessionStorage.getItem("source"),spChatIframe=document.querySelector("#sp-chat-iframe");function updateOffset(target,width,height){target.offsetWidth=width,target.offsetHeight=height}if(widgetConfiguration.isMobile()){var viewport=document.querySelectorAll('head meta[name="viewport"]'),head=document.querySelector("head");if(deleteIframe){var initialViewport=sessionStorage.getItem("initialViewport");viewport.length>0&&viewport[0].parentNode.removeChild(viewport[0]),initialViewport?head.insertAdjacentHTML("beforeend",'<meta name="viewport" content="'+initialViewport+'" />'):head.insertAdjacentHTML("beforeend",'<meta name="viewport" content="width=device-width, initial-scale=0" />')}else viewport.length>0?(sessionStorage.setItem("initialViewport",viewport[0].getAttribute("content")),viewport[0].parentNode.removeChild(viewport[0])):sessionStorage.removeItem("initialViewport"),head.insertAdjacentHTML("beforeend",'<meta name="viewport" content="width=320, initial-scale=1, maximum-scale=1, user-scalable=no" />')}var fr=document.querySelector("#sp-chat-frame"),wi=document.querySelector("#sp-chat-widget"),fakeTo=open?fr:wi,fakeFrom=open?wi:fr,snippetConfig=widgetConfiguration.getSnippet();if(snippetKeepOpenedState(open),helper.isHidden(fakeTo))if(null===window.localStorage.getItem("bp-bc")){snippetCheckAddFrame(startSession);var location="bottom_left";snippetConfig&&snippetConfig.contactTab.location&&(-1!==(location=snippetConfig.contactTab.location).indexOf("right_")||-1!==location.indexOf("left_")?"vertical":"horizontal"),helper.toggle(fakeTo),helper.toggle(fakeTo);var fake=document.querySelector("#sp-chat-fake");updateOffset(fake,0,0),"callbackFormCall"!==source&&helper.hide(fakeFrom),helper.toggle(fake);var start=(new Date).getTime(),fromWidth=fake.offsetWidth,fromHeight=fake.offsetHeight;!function animate(){var t,b,c,d,now=(new Date).getTime()-start,ease=(b=0,c=1,d=1e3,0==(t=now)?b:t==d?b+c:(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:c/2*(2-Math.pow(2,-10*--t))+b);fake.style.width=fromWidth+(0-fromWidth)*ease+"px",fake.style.height=fromHeight+(0-fromHeight)*ease+"px",now<1e3&&setTimeout(animate,1e3/60)}(),setTimeout(function(){fakeTo===wi&&snippetConfig&&!1===snippetConfig.contactTab.enabled||fakeTo===wi&&sessionStorage.getItem("confFromOtherPage")||"callbackFormCall"!==source&&helper.toggle(fakeTo),helper.toggle(fake),variables.init=!0,deleteIframe&&(spChatIframe&&spChatIframe.parentNode&&spChatIframe.parentNode.removeChild(spChatIframe),sessionStorage.removeItem("source"))},400)}else fr.parentNode.removeChild(fr);else deleteIframe&&spChatIframe.parentNode.removeChild(spChatIframe)},snippetShowNotification=function(title,body,icon){var config=snippetVariables(),doNotShowNotifications=window.localStorage.getItem("doNotShowNotifications"),helper=snippetHelperFunctions();if("true"!==doNotShowNotifications&&window.Notification&&"granted"===window.Notification.permission&&helper.hasClass(document.querySelector("#sp-root-container"),"sp-hidden")){var options={body:htmlUtilService.htmlDecode(body),icon:icon},n=new window.Notification(title,options);config.notifications.push(n),config.SP.sound_notification&&(config.audioElement.pause(),config.audioElement.currentTime=0,config.audioElement.play().then(function(){},function(error){console.warn(error)})),n.onclose=function(){var index=config.notifications.indexOf(n);index>-1&&config.notifications.splice(index,1)},n.onclick=function(e){window.focus()}}},snippetSurfly=function(){function postMessage(text){var spChatIframeElement=document.getElementById("sp-chat-iframe");spChatIframeElement&&spChatIframeElement.contentWindow.postMessage(text,"*")}function onSessionPreEnd(session){postMessage("bp-cobrowsing-ended-message"),postMessage("bp-cobrowsing-ended"),setTimeout(function(){session.end()},100)}function start(){try{if(!Surfly.isInsideSession)snippetVariables().TogetherJSUrlWasSent||Surfly.session().on("session_loaded",function(session){postMessage(JSON.stringify({message:"bp-cobrowsing-started",provider:"SURFLY",url:session.followerLink,sessionId:session._sessionId}))}).on("session_pre_end",onSessionPreEnd).startLeader(null,{name:"Customer"})}catch(e){console.error("Surfly error: ",e)}}return{init:function(widgetKey,onInit){Surfly.init(commonUtilService.merge({widget_key:widgetKey,confirm_session_start:!1},SERVICE_PATTERN_CHAT_CONFIG.surflySettings||{}),function(initResult){if(initResult.success){if(!Surfly.isInsideSession){for(var sessionList=Surfly.listSessions(),i=0;i<sessionList.length;++i)sessionList[i].on("session_pre_end",onSessionPreEnd);onInit&&onInit()}}else console.error("#Origin: Surfly was unable to initialize properly.")})},start:start,stop:function(){try{for(var sessionList=Surfly.listSessions(),i=0;i<sessionList.length;++i)if(sessionList[i].started){postMessage("bp-cobrowsing-ended");var sesionToEnd=sessionList[i];setTimeout(function(){sesionToEnd.end()},100)}}catch(e){console.error("Surfly error: ",e)}},isRunning:function(){try{if(!Surfly.listSessions)return!1;for(var sessionList=Surfly.listSessions(),sessionStarted=!1,i=0;i<sessionList.length;++i)if(sessionList[i].started){sessionStarted=!0;break}return sessionStarted}catch(e){console.error("Surfly error: ",e)}return!1},askToStart:function(){try{for(var sessionList=Surfly.listSessions(),sessionStarted=!1,i=0;i<sessionList.length;++i)if(sessionList[i].started){sessionStarted=!0;break}sessionStarted||showCobrowsingStartPopup(function(){start()},function(){postMessage("bp-cobrowsing-rejected")})}catch(e){console.error("Surfly error: ",e)}}}}(),snippetTogetherJs=function(){function postMessage(url,togetherJSUrlWasSent){var variables=snippetVariables();document.getElementById("sp-chat-iframe").contentWindow.postMessage(url,"*"),commonUtilService.isUndefined(togetherJSUrlWasSent)||(variables.TogetherJSUrlWasSent=togetherJSUrlWasSent)}function followPeers(){TogetherJS.running&&TogetherJS.require("peers").getAllPeers().forEach(function(p){p.following||p.follow()})}return{init:function(){TogetherJSConfig_suppressJoinConfirmation=!0,TogetherJSConfig_suppressInvite=!0,TogetherJSConfig_disableWebRTC=!0,sessionStorage.setItem("togetherjs.settings.seenIntroDialog",!0),TogetherJSConfig_getUserName=function(){return"Viewer"},TogetherJSConfig_on_ready=function(){TogetherJS.running&&!TogetherJS.require("peers").Self.isCreator&&setInterval(followPeers,5e3)},setTimeout(function(){"undefined"==typeof TogetherJS||widgetConfiguration.isCobrowsingEditEnabled()||TogetherJS.config("ignoreForms",!0),"undefined"!=typeof TogetherJS&&TogetherJS.startup&&"joined"===TogetherJS.startup.reason&&($("#sp-root-container").remove(),$(".proactive-offer").remove())},100)},start:function(){var variables=snippetVariables(),url=null;if(!TogetherJS.running){if(TogetherJS(),!variables.TogetherJSUrlWasSent){try{url=TogetherJS.shareUrl()}catch(e){}null===url?TogetherJS.on("ready",function onReady(){postMessage("sp-together-url"+(url=TogetherJS.shareUrl()),!0),TogetherJS.off("ready",onReady)}):postMessage("sp-together-url"+url,!0)}postMessage("sp-started-together")}},stop:function(){TogetherJS.running&&(TogetherJS(),postMessage("sp-together-stop",!1),postMessage("sp-stopped-together",!1))},isRunning:function(){return TogetherJS.running},askToStart:function(){}}}(),snippetVariables=function(){return{SP:SERVICE_PATTERN_CHAT_CONFIG||{},init:!1,notifications:[],TogetherJSUrlWasSent:!1,audioElement:document.createElement("audio")}},updateChatStyles=function(currentWidget,styles){function toCssStyle(style){return style?Object.keys(style).map(function(key){return[key,":",style[key],";"].join("")}).join(""):""}if(styles){var key=Object.keys(styles)[0],css=(prefix="",style=styles[key],appliedStyles=[],hasBase&&appliedStyles.push({name:"baseFont",className:"base-font"}),(appliedStyles=appliedStyles.concat([{name:"clientMessage",className:"clientMessage"},{name:"agentMessage",className:"agent-message"},{name:"contactTabBorder",className:"contact-tab-border"},{name:"contactTabFont",className:"contact-tab-font "},{name:"contentMargin",className:"content-margin"},{name:"dialogShadow",className:"dialog-shadow"},{name:"systemMessage",className:"system-message"},{name:"titleFont",className:"title-font"},{name:"widgetBackground",className:"widget-background"},{name:"widgetBorder",className:"widget-border"},{name:"baseFont",className:"base-font"},{name:"widgetBorderRadius",className:"widget-border-radius"}])).map(function(part){return[prefix,"."+part.className+"{",toCssStyle(style[part.name]),"}"].join(" ")}).join(" ")),highlightsColor=currentWidget&&currentWidget.color?currentWidget.color:"2db2dd",highlightsTextColor=currentWidget&&currentWidget.textColor?currentWidget.textColor:"fff",videoCallEnabled="flex",widgetMinimizationEnabled="flex",fullConf=JSON.parse(sessionStorage.getItem("fullConf")),definition=widgetConfiguration.getDefinition();fullConf&&fullConf.widget&&fullConf.widget.chatWidgetStyling&&(highlightsColor=fullConf.widget.chatWidgetStyling.color,highlightsTextColor=fullConf.widget.chatWidgetStyling.textColor,videoCallEnabled=fullConf.widget.chatWidgetStyling.videoCallEnabled?"flex":"none",widgetMinimizationEnabled=!1===fullConf.widget.chatWidgetStyling.widgetMinimizationEnabled?"none":"flex"),definition&&definition.chatWidgetStyling&&(highlightsColor=definition.chatWidgetStyling.color,highlightsTextColor=definition.chatWidgetStyling.textColor,videoCallEnabled=definition.chatWidgetStyling.videoCallEnabled?"flex":"none",widgetMinimizationEnabled=!1===definition.chatWidgetStyling.widgetMinimizationEnabled?"none":"flex");var hlColor=(result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(highlightsColor))?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null;!function(styles){var dynamicStyle=document.querySelector("#dynamicStyle");dynamicStyle&&dynamicStyle.parentNode.removeChild(dynamicStyle);var sheet=document.createElement("style");sheet.id="dynamicStyle",sheet.innerHTML=styles,document.body.appendChild(sheet)}([[".main-background-color {","background:#"+highlightsColor,"}",".main-background-color-important {","background:#"+highlightsColor+" !important","}",".tab_active path {","fill:#"+highlightsColor,"}",".main-path-color path {","fill:#"+highlightsTextColor,"}",".main-stroke-color line {","stroke:#"+highlightsTextColor,"}",".main-fill-color {","fill:#"+highlightsColor,"}",".main-color {","color:#"+highlightsColor,"}",".widget-border {","border-color:#"+highlightsColor+"!important;","background:#ffffff","}",".second-background-color {","background:#"+highlightsTextColor,"}",".second-fill-color {","fill:#"+highlightsTextColor,"}",".second-color {","color:#"+highlightsTextColor+"!important","}",".second-color a, .second-color a:link, .second-color a:visited, .second-color a:active {","color:#"+highlightsTextColor+"!important","}","#preview #callMe {","display:"+videoCallEnabled,"}","#preview #minimizeChat {","display:"+widgetMinimizationEnabled,"}",".btns.choice button:hover {","background-color: rgba("+hlColor.r+","+hlColor.g+","+hlColor.b+",.7)","}"].join(" "),css].join(" "))}var result,prefix,style,hasBase,appliedStyles};